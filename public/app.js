!function(t){function e(e){for(var n,i,o=e[0],s=e[1],a=0,u=[];a<o.length;a++)i=o[a],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&u.push(r[i][0]),r[i]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);for(l&&l(e);u.length;)u.shift()()}var n={},r={0:0};function i(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(t){var e=[],n=r[t];if(0!==n)if(n)e.push(n[2]);else{var o=new Promise((function(e,i){n=r[t]=[e,i]}));e.push(n[2]=o);var s,a=document.createElement("script");a.charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.src=function(t){return i.p+""+t+".app.js"}(t);var l=new Error;s=function(e){a.onerror=a.onload=null,clearTimeout(u);var n=r[t];if(0!==n){if(n){var i=e&&("load"===e.type?"missing":e.type),o=e&&e.target&&e.target.src;l.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",l.name="ChunkLoadError",l.type=i,l.request=o,n[1](l)}r[t]=void 0}};var u=setTimeout((function(){s({type:"timeout",target:a})}),12e4);a.onerror=a.onload=s,document.head.appendChild(a)}return Promise.all(e)},i.m=t,i.c=n,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i.oe=function(t){throw console.error(t),t};var o=window.webpackJsonp=window.webpackJsonp||[],s=o.push.bind(o);o.push=e,o=o.slice();for(var a=0;a<o.length;a++)e(o[a]);var l=s;i(i.s=3)}([function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(t){r=s}}();var l,u=[],c=!1,f=-1;function h(){c&&l&&(c=!1,l.length?u=l.concat(u):f=-1,u.length&&d())}function d(){if(!c){var t=a(h);c=!0;for(var e=u.length;e;){for(l=u,u=[];++f<e;)l&&l[f].run();f=-1,e=u.length}l=null,c=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function g(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new p(t,e)),1!==u.length||c||a(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var r=n(6),i=n(7),o=n(8);function s(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(s()<e)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=l.prototype:(null===t&&(t=new l(e)),t.length=e),t}function l(t,e,n){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return f(this,t)}return u(this,t,e,n)}function u(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);l.TYPED_ARRAY_SUPPORT?(t=e).__proto__=l.prototype:t=h(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!l.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(e,n),i=(t=a(t,r)).write(e,n);i!==r&&(t=t.slice(0,i));return t}(t,e,n):function(t,e){if(l.isBuffer(e)){var n=0|d(e.length);return 0===(t=a(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?a(t,0):h(t,e);if("Buffer"===e.type&&o(e.data))return h(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function c(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function f(t,e){if(c(e),t=a(t,e<0?0:0|d(e)),!l.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function h(t,e){var n=e.length<0?0:0|d(e.length);t=a(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function d(t){if(t>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|t}function p(t,e){if(l.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return U(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return $(t).length;default:if(r)return U(t).length;e=(""+e).toLowerCase(),r=!0}}function g(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return C(this,e,n);case"utf8":case"utf-8":return E(this,e,n);case"ascii":return O(this,e,n);case"latin1":case"binary":return k(this,e,n);case"base64":return D(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function m(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function v(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=l.from(e,r)),l.isBuffer(e))return 0===e.length?-1:w(t,e,n,r,i);if("number"==typeof e)return e&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):w(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function w(t,e,n,r,i){var o,s=1,a=t.length,l=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;s=2,a/=2,l/=2,n/=2}function u(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var c=-1;for(o=n;o<a;o++)if(u(t,o)===u(e,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===l)return c*s}else-1!==c&&(o-=o-c),c=-1}else for(n+l>a&&(n=a-l),o=n;o>=0;o--){for(var f=!0,h=0;h<l;h++)if(u(t,o+h)!==u(e,h)){f=!1;break}if(f)return o}return-1}function y(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[n+s]=a}return s}function _(t,e,n,r){return F(U(e,t.length-n),t,n,r)}function b(t,e,n,r){return F(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function A(t,e,n,r){return b(t,e,n,r)}function S(t,e,n,r){return F($(e),t,n,r)}function x(t,e,n,r){return F(function(t,e){for(var n,r,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)n=t.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(e,t.length-n),t,n,r)}function D(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function E(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var o,s,a,l,u=t[i],c=null,f=u>239?4:u>223?3:u>191?2:1;if(i+f<=n)switch(f){case 1:u<128&&(c=u);break;case 2:128==(192&(o=t[i+1]))&&(l=(31&u)<<6|63&o)>127&&(c=l);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&(l=(15&u)<<12|(63&o)<<6|63&s)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:o=t[i+1],s=t[i+2],a=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(c=l)}null===c?(c=65533,f=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),i+=f}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=4096));return n}(r)}e.Buffer=l,e.SlowBuffer=function(t){+t!=t&&(t=0);return l.alloc(+t)},e.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=s(),l.poolSize=8192,l._augment=function(t){return t.__proto__=l.prototype,t},l.from=function(t,e,n){return u(null,t,e,n)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(t,e,n){return function(t,e,n,r){return c(e),e<=0?a(t,e):void 0!==n?"string"==typeof r?a(t,e).fill(n,r):a(t,e).fill(n):a(t,e)}(null,t,e,n)},l.allocUnsafe=function(t){return f(null,t)},l.allocUnsafeSlow=function(t){return f(null,t)},l.isBuffer=function(t){return!(null==t||!t._isBuffer)},l.compare=function(t,e){if(!l.isBuffer(t)||!l.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,o=Math.min(n,r);i<o;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},l.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(t,e){if(!o(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return l.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=l.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var s=t[n];if(!l.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)m(this,e,e+1);return this},l.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)m(this,e,e+3),m(this,e+1,e+2);return this},l.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)m(this,e,e+7),m(this,e+1,e+6),m(this,e+2,e+5),m(this,e+3,e+4);return this},l.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?E(this,0,t):g.apply(this,arguments)},l.prototype.equals=function(t){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===l.compare(this,t)},l.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},l.prototype.compare=function(t,e,n,r,i){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(e>>>=0),a=Math.min(o,s),u=this.slice(r,i),c=t.slice(e,n),f=0;f<a;++f)if(u[f]!==c[f]){o=u[f],s=c[f];break}return o<s?-1:s<o?1:0},l.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},l.prototype.indexOf=function(t,e,n){return v(this,t,e,n,!0)},l.prototype.lastIndexOf=function(t,e,n){return v(this,t,e,n,!1)},l.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return y(this,t,e,n);case"utf8":case"utf-8":return _(this,t,e,n);case"ascii":return b(this,t,e,n);case"latin1":case"binary":return A(this,t,e,n);case"base64":return S(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function O(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function k(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function C(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=e;o<n;++o)i+=B(t[o]);return i}function P(t,e,n){for(var r=t.slice(e,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function T(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function I(t,e,n,r,i,o){if(!l.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function N(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-n,2);i<o;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function j(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-n,4);i<o;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function R(t,e,n,r,i,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function z(t,e,n,r,o){return o||R(t,0,n,4),i.write(t,e,n,r,23,4),n+4}function M(t,e,n,r,o){return o||R(t,0,n,8),i.write(t,e,n,r,52,8),n+8}l.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),l.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=l.prototype;else{var i=e-t;n=new l(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+t]}return n},l.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||T(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r},l.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||T(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},l.prototype.readUInt8=function(t,e){return e||T(t,1,this.length),this[t]},l.prototype.readUInt16LE=function(t,e){return e||T(t,2,this.length),this[t]|this[t+1]<<8},l.prototype.readUInt16BE=function(t,e){return e||T(t,2,this.length),this[t]<<8|this[t+1]},l.prototype.readUInt32LE=function(t,e){return e||T(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},l.prototype.readUInt32BE=function(t,e){return e||T(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},l.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||T(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},l.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||T(t,e,this.length);for(var r=e,i=1,o=this[t+--r];r>0&&(i*=256);)o+=this[t+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},l.prototype.readInt8=function(t,e){return e||T(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},l.prototype.readInt16LE=function(t,e){e||T(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(t,e){e||T(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(t,e){return e||T(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},l.prototype.readInt32BE=function(t,e){return e||T(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},l.prototype.readFloatLE=function(t,e){return e||T(t,4,this.length),i.read(this,t,!0,23,4)},l.prototype.readFloatBE=function(t,e){return e||T(t,4,this.length),i.read(this,t,!1,23,4)},l.prototype.readDoubleLE=function(t,e){return e||T(t,8,this.length),i.read(this,t,!0,52,8)},l.prototype.readDoubleBE=function(t,e){return e||T(t,8,this.length),i.read(this,t,!1,52,8)},l.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||I(this,t,e,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[e]=255&t;++o<n&&(i*=256);)this[e+o]=t/i&255;return e+n},l.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||I(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+n},l.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,1,255,0),l.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},l.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):N(this,t,e,!0),e+2},l.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):N(this,t,e,!1),e+2},l.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):j(this,t,e,!0),e+4},l.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):j(this,t,e,!1),e+4},l.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);I(this,t,e,n,i-1,-i)}var o=0,s=1,a=0;for(this[e]=255&t;++o<n&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},l.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);I(this,t,e,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},l.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,1,127,-128),l.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},l.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):N(this,t,e,!0),e+2},l.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):N(this,t,e,!1),e+2},l.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):j(this,t,e,!0),e+4},l.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):j(this,t,e,!1),e+4},l.prototype.writeFloatLE=function(t,e,n){return z(this,t,e,!0,n)},l.prototype.writeFloatBE=function(t,e,n){return z(this,t,e,!1,n)},l.prototype.writeDoubleLE=function(t,e,n){return M(this,t,e,!0,n)},l.prototype.writeDoubleBE=function(t,e,n){return M(this,t,e,!1,n)},l.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,o=r-n;if(this===t&&n<e&&e<r)for(i=o-1;i>=0;--i)t[i+e]=this[i+n];else if(o<1e3||!l.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},l.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var s=l.isBuffer(t)?t:U(new l(t,r).toString()),a=s.length;for(o=0;o<n-e;++o)this[o+e]=s[o%a]}return this};var L=/[^+\/0-9A-Za-z-_]/g;function B(t){return t<16?"0"+t.toString(16):t.toString(16)}function U(t,e){var n;e=e||1/0;for(var r=t.length,i=null,o=[],s=0;s<r;++s){if((n=t.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function $(t){return r.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(L,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function F(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}}).call(this,n(0))},function(t,e,n){(function(t,e,r){function i(t,e,n,r,i,o){return{tag:t,key:e,attrs:n,children:r,text:i,dom:o,domSize:void 0,state:void 0,events:void 0,instance:void 0}}i.normalize=function(t){return Array.isArray(t)?i("[",void 0,void 0,i.normalizeChildren(t),void 0,void 0):null==t||"boolean"==typeof t?null:"object"==typeof t?t:i("#",void 0,void 0,String(t),void 0,void 0)},i.normalizeChildren=function(t){var e=[];if(t.length){for(var n=null!=t[0]&&null!=t[0].key,r=1;r<t.length;r++)if((null!=t[r]&&null!=t[r].key)!==n)throw new TypeError("Vnodes must either always have keys or never have keys!");for(r=0;r<t.length;r++)e[r]=i.normalize(t[r])}return e};var o=i,s=function(){var t,e=arguments[this],n=this+1;if(null==e?e={}:("object"!=typeof e||null!=e.tag||Array.isArray(e))&&(e={},n=this),arguments.length===n+1)t=arguments[n],Array.isArray(t)||(t=[t]);else for(t=[];n<arguments.length;)t.push(arguments[n++]);return o("",e.key,e,t)},a=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,l={},u={}.hasOwnProperty;function c(t){for(var e in t)if(u.call(t,e))return!1;return!0}function f(t){for(var e,n="div",r=[],i={};e=a.exec(t);){var o=e[1],s=e[2];if(""===o&&""!==s)n=s;else if("#"===o)i.id=s;else if("."===o)r.push(s);else if("["===e[3][0]){var u=e[6];u&&(u=u.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),"class"===e[4]?r.push(u):i[e[4]]=""===u?u:u||!0}}return r.length>0&&(i.className=r.join(" ")),l[t]={tag:n,attrs:i}}function h(t,e){var n=e.attrs,r=o.normalizeChildren(e.children),i=u.call(n,"class"),s=i?n.class:n.className;if(e.tag=t.tag,e.attrs=null,e.children=void 0,!c(t.attrs)&&!c(n)){var a={};for(var l in n)u.call(n,l)&&(a[l]=n[l]);n=a}for(var l in t.attrs)u.call(t.attrs,l)&&"className"!==l&&!u.call(n,l)&&(n[l]=t.attrs[l]);for(var l in null==s&&null==t.attrs.className||(n.className=null!=s?null!=t.attrs.className?String(t.attrs.className)+" "+String(s):s:null!=t.attrs.className?t.attrs.className:null),i&&(n.class=null),n)if(u.call(n,l)&&"key"!==l){e.attrs=n;break}return Array.isArray(r)&&1===r.length&&null!=r[0]&&"#"===r[0].tag?e.text=r[0].children:e.children=r,e}var d=function(t){if(null==t||"string"!=typeof t&&"function"!=typeof t&&"function"!=typeof t.view)throw Error("The selector must be either a string or a component.");var e=s.apply(1,arguments);return"string"==typeof t&&(e.children=o.normalizeChildren(e.children),"["!==t)?h(l[t]||f(t),e):(e.tag=t,e)};d.trust=function(t){return null==t&&(t=""),o("<",void 0,void 0,t,void 0,void 0)},d.fragment=function(){var t=s.apply(0,arguments);return t.tag="[",t.children=o.normalizeChildren(t.children),t};var p=d,g="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};var m=function(t){if(!(this instanceof m))throw new Error("Promise must be called with `new`");if("function"!=typeof t)throw new TypeError("executor must be a function");var n=this,r=[],i=[],o=u(r,!0),s=u(i,!1),a=n._instance={resolvers:r,rejectors:i},l="function"==typeof e?e:setTimeout;function u(t,e){return function o(u){var f;try{if(!e||null==u||"object"!=typeof u&&"function"!=typeof u||"function"!=typeof(f=u.then))l((function(){e||0!==t.length||console.error("Possible unhandled promise rejection:",u);for(var n=0;n<t.length;n++)t[n](u);r.length=0,i.length=0,a.state=e,a.retry=function(){o(u)}}));else{if(u===n)throw new TypeError("Promise can't be resolved w/ itself");c(f.bind(u))}}catch(t){s(t)}}}function c(t){var e=0;function n(t){return function(n){e++>0||t(n)}}var r=n(s);try{t(n(o),r)}catch(t){r(t)}}c(t)};m.prototype.then=function(t,e){var n,r,i=this._instance;function o(t,e,o,s){e.push((function(e){if("function"!=typeof t)o(e);else try{n(t(e))}catch(t){r&&r(t)}})),"function"==typeof i.retry&&s===i.state&&i.retry()}var s=new m((function(t,e){n=t,r=e}));return o(t,i.resolvers,n,!0),o(e,i.rejectors,r,!1),s},m.prototype.catch=function(t){return this.then(null,t)},m.prototype.finally=function(t){return this.then((function(e){return m.resolve(t()).then((function(){return e}))}),(function(e){return m.resolve(t()).then((function(){return m.reject(e)}))}))},m.resolve=function(t){return t instanceof m?t:new m((function(e){e(t)}))},m.reject=function(t){return new m((function(e,n){n(t)}))},m.all=function(t){return new m((function(e,n){var r=t.length,i=0,o=[];if(0===t.length)e([]);else for(var s=0;s<t.length;s++)!function(s){function a(t){i++,o[s]=t,i===r&&e(o)}null==t[s]||"object"!=typeof t[s]&&"function"!=typeof t[s]||"function"!=typeof t[s].then?a(t[s]):t[s].then(a,n)}(s)}))},m.race=function(t){return new m((function(e,n){for(var r=0;r<t.length;r++)t[r].then(e,n)}))};var v=m,w=function(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},n.exports),n.exports}((function(t){"undefined"!=typeof window?(void 0===window.Promise?window.Promise=v:window.Promise.prototype.finally||(window.Promise.prototype.finally=v.prototype.finally),t.exports=window.Promise):void 0!==g?(void 0===g.Promise?g.Promise=v:g.Promise.prototype.finally||(g.Promise.prototype.finally=v.prototype.finally),t.exports=g.Promise):t.exports=v})),y=function(t){var e,n=t&&t.document,r={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function i(t){return t.attrs&&t.attrs.xmlns||r[t.tag]}function s(t,e){if(t.state!==e)throw new Error("`vnode.state` must not be modified")}function a(t){var e=t.state;try{return this.apply(e,arguments)}finally{s(t,e)}}function l(){try{return n.activeElement}catch(t){return null}}function u(t,e,n,r,i,o,s){for(var a=n;a<r;a++){var l=e[a];null!=l&&c(t,l,i,s,o)}}function c(t,e,r,i,o){var s=e.tag;if("string"==typeof s)switch(e.state={},null!=e.attrs&&U(e.attrs,e,r),s){case"#":!function(t,e,r){e.dom=n.createTextNode(e.children),S(t,e.dom,r)}(t,e,o);break;case"<":h(t,e,i,o);break;case"[":!function(t,e,r,i,o){var s=n.createDocumentFragment();if(null!=e.children){var a=e.children;u(s,a,0,a.length,r,null,i)}e.dom=s.firstChild,e.domSize=s.childNodes.length,S(t,s,o)}(t,e,r,i,o);break;default:d(t,e,r,i,o)}else!function(t,e,n,r,i){p(e,n),null!=e.instance?(c(t,e.instance,n,r,i),e.dom=e.instance.dom,e.domSize=null!=e.dom?e.instance.domSize:0):e.domSize=0}(t,e,r,i,o)}var f={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function h(t,e,r,i){var o=e.children.match(/^\s*?<(\w+)/im)||[],s=n.createElement(f[o[1]]||"div");"http://www.w3.org/2000/svg"===r?(s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+e.children+"</svg>",s=s.firstChild):s.innerHTML=e.children,e.dom=s.firstChild,e.domSize=s.childNodes.length,e.instance=[];for(var a,l=n.createDocumentFragment();a=s.firstChild;)e.instance.push(a),l.appendChild(a);S(t,l,i)}function d(t,e,r,s,a){var l=e.tag,c=e.attrs,f=c&&c.is,h=(s=i(e)||s)?f?n.createElementNS(s,l,{is:f}):n.createElementNS(s,l):f?n.createElement(l,{is:f}):n.createElement(l);if(e.dom=h,null!=c&&function(t,e,n){for(var r in e)P(t,r,null,e[r],n)}(e,c,s),S(t,h,a),!x(e)&&(null!=e.text&&(""!==e.text?h.textContent=e.text:e.children=[o("#",void 0,void 0,e.text,void 0,void 0)]),null!=e.children)){var d=e.children;u(h,d,0,d.length,r,null,s),"select"===e.tag&&null!=c&&function(t,e){if("value"in e)if(null===e.value)-1!==t.dom.selectedIndex&&(t.dom.value=null);else{var n=""+e.value;t.dom.value===n&&-1!==t.dom.selectedIndex||(t.dom.value=n)}"selectedIndex"in e&&P(t,"selectedIndex",null,e.selectedIndex,void 0)}(e,c)}}function p(t,e){var n;if("function"==typeof t.tag.view){if(t.state=Object.create(t.tag),null!=(n=t.state.view).$$reentrantLock$$)return;n.$$reentrantLock$$=!0}else{if(t.state=void 0,null!=(n=t.tag).$$reentrantLock$$)return;n.$$reentrantLock$$=!0,t.state=null!=t.tag.prototype&&"function"==typeof t.tag.prototype.view?new t.tag(t):t.tag(t)}if(U(t.state,t,e),null!=t.attrs&&U(t.attrs,t,e),t.instance=o.normalize(a.call(t.state.view,t)),t.instance===t)throw Error("A view cannot return the vnode it received as argument");n.$$reentrantLock$$=null}function g(t,e,n,r,i,o){if(e!==n&&(null!=e||null!=n))if(null==e||0===e.length)u(t,n,0,n.length,r,i,o);else if(null==n||0===n.length)D(t,e,0,e.length);else{var s=null!=e[0]&&null!=e[0].key,a=null!=n[0]&&null!=n[0].key,l=0,f=0;if(!s)for(;f<e.length&&null==e[f];)f++;if(!a)for(;l<n.length&&null==n[l];)l++;if(null===a&&null==s)return;if(s!==a)D(t,e,f,e.length),u(t,n,l,n.length,r,i,o);else if(a){for(var h,d,p,g,v,w=e.length-1,S=n.length-1;w>=f&&S>=l&&(p=e[w],g=n[S],p.key===g.key);)p!==g&&m(t,p,g,r,i,o),null!=g.dom&&(i=g.dom),w--,S--;for(;w>=f&&S>=l&&(h=e[f],d=n[l],h.key===d.key);)f++,l++,h!==d&&m(t,h,d,r,b(e,f,i),o);for(;w>=f&&S>=l&&l!==S&&h.key===g.key&&p.key===d.key;)A(t,p,v=b(e,f,i)),p!==d&&m(t,p,d,r,v,o),++l<=--S&&A(t,h,i),h!==g&&m(t,h,g,r,i,o),null!=g.dom&&(i=g.dom),f++,p=e[--w],g=n[S],h=e[f],d=n[l];for(;w>=f&&S>=l&&p.key===g.key;)p!==g&&m(t,p,g,r,i,o),null!=g.dom&&(i=g.dom),S--,p=e[--w],g=n[S];if(l>S)D(t,e,f,w+1);else if(f>w)u(t,n,l,S+1,r,i,o);else{var x,O,k=i,C=S-l+1,P=new Array(C),T=0,I=0,N=2147483647,j=0;for(I=0;I<C;I++)P[I]=-1;for(I=S;I>=l;I--){null==x&&(x=y(e,f,w+1));var R=x[(g=n[I]).key];null!=R&&(N=R<N?R:-1,P[I-l]=R,p=e[R],e[R]=null,p!==g&&m(t,p,g,r,i,o),null!=g.dom&&(i=g.dom),j++)}if(i=k,j!==w-f+1&&D(t,e,f,w+1),0===j)u(t,n,l,S+1,r,i,o);else if(-1===N)for(T=(O=function(t){var e=[0],n=0,r=0,i=0,o=_.length=t.length;for(i=0;i<o;i++)_[i]=t[i];for(i=0;i<o;++i)if(-1!==t[i]){var s=e[e.length-1];if(t[s]<t[i])_[i]=s,e.push(i);else{for(n=0,r=e.length-1;n<r;){var a=(n>>>1)+(r>>>1)+(n&r&1);t[e[a]]<t[i]?n=a+1:r=a}t[i]<t[e[n]]&&(n>0&&(_[i]=e[n-1]),e[n]=i)}}n=e.length,r=e[n-1];for(;n-- >0;)e[n]=r,r=_[r];return _.length=0,e}(P)).length-1,I=S;I>=l;I--)d=n[I],-1===P[I-l]?c(t,d,r,o,i):O[T]===I-l?T--:A(t,d,i),null!=d.dom&&(i=n[I].dom);else for(I=S;I>=l;I--)d=n[I],-1===P[I-l]&&c(t,d,r,o,i),null!=d.dom&&(i=n[I].dom)}}else{var z=e.length<n.length?e.length:n.length;for(l=l<f?l:f;l<z;l++)(h=e[l])===(d=n[l])||null==h&&null==d||(null==h?c(t,d,r,o,b(e,l+1,i)):null==d?E(t,h):m(t,h,d,r,b(e,l+1,i),o));e.length>z&&D(t,e,l,e.length),n.length>z&&u(t,n,l,n.length,r,i,o)}}}function m(t,e,n,r,i,o){var s=e.tag;if(s===n.tag){if(n.state=e.state,n.events=e.events,function(t,e){do{var n;if(null!=t.attrs&&"function"==typeof t.attrs.onbeforeupdate)if(void 0!==(n=a.call(t.attrs.onbeforeupdate,t,e))&&!n)break;if("string"!=typeof t.tag&&"function"==typeof t.state.onbeforeupdate)if(void 0!==(n=a.call(t.state.onbeforeupdate,t,e))&&!n)break;return!1}while(0);return t.dom=e.dom,t.domSize=e.domSize,t.instance=e.instance,t.attrs=e.attrs,t.children=e.children,t.text=e.text,!0}(n,e))return;if("string"==typeof s)switch(null!=n.attrs&&$(n.attrs,n,r),s){case"#":!function(t,e){t.children.toString()!==e.children.toString()&&(t.dom.nodeValue=e.children);e.dom=t.dom}(e,n);break;case"<":!function(t,e,n,r,i){e.children!==n.children?(O(t,e),h(t,n,r,i)):(n.dom=e.dom,n.domSize=e.domSize,n.instance=e.instance)}(t,e,n,o,i);break;case"[":!function(t,e,n,r,i,o){g(t,e.children,n.children,r,i,o);var s=0,a=n.children;if(n.dom=null,null!=a){for(var l=0;l<a.length;l++){var u=a[l];null!=u&&null!=u.dom&&(null==n.dom&&(n.dom=u.dom),s+=u.domSize||1)}1!==s&&(n.domSize=s)}}(t,e,n,r,i,o);break;default:v(e,n,r,o)}else w(t,e,n,r,i,o)}else E(t,e),c(t,n,r,o,i)}function v(t,e,n,r){var s=e.dom=t.dom;r=i(e)||r,"textarea"===e.tag&&(null==e.attrs&&(e.attrs={}),null!=e.text&&(e.attrs.value=e.text,e.text=void 0)),function(t,e,n,r){if(null!=n)for(var i in n)P(t,i,e&&e[i],n[i],r);var o;if(null!=e)for(var i in e)null==(o=e[i])||null!=n&&null!=n[i]||T(t,i,o,r)}(e,t.attrs,e.attrs,r),x(e)||(null!=t.text&&null!=e.text&&""!==e.text?t.text.toString()!==e.text.toString()&&(t.dom.firstChild.nodeValue=e.text):(null!=t.text&&(t.children=[o("#",void 0,void 0,t.text,void 0,t.dom.firstChild)]),null!=e.text&&(e.children=[o("#",void 0,void 0,e.text,void 0,void 0)]),g(s,t.children,e.children,n,null,r)))}function w(t,e,n,r,i,s){if(n.instance=o.normalize(a.call(n.state.view,n)),n.instance===n)throw Error("A view cannot return the vnode it received as argument");$(n.state,n,r),null!=n.attrs&&$(n.attrs,n,r),null!=n.instance?(null==e.instance?c(t,n.instance,r,s,i):m(t,e.instance,n.instance,r,i,s),n.dom=n.instance.dom,n.domSize=n.instance.domSize):null!=e.instance?(E(t,e.instance),n.dom=void 0,n.domSize=0):(n.dom=e.dom,n.domSize=e.domSize)}function y(t,e,n){for(var r=Object.create(null);e<n;e++){var i=t[e];if(null!=i){var o=i.key;null!=o&&(r[o]=e)}}return r}var _=[];function b(t,e,n){for(;e<t.length;e++)if(null!=t[e]&&null!=t[e].dom)return t[e].dom;return n}function A(t,e,r){var i=n.createDocumentFragment();!function t(e,n,r){for(;null!=r.dom&&r.dom.parentNode===e;){if("string"!=typeof r.tag){if(null!=(r=r.instance))continue}else if("<"===r.tag)for(var i=0;i<r.instance.length;i++)n.appendChild(r.instance[i]);else if("["!==r.tag)n.appendChild(r.dom);else if(1===r.children.length){if(null!=(r=r.children[0]))continue}else for(i=0;i<r.children.length;i++){var o=r.children[i];null!=o&&t(e,n,o)}break}}(t,i,e),S(t,i,r)}function S(t,e,n){null!=n?t.insertBefore(e,n):t.appendChild(e)}function x(t){if(null==t.attrs||null==t.attrs.contenteditable&&null==t.attrs.contentEditable)return!1;var e=t.children;if(null!=e&&1===e.length&&"<"===e[0].tag){var n=e[0].children;t.dom.innerHTML!==n&&(t.dom.innerHTML=n)}else if(null!=t.text||null!=e&&0!==e.length)throw new Error("Child node of a contenteditable must be trusted");return!0}function D(t,e,n,r){for(var i=n;i<r;i++){var o=e[i];null!=o&&E(t,o)}}function E(t,e){var n,r,i,o=0,l=e.state;"string"!=typeof e.tag&&"function"==typeof e.state.onbeforeremove&&(null!=(i=a.call(e.state.onbeforeremove,e))&&"function"==typeof i.then&&(o=1,n=i));e.attrs&&"function"==typeof e.attrs.onbeforeremove&&(null!=(i=a.call(e.attrs.onbeforeremove,e))&&"function"==typeof i.then&&(o|=2,r=i));if(s(e,l),o){if(null!=n){var u=function(){1&o&&((o&=2)||c())};n.then(u,u)}if(null!=r){u=function(){2&o&&((o&=1)||c())};r.then(u,u)}}else C(e),k(t,e);function c(){s(e,l),C(e),k(t,e)}}function O(t,e){for(var n=0;n<e.instance.length;n++)t.removeChild(e.instance[n])}function k(t,e){for(;null!=e.dom&&e.dom.parentNode===t;){if("string"!=typeof e.tag){if(null!=(e=e.instance))continue}else if("<"===e.tag)O(t,e);else{if("["!==e.tag&&(t.removeChild(e.dom),!Array.isArray(e.children)))break;if(1===e.children.length){if(null!=(e=e.children[0]))continue}else for(var n=0;n<e.children.length;n++){var r=e.children[n];null!=r&&k(t,r)}}break}}function C(t){if("string"!=typeof t.tag&&"function"==typeof t.state.onremove&&a.call(t.state.onremove,t),t.attrs&&"function"==typeof t.attrs.onremove&&a.call(t.attrs.onremove,t),"string"!=typeof t.tag)null!=t.instance&&C(t.instance);else{var e=t.children;if(Array.isArray(e))for(var n=0;n<e.length;n++){var r=e[n];null!=r&&C(r)}}}function P(t,e,r,i,o){if("key"!==e&&"is"!==e&&null!=i&&!I(e)&&(r!==i||function(t,e){return"value"===e||"checked"===e||"selectedIndex"===e||"selected"===e&&t.dom===l()||"option"===t.tag&&t.dom.parentNode===n.activeElement}(t,e)||"object"==typeof i)){if("o"===e[0]&&"n"===e[1])return B(t,e,i);if("xlink:"===e.slice(0,6))t.dom.setAttributeNS("http://www.w3.org/1999/xlink",e.slice(6),i);else if("style"===e)M(t.dom,r,i);else if(N(t,e,o)){if("value"===e){if(("input"===t.tag||"textarea"===t.tag)&&t.dom.value===""+i&&t.dom===l())return;if("select"===t.tag&&null!==r&&t.dom.value===""+i)return;if("option"===t.tag&&null!==r&&t.dom.value===""+i)return}"input"===t.tag&&"type"===e?t.dom.setAttribute(e,i):t.dom[e]=i}else"boolean"==typeof i?i?t.dom.setAttribute(e,""):t.dom.removeAttribute(e):t.dom.setAttribute("className"===e?"class":e,i)}}function T(t,e,n,r){if("key"!==e&&"is"!==e&&null!=n&&!I(e))if("o"!==e[0]||"n"!==e[1]||I(e))if("style"===e)M(t.dom,n,null);else if(!N(t,e,r)||"className"===e||"value"===e&&("option"===t.tag||"select"===t.tag&&-1===t.dom.selectedIndex&&t.dom===l())||"input"===t.tag&&"type"===e){var i=e.indexOf(":");-1!==i&&(e=e.slice(i+1)),!1!==n&&t.dom.removeAttribute("className"===e?"class":e)}else t.dom[e]=null;else B(t,e,void 0)}function I(t){return"oninit"===t||"oncreate"===t||"onupdate"===t||"onremove"===t||"onbeforeremove"===t||"onbeforeupdate"===t}function N(t,e,n){return void 0===n&&(t.tag.indexOf("-")>-1||null!=t.attrs&&t.attrs.is||"href"!==e&&"list"!==e&&"form"!==e&&"width"!==e&&"height"!==e)&&e in t.dom}var j=/[A-Z]/g;function R(t){return"-"+t.toLowerCase()}function z(t){return"-"===t[0]&&"-"===t[1]?t:"cssFloat"===t?"float":t.replace(j,R)}function M(t,e,n){if(e===n);else if(null==n)t.style.cssText="";else if("object"!=typeof n)t.style.cssText=n;else if(null==e||"object"!=typeof e)for(var r in t.style.cssText="",n){null!=(i=n[r])&&t.style.setProperty(z(r),String(i))}else{for(var r in n){var i;null!=(i=n[r])&&(i=String(i))!==String(e[r])&&t.style.setProperty(z(r),i)}for(var r in e)null!=e[r]&&null==n[r]&&t.style.removeProperty(z(r))}}function L(){this._=e}function B(t,e,n){if(null!=t.events){if(t.events[e]===n)return;null==n||"function"!=typeof n&&"object"!=typeof n?(null!=t.events[e]&&t.dom.removeEventListener(e.slice(2),t.events,!1),t.events[e]=void 0):(null==t.events[e]&&t.dom.addEventListener(e.slice(2),t.events,!1),t.events[e]=n)}else null==n||"function"!=typeof n&&"object"!=typeof n||(t.events=new L,t.dom.addEventListener(e.slice(2),t.events,!1),t.events[e]=n)}function U(t,e,n){"function"==typeof t.oninit&&a.call(t.oninit,e),"function"==typeof t.oncreate&&n.push(a.bind(t.oncreate,e))}function $(t,e,n){"function"==typeof t.onupdate&&n.push(a.bind(t.onupdate,e))}return L.prototype=Object.create(null),L.prototype.handleEvent=function(t){var e,n=this["on"+t.type];"function"==typeof n?e=n.call(t.currentTarget,t):"function"==typeof n.handleEvent&&n.handleEvent(t),this._&&!1!==t.redraw&&(0,this._)(),!1===e&&(t.preventDefault(),t.stopPropagation())},function(t,n,r){if(!t)throw new TypeError("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var i=[],s=l(),a=t.namespaceURI;null==t.vnodes&&(t.textContent=""),n=o.normalizeChildren(Array.isArray(n)?n:[n]);var u=e;try{e="function"==typeof r?r:void 0,g(t,t.vnodes,n,i,null,"http://www.w3.org/1999/xhtml"===a?void 0:a)}finally{e=u}t.vnodes=n,null!=s&&l()!==s&&"function"==typeof s.focus&&s.focus();for(var c=0;c<i.length;c++)i[c]()}}(window),_=function(t,e,n){var r=[],i=!1,s=!1;function a(){if(i)throw new Error("Nested m.redraw.sync() call");i=!0;for(var e=0;e<r.length;e+=2)try{t(r[e],o(r[e+1]),l)}catch(t){n.error(t)}i=!1}function l(){s||(s=!0,e((function(){s=!1,a()})))}return l.sync=a,{mount:function(e,n){if(null!=n&&null==n.view&&"function"!=typeof n)throw new TypeError("m.mount(element, component) expects a component, not a vnode");var i=r.indexOf(e);i>=0&&(r.splice(i,2),t(e,[],l)),null!=n&&(r.push(e,n),t(e,o(n),l))},redraw:l}}(y,requestAnimationFrame,console),b=function(t){if("[object Object]"!==Object.prototype.toString.call(t))return"";var e=[];for(var n in t)r(n,t[n]);return e.join("&");function r(t,n){if(Array.isArray(n))for(var i=0;i<n.length;i++)r(t+"["+i+"]",n[i]);else if("[object Object]"===Object.prototype.toString.call(n))for(var i in n)r(t+"["+i+"]",n[i]);else e.push(encodeURIComponent(t)+(null!=n&&""!==n?"="+encodeURIComponent(n):""))}},A=Object.assign||function(t,e){e&&Object.keys(e).forEach((function(n){t[n]=e[n]}))},S=function(t,e){if(/:([^\/\.-]+)(\.{3})?:/.test(t))throw new SyntaxError("Template parameter names *must* be separated");if(null==e)return t;var n=t.indexOf("?"),r=t.indexOf("#"),i=r<0?t.length:r,o=n<0?i:n,s=t.slice(0,o),a={};A(a,e);var l=s.replace(/:([^\/\.-]+)(\.{3})?/g,(function(t,n,r){return delete a[n],null==e[n]?t:r?e[n]:encodeURIComponent(String(e[n]))})),u=l.indexOf("?"),c=l.indexOf("#"),f=c<0?l.length:c,h=u<0?f:u,d=l.slice(0,h);n>=0&&(d+=t.slice(n,i)),u>=0&&(d+=(n<0?"?":"&")+l.slice(u,f));var p=b(a);return p&&(d+=(n<0&&u<0?"?":"&")+p),r>=0&&(d+=t.slice(r)),c>=0&&(d+=(r<0?"":"&")+l.slice(c)),d},x=function(t,e,n){var r=0;function i(t){return new e(t)}function o(t){return function(r,o){"string"!=typeof r?(o=r,r=r.url):null==o&&(o={});var s=new e((function(e,n){t(S(r,o.params),o,(function(t){if("function"==typeof o.type)if(Array.isArray(t))for(var n=0;n<t.length;n++)t[n]=new o.type(t[n]);else t=new o.type(t);e(t)}),n)}));if(!0===o.background)return s;var a=0;function l(){0==--a&&"function"==typeof n&&n()}return function t(e){var n=e.then;return e.constructor=i,e.then=function(){a++;var r=n.apply(e,arguments);return r.then(l,(function(t){if(l(),0===a)throw t})),t(r)},e}(s)}}function s(t,e){for(var n in t.headers)if({}.hasOwnProperty.call(t.headers,n)&&e.test(n))return!0;return!1}return i.prototype=e.prototype,i.__proto__=e,{request:o((function(e,n,r,i){var o,a=null!=n.method?n.method.toUpperCase():"GET",l=n.body,u=!(null!=n.serialize&&n.serialize!==JSON.serialize||l instanceof t.FormData),c=n.responseType||("function"==typeof n.extract?"":"json"),f=new t.XMLHttpRequest,h=!1,d=f,p=f.abort;for(var g in f.abort=function(){h=!0,p.call(this)},f.open(a,e,!1!==n.async,"string"==typeof n.user?n.user:void 0,"string"==typeof n.password?n.password:void 0),u&&null!=l&&!s(n,/^content-type$/i)&&f.setRequestHeader("Content-Type","application/json; charset=utf-8"),"function"==typeof n.deserialize||s(n,/^accept$/i)||f.setRequestHeader("Accept","application/json, text/*"),n.withCredentials&&(f.withCredentials=n.withCredentials),n.timeout&&(f.timeout=n.timeout),f.responseType=c,n.headers)({}).hasOwnProperty.call(n.headers,g)&&f.setRequestHeader(g,n.headers[g]);f.onreadystatechange=function(t){if(!h&&4===t.target.readyState)try{var o,s=t.target.status>=200&&t.target.status<300||304===t.target.status||/^file:\/\//i.test(e),a=t.target.response;if("json"===c?t.target.responseType||"function"==typeof n.extract||(a=JSON.parse(t.target.responseText)):c&&"text"!==c||null==a&&(a=t.target.responseText),"function"==typeof n.extract?(a=n.extract(t.target,n),s=!0):"function"==typeof n.deserialize&&(a=n.deserialize(a)),s)r(a);else{try{o=t.target.responseText}catch(t){o=a}var l=new Error(o);l.code=t.target.status,l.response=a,i(l)}}catch(t){i(t)}},"function"==typeof n.config&&(f=n.config(f,n,e)||f)!==d&&(o=f.abort,f.abort=function(){h=!0,o.call(this)}),null==l?f.send():"function"==typeof n.serialize?f.send(n.serialize(l)):l instanceof t.FormData?f.send(l):f.send(JSON.stringify(l))})),jsonp:o((function(e,n,i,o){var s=n.callbackName||"_mithril_"+Math.round(1e16*Math.random())+"_"+r++,a=t.document.createElement("script");t[s]=function(e){delete t[s],a.parentNode.removeChild(a),i(e)},a.onerror=function(){delete t[s],a.parentNode.removeChild(a),o(new Error("JSONP request failed"))},a.src=e+(e.indexOf("?")<0?"?":"&")+encodeURIComponent(n.callbackKey||"callback")+"="+encodeURIComponent(s),t.document.documentElement.appendChild(a)}))}}(window,w,_.redraw),D=function(t){if(""===t||null==t)return{};"?"===t.charAt(0)&&(t=t.slice(1));for(var e=t.split("&"),n={},r={},i=0;i<e.length;i++){var o=e[i].split("="),s=decodeURIComponent(o[0]),a=2===o.length?decodeURIComponent(o[1]):"";"true"===a?a=!0:"false"===a&&(a=!1);var l=s.split(/\]\[?|\[/),u=r;s.indexOf("[")>-1&&l.pop();for(var c=0;c<l.length;c++){var f=l[c],h=l[c+1],d=""==h||!isNaN(parseInt(h,10));if(""===f)null==n[s=l.slice(0,c).join()]&&(n[s]=Array.isArray(u)?u.length:0),f=n[s]++;else if("__proto__"===f)break;if(c===l.length-1)u[f]=a;else{var p=Object.getOwnPropertyDescriptor(u,f);null!=p&&(p=p.value),null==p&&(u[f]=p=d?[]:{}),u=p}}}return r},E=function(t){var e=t.indexOf("?"),n=t.indexOf("#"),r=n<0?t.length:n,i=e<0?r:e,o=t.slice(0,i).replace(/\/{2,}/g,"/");return o?("/"!==o[0]&&(o="/"+o),o.length>1&&"/"===o[o.length-1]&&(o=o.slice(0,-1))):o="/",{path:o,params:e<0?{}:D(t.slice(e+1,r))}},O=function(t){var e=E(t),n=Object.keys(e.params),r=[],i=new RegExp("^"+e.path.replace(/:([^\/.-]+)(\.{3}|\.(?!\.)|-)?|[\\^$*+.()|\[\]{}]/g,(function(t,e,n){return null==e?"\\"+t:(r.push({k:e,r:"..."===n}),"..."===n?"(.*)":"."===n?"([^/]+)\\.":"([^/]+)"+(n||""))}))+"$");return function(t){for(var o=0;o<n.length;o++)if(e.params[n[o]]!==t.params[n[o]])return!1;if(!r.length)return i.test(t.path);var s=i.exec(t.path);if(null==s)return!1;for(o=0;o<r.length;o++)t.params[r[o].k]=r[o].r?s[o+1]:decodeURIComponent(s[o+1]);return!0}},k={},C=function(t,n){var r;function i(e,n,i){if(e=S(e,n),null!=r){r();var o=i?i.state:null,s=i?i.title:null;i&&i.replace?t.history.replaceState(o,s,h.prefix+e):t.history.pushState(o,s,h.prefix+e)}else t.location.href=h.prefix+e}var s,a,l,u,c=k,f=h.SKIP={};function h(d,p,g){if(null==d)throw new Error("Ensure the DOM element that was passed to `m.route` is not undefined");var m,v=0,y=Object.keys(g).map((function(t){if("/"!==t[0])throw new SyntaxError("Routes must start with a `/`");if(/:([^\/\.-]+)(\.{3})?:/.test(t))throw new SyntaxError("Route parameter names must be separated with either `/`, `.`, or `-`");return{route:t,component:g[t],check:O(t)}})),_="function"==typeof e?e:setTimeout,b=w.resolve(),S=!1;if(r=null,null!=p){var x=E(p);if(!y.some((function(t){return t.check(x)})))throw new ReferenceError("Default route doesn't match any known routes")}function D(){S=!1;var e=t.location.hash;"#"!==h.prefix[0]&&(e=t.location.search+e,"?"!==h.prefix[0]&&"/"!==(e=t.location.pathname+e)[0]&&(e="/"+e));var r=e.concat().replace(/(?:%[a-f89][a-f0-9])+/gim,decodeURIComponent).slice(h.prefix.length),o=E(r);function d(){if(r===p)throw new Error("Could not resolve default route "+p);i(p,null,{replace:!0})}A(o.params,t.history.state),function t(e){for(;e<y.length;e++)if(y[e].check(o)){var i=y[e].component,h=y[e].route,p=i,g=u=function(h){if(g===u){if(h===f)return t(e+1);s=null==h||"function"!=typeof h.view&&"function"!=typeof h?"div":h,a=o.params,l=r,u=null,c=i.render?i:null,2===v?n.redraw():(v=2,n.redraw.sync())}};return void(i.view||"function"==typeof i?(i={},g(p)):i.onmatch?b.then((function(){return i.onmatch(o.params,r,h)})).then(g,d):g("div"))}d()}(0)}return r=function(){S||(S=!0,_(D))},"function"==typeof t.history.pushState?(m=function(){t.removeEventListener("popstate",r,!1)},t.addEventListener("popstate",r,!1)):"#"===h.prefix[0]&&(r=null,m=function(){t.removeEventListener("hashchange",D,!1)},t.addEventListener("hashchange",D,!1)),n.mount(d,{onbeforeupdate:function(){return!(!(v=v?2:1)||k===c)},oncreate:D,onremove:m,view:function(){if(v&&k!==c){var t=[o(s,a.key,a)];return c&&(t=c.render(t[0])),t}}})}return h.set=function(t,e,n){null!=u&&((n=n||{}).replace=!0),u=null,i(t,e,n)},h.get=function(){return l},h.prefix="#!",h.Link={view:function(t){var e,n,r=t.attrs.options,i={};A(i,t.attrs),i.selector=i.options=i.key=i.oninit=i.oncreate=i.onbeforeupdate=i.onupdate=i.onbeforeremove=i.onremove=null;var o=d(t.attrs.selector||"a",i,t.children);return(o.attrs.disabled=Boolean(o.attrs.disabled))?(o.attrs.href=null,o.attrs["aria-disabled"]="true",o.attrs.onclick=null):(e=o.attrs.onclick,n=o.attrs.href,o.attrs.href=h.prefix+n,o.attrs.onclick=function(t){var i;"function"==typeof e?i=e.call(t.currentTarget,t):null==e||"object"!=typeof e||"function"==typeof e.handleEvent&&e.handleEvent(t),!1===i||t.defaultPrevented||0!==t.button&&0!==t.which&&1!==t.which||t.currentTarget.target&&"_self"!==t.currentTarget.target||t.ctrlKey||t.metaKey||t.shiftKey||t.altKey||(t.preventDefault(),t.redraw=!1,h.set(n,null,r))}),o}},h.param=function(t){return a&&null!=t?a[t]:a},h}(window,_),P=function(){return p.apply(this,arguments)};P.m=p,P.trust=p.trust,P.fragment=p.fragment,P.mount=_.mount,P.route=C,P.render=y,P.redraw=_.redraw,P.request=x.request,P.jsonp=x.jsonp,P.parseQueryString=D,P.buildQueryString=b,P.parsePathname=E,P.buildPathname=S,P.vnode=o,P.PromisePolyfill=v;var T=P;const I=()=>({view:t=>{const e={[t.attrs.page]:"active"},n=[];window.authorizer.hasAccess("devices",1)&&n.push(T("li",{class:e.overview},T("a",{href:"#!/overview"},"Overview"))),window.authorizer.hasAccess("devices",2)&&n.push(T("li",{class:e.devices},T("a",{href:"#!/devices"},"Devices"))),window.authorizer.hasAccess("faults",2)&&n.push(T("li",{class:e.faults},T("a",{href:"#!/faults"},"Faults")));const r=["presets","provisions","virtualParameters","files"];for(const t of r)if(window.authorizer.hasAccess(t,2)){n.push(T("li",{class:e.admin},T("a",{href:"#!/admin"},"Admin")));break}return T("nav",T("ul",n))}});function N(t){if(!(this instanceof N))return new N(t);this._=t}var j=N.prototype;function R(t,e){for(var n=0;n<t;n++)e(n)}function z(t,e,n){return function(t,e){R(e.length,(function(n){t(e[n],n,e)}))}((function(n,r,i){e=t(e,n,r,i)}),n),e}function M(t,e){return z((function(e,n,r,i){return e.concat([t(n,r,i)])}),[],e)}function L(t){var e=z((function(t,e,n,i){return t.concat(n===i.length-1?r.from([e,0]).readUInt16BE(0):i.readUInt16BE(n))}),[],t);return r.from(M((function(t){return(t<<1&65535)>>8}),e))}function B(t){return t[0]>>7}function U(){return void 0!==r}function $(){if(!U())throw new Error("Buffer global does not exist; please use webpack if you need to parse Buffers in the browser.")}function F(t){$();var e=z((function(t,e){return t+e}),0,t);if(e%8!=0)throw new Error("The bits ["+t.join(", ")+"] add up to "+e+" which is not an even number of bytes; the total should be divisible by 8");var n,r=e/8,i=(n=function(t){return t>48},z((function(t,e){return t||(n(e)?e:t)}),null,t));if(i)throw new Error(i+" bit range requested exceeds 48 bit (6 byte) Number max.");return new N((function(e,n){var i=r+n;return i>e.length?tt(n,r.toString()+" bytes"):X(i,z((function(t,e){var n=function(t,e){var n={v:0,buf:e};return R(t,(function(){n={v:n.v<<1|B(n.buf),buf:L(n.buf)}})),n}(e,t.buf);return{coll:t.coll.concat(n.v),buf:n.buf}}),{coll:[],buf:e.slice(n,i)},t).coll)}))}function q(t,e){return new N((function(n,r){return $(),r+e>n.length?tt(r,e+" bytes for "+t):X(r+e,n.slice(r,r+e))}))}function W(t,e){if("number"!=typeof(n=e)||Math.floor(n)!==n||e<0||e>6)throw new Error(t+" requires integer length in range [0, 6].");var n}function J(t){return W("uintBE",t),q("uintBE("+t+")",t).map((function(e){return e.readUIntBE(0,t)}))}function Y(t){return W("uintLE",t),q("uintLE("+t+")",t).map((function(e){return e.readUIntLE(0,t)}))}function V(t){return W("intBE",t),q("intBE("+t+")",t).map((function(e){return e.readIntBE(0,t)}))}function H(t){return W("intLE",t),q("intLE("+t+")",t).map((function(e){return e.readIntLE(0,t)}))}function K(t){return Array.prototype.slice.call(t)}function G(t){return t instanceof N}function Q(t){return"[object Array]"==={}.toString.call(t)}function Z(t){return U()&&r.isBuffer(t)}function X(t,e){return{status:!0,index:t,value:e,furthest:-1,expected:[]}}function tt(t,e){return Q(e)||(e=[e]),{status:!1,index:-1,value:null,furthest:t,expected:e}}function et(t,e){if(!e)return t;if(t.furthest>e.furthest)return t;var n=t.furthest===e.furthest?function(t,e){if(function(){if(void 0!==N._supportsSet)return N._supportsSet;var t="undefined"!=typeof Set;return N._supportsSet=t,t}()&&Array.from){for(var n=new Set(t),r=0;r<e.length;r++)n.add(e[r]);var i=Array.from(n);return i.sort(),i}for(var o={},s=0;s<t.length;s++)o[t[s]]=!0;for(var a=0;a<e.length;a++)o[e[a]]=!0;var l=[];for(var u in o)({}).hasOwnProperty.call(o,u)&&l.push(u);return l.sort(),l}(t.expected,e.expected):e.expected;return{status:t.status,index:t.index,value:t.value,furthest:e.furthest,expected:n}}var nt={};function rt(t,e){if(Z(t))return{offset:e,line:-1,column:-1};if(nt.input===t&&nt.i===e)return nt.value;var n=t.slice(0,e).split("\n"),r={offset:e,line:n.length,column:n[n.length-1].length+1};return nt.input=t,nt.i=e,nt.value=r,r}function it(t){if(!G(t))throw new Error("not a parser: "+t)}function ot(t,e){return"string"==typeof t?t.charAt(e):t[e]}function st(t){if("number"!=typeof t)throw new Error("not a number: "+t)}function at(t){if(!(t instanceof RegExp))throw new Error("not a regexp: "+t);for(var e=gt(t),n=0;n<e.length;n++){var r=e.charAt(n);if("i"!==r&&"m"!==r&&"u"!==r&&"s"!==r)throw new Error('unsupported regexp flag "'+r+'": '+t)}}function lt(t){if("function"!=typeof t)throw new Error("not a function: "+t)}function ut(t){if("string"!=typeof t)throw new Error("not a string: "+t)}function ct(t,e){return new Array(e+1).join(t)}function ft(t,e,n){var r=e-t.length;return r<=0?t:ct(n,r)+t}function ht(t,e,n,r){return{from:t-e>0?t-e:0,to:t+n>r?r:t+n}}function dt(t,e){var n,r,i,o,s,a=e.index,l=a.offset,u=1;if(l===t.length)return"Got the end of the input";if(Z(t)){var c=l-l%8,f=l-c,h=ht(c,40,40,t.length),d=M((function(t){return M((function(t){return ft(t.toString(16),2,"0")}),t)}),function(t,e){var n=t.length,r=[],i=0;if(n<=e)return[t.slice()];for(var o=0;o<n;o++)r[i]||r.push([]),r[i].push(t[o]),(o+1)%e==0&&i++;return r}(t.slice(h.from,h.to).toJSON().data,8));o=function(t){return 0===t.from&&1===t.to?{from:t.from,to:t.to}:{from:t.from/8,to:Math.floor(t.to/8)}}(h),r=c/8,n=3*f,f>=4&&(n+=1),u=2,i=M((function(t){return t.length<=4?t.join(" "):t.slice(0,4).join(" ")+"  "+t.slice(4).join(" ")}),d),(s=(8*(o.to>0?o.to-1:o.to)).toString(16).length)<2&&(s=2)}else{var p=t.split(/\r\n|[\n\r\u2028\u2029]/);n=a.column-1,r=a.line-1,o=ht(r,2,3,p.length),i=p.slice(o.from,o.to),s=o.to.toString().length}var g=r-o.from;return Z(t)&&(s=(8*(o.to>0?o.to-1:o.to)).toString(16).length)<2&&(s=2),z((function(e,r,i){var a,l=i===g,c=l?"> ":"  ";return a=Z(t)?ft((8*(o.from+i)).toString(16),s,"0"):ft((o.from+i+1).toString(),s," "),[].concat(e,[c+a+" | "+r],l?["  "+ct(" ",s)+" | "+ft("",n," ")+ct("^",u)]:[])}),[],i).join("\n")}function pt(t,e){return["\n","-- PARSING FAILED "+ct("-",50),"\n\n",dt(t,e),"\n\n",(n=e.expected,1===n.length?"Expected:\n\n"+n[0]:"Expected one of the following: \n\n"+n.join(", ")),"\n"].join("");var n}function gt(t){return void 0!==t.flags?t.flags:[t.global?"g":"",t.ignoreCase?"i":"",t.multiline?"m":"",t.unicode?"u":"",t.sticky?"y":""].join("")}function mt(t){return RegExp("^(?:"+t.source+")",gt(t))}function vt(){for(var t=[].slice.call(arguments),e=t.length,n=0;n<e;n+=1)it(t[n]);return N((function(n,r){for(var i,o=new Array(e),s=0;s<e;s+=1){if(!(i=et(t[s]._(n,r),i)).status)return i;o[s]=i.value,r=i.index}return et(X(r,o),i)}))}function wt(){var t=[].slice.call(arguments);if(0===t.length)throw new Error("seqMap needs at least one argument");var e=t.pop();return lt(e),vt.apply(null,t).map((function(t){return e.apply(null,t)}))}function yt(){var t=[].slice.call(arguments),e=t.length;if(0===e)return Dt("zero alternates");for(var n=0;n<e;n+=1)it(t[n]);return N((function(e,n){for(var r,i=0;i<t.length;i+=1)if((r=et(t[i]._(e,n),r)).status)return r;return r}))}function _t(t,e){return bt(t,e).or(xt([]))}function bt(t,e){return it(t),it(e),wt(t,e.then(t).many(),(function(t,e){return[t].concat(e)}))}function At(t){ut(t);var e="'"+t+"'";return N((function(n,r){var i=r+t.length,o=n.slice(r,i);return o===t?X(i,o):tt(r,e)}))}function St(t,e){at(t),arguments.length>=2?st(e):e=0;var n=mt(t),r=""+t;return N((function(t,i){var o=n.exec(t.slice(i));if(o){if(0<=e&&e<=o.length){var s=o[0],a=o[e];return X(i+s.length,a)}return tt(i,"valid match group (0 to "+o.length+") in "+r)}return tt(i,r)}))}function xt(t){return N((function(e,n){return X(n,t)}))}function Dt(t){return N((function(e,n){return tt(n,t)}))}function Et(t){if(G(t))return N((function(e,n){var r=t._(e,n);return r.index=n,r.value="",r}));if("string"==typeof t)return Et(At(t));if(t instanceof RegExp)return Et(St(t));throw new Error("not a string, regexp, or parser: "+t)}function Ot(t){return it(t),N((function(e,n){var r=t._(e,n),i=e.slice(n,r.index);return r.status?tt(n,'not "'+i+'"'):X(n,null)}))}function kt(t){return lt(t),N((function(e,n){var r=ot(e,n);return n<e.length&&t(r)?X(n+1,r):tt(n,"a character/byte matching "+t)}))}function Ct(t,e){arguments.length<2&&(e=t,t=void 0);var n=N((function(t,r){return n._=e()._,n._(t,r)}));return t?n.desc(t):n}function Pt(){return Dt("fantasy-land/empty")}j.parse=function(t){if("string"!=typeof t&&!Z(t))throw new Error(".parse must be called with a string or Buffer as its argument");var e=this.skip(jt)._(t,0);return e.status?{status:!0,value:e.value}:{status:!1,index:rt(t,e.furthest),expected:e.expected}},j.tryParse=function(t){var e=this.parse(t);if(e.status)return e.value;var n=pt(t,e),r=new Error(n);throw r.type="ParsimmonError",r.result=e,r},j.assert=function(t,e){return this.chain((function(n){return t(n)?xt(n):Dt(e)}))},j.or=function(t){return yt(this,t)},j.trim=function(t){return this.wrap(t,t)},j.wrap=function(t,e){return wt(t,this,e,(function(t,e){return e}))},j.thru=function(t){return t(this)},j.then=function(t){return it(t),vt(this,t).map((function(t){return t[1]}))},j.many=function(){var t=this;return N((function(e,n){for(var r=[],i=void 0;;){if(!(i=et(t._(e,n),i)).status)return et(X(n,r),i);if(n===i.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");n=i.index,r.push(i.value)}}))},j.tieWith=function(t){return ut(t),this.map((function(e){if(function(t){if(!Q(t))throw new Error("not an array: "+t)}(e),e.length){ut(e[0]);for(var n=e[0],r=1;r<e.length;r++)ut(e[r]),n+=t+e[r];return n}return""}))},j.tie=function(){return this.tieWith("")},j.times=function(t,e){var n=this;return arguments.length<2&&(e=t),st(t),st(e),N((function(r,i){for(var o=[],s=void 0,a=void 0,l=0;l<t;l+=1){if(a=et(s=n._(r,i),a),!s.status)return a;i=s.index,o.push(s.value)}for(;l<e&&(a=et(s=n._(r,i),a),s.status);l+=1)i=s.index,o.push(s.value);return et(X(i,o),a)}))},j.result=function(t){return this.map((function(){return t}))},j.atMost=function(t){return this.times(0,t)},j.atLeast=function(t){return wt(this.times(t),this.many(),(function(t,e){return t.concat(e)}))},j.map=function(t){lt(t);var e=this;return N((function(n,r){var i=e._(n,r);return i.status?et(X(i.index,t(i.value)),i):i}))},j.contramap=function(t){lt(t);var e=this;return N((function(n,r){var i=e.parse(t(n.slice(r)));return i.status?X(r+n.length,i.value):i}))},j.promap=function(t,e){return lt(t),lt(e),this.contramap(t).map(e)},j.skip=function(t){return vt(this,t).map((function(t){return t[0]}))},j.mark=function(){return wt(Tt,this,Tt,(function(t,e,n){return{start:t,value:e,end:n}}))},j.node=function(t){return wt(Tt,this,Tt,(function(e,n,r){return{name:t,value:n,start:e,end:r}}))},j.sepBy=function(t){return _t(this,t)},j.sepBy1=function(t){return bt(this,t)},j.lookahead=function(t){return this.skip(Et(t))},j.notFollowedBy=function(t){return this.skip(Ot(t))},j.desc=function(t){Q(t)||(t=[t]);var e=this;return N((function(n,r){var i=e._(n,r);return i.status||(i.expected=t),i}))},j.fallback=function(t){return this.or(xt(t))},j.ap=function(t){return wt(t,this,(function(t,e){return t(e)}))},j.chain=function(t){var e=this;return N((function(n,r){var i=e._(n,r);return i.status?et(t(i.value)._(n,i.index),i):i}))},j.concat=j.or,j.empty=Pt,j.of=xt,j["fantasy-land/ap"]=j.ap,j["fantasy-land/chain"]=j.chain,j["fantasy-land/concat"]=j.concat,j["fantasy-land/empty"]=j.empty,j["fantasy-land/of"]=j.of,j["fantasy-land/map"]=j.map;var Tt=N((function(t,e){return X(e,rt(t,e))})),It=N((function(t,e){return e>=t.length?tt(e,"any character/byte"):X(e+1,ot(t,e))})),Nt=N((function(t,e){return X(t.length,t.slice(e))})),jt=N((function(t,e){return e<t.length?tt(e,"EOF"):X(e,null)})),Rt=St(/[0-9]/).desc("a digit"),zt=St(/[0-9]*/).desc("optional digits"),Mt=St(/[a-z]/i).desc("a letter"),Lt=St(/[a-z]*/i).desc("optional letters"),Bt=St(/\s*/).desc("optional whitespace"),Ut=St(/\s+/).desc("whitespace"),$t=At("\r"),Ft=At("\n"),qt=At("\r\n"),Wt=yt(qt,Ft,$t).desc("newline"),Jt=yt(Wt,jt);N.all=Nt,N.alt=yt,N.any=It,N.cr=$t,N.createLanguage=function(t){var e={};for(var n in t)({}).hasOwnProperty.call(t,n)&&function(n){e[n]=Ct((function(){return t[n](e)}))}(n);return e},N.crlf=qt,N.custom=function(t){return N(t(X,tt))},N.digit=Rt,N.digits=zt,N.empty=Pt,N.end=Jt,N.eof=jt,N.fail=Dt,N.formatError=pt,N.index=Tt,N.isParser=G,N.lazy=Ct,N.letter=Mt,N.letters=Lt,N.lf=Ft,N.lookahead=Et,N.makeFailure=tt,N.makeSuccess=X,N.newline=Wt,N.noneOf=function(t){return kt((function(e){return t.indexOf(e)<0})).desc("none of '"+t+"'")},N.notFollowedBy=Ot,N.of=xt,N.oneOf=function(t){for(var e=t.split(""),n=0;n<e.length;n++)e[n]="'"+e[n]+"'";return kt((function(e){return t.indexOf(e)>=0})).desc(e)},N.optWhitespace=Bt,N.Parser=N,N.range=function(t,e){return kt((function(n){return t<=n&&n<=e})).desc(t+"-"+e)},N.regex=St,N.regexp=St,N.sepBy=_t,N.sepBy1=bt,N.seq=vt,N.seqMap=wt,N.seqObj=function(){for(var t={},e=0,n=K(arguments),r=n.length,i=0;i<r;i+=1){var o=n[i];if(!G(o)){if(Q(o)){var s=2===o.length&&"string"==typeof o[0]&&G(o[1]);if(s){var a=o[0];if(Object.prototype.hasOwnProperty.call(t,a))throw new Error("seqObj: duplicate key "+a);t[a]=!0,e++;continue}}throw new Error("seqObj arguments must be parsers or [string, parser] array pairs.")}}if(0===e)throw new Error("seqObj expects at least one named parser, found zero");return N((function(t,e){for(var i,o={},s=0;s<r;s+=1){var a,l;if(Q(n[s])?(a=n[s][0],l=n[s][1]):(a=null,l=n[s]),!(i=et(l._(t,e),i)).status)return i;a&&(o[a]=i.value),e=i.index}return et(X(e,o),i)}))},N.string=At,N.succeed=xt,N.takeWhile=function(t){return lt(t),N((function(e,n){for(var r=n;r<e.length&&t(ot(e,r));)r++;return X(r,e.slice(n,r))}))},N.test=kt,N.whitespace=Ut,N["fantasy-land/empty"]=Pt,N["fantasy-land/of"]=xt,N.Binary={bitSeq:F,bitSeqObj:function(t){$();var e={},n=0,r=M((function(t){if(Q(t)){var r=t;if(2!==r.length)throw new Error("["+r.join(", ")+"] should be length 2, got length "+r.length);if(ut(r[0]),st(r[1]),Object.prototype.hasOwnProperty.call(e,r[0]))throw new Error("duplicate key in bitSeqObj: "+r[0]);return e[r[0]]=!0,n++,r}return st(t),[null,t]}),t);if(n<1)throw new Error("bitSeqObj expects at least one named pair, got ["+t.join(", ")+"]");var i=M((function(t){return t[0]}),r);return F(M((function(t){return t[1]}),r)).map((function(t){return z((function(t,e){return null!==e[0]&&(t[e[0]]=e[1]),t}),{},M((function(e,n){return[e,t[n]]}),i))}))},byte:function(t){if($(),st(t),t>255)throw new Error("Value specified to byte constructor ("+t+"=0x"+t.toString(16)+") is larger in value than a single byte.");var e=(t>15?"0x":"0x0")+t.toString(16);return N((function(n,r){var i=ot(n,r);return i===t?X(r+1,i):tt(r,e)}))},buffer:function(t){return q("buffer",t).map((function(t){return r.from(t)}))},encodedString:function(t,e){return q("string",e).map((function(e){return e.toString(t)}))},uintBE:J,uint8BE:J(1),uint16BE:J(2),uint32BE:J(4),uintLE:Y,uint8LE:Y(1),uint16LE:Y(2),uint32LE:Y(4),intBE:V,int8BE:V(1),int16BE:V(2),int32BE:V(4),intLE:H,int8LE:H(1),int16LE:H(2),int32LE:H(4),floatBE:q("floatBE",4).map((function(t){return t.readFloatBE(0)})),floatLE:q("floatLE",4).map((function(t){return t.readFloatLE(0)})),doubleBE:q("doubleBE",8).map((function(t){return t.readDoubleBE(0)})),doubleLE:q("doubleLE",8).map((function(t){return t.readDoubleLE(0)}))};var Yt=N;function Vt(t){const e={b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};return t.replace(/\\(u[0-9a-fA-F]{4}|[^u])/,(t,n)=>{const r=n.charAt(0),i=n.slice(1);return"u"===r?String.fromCharCode(parseInt(i,16)):e.hasOwnProperty(r)?e[r]:r})}function Ht(t,e){if(!Array.isArray(t))return e(t);let n;for(let r=1;r<t.length;++r){const i=Ht(t[r],e);i!==t[r]&&(n=n||t.slice(),n[r]=i)}return e(n||t)}function Kt(t,e){return Yt.seqMap(e,Yt.seq(t,e).many(),(t,e)=>e.reduce((t,e)=>{const[n,r]=e;return Array.isArray(t)&&n===t[0]?t.concat([r]):Array.isArray(r)&&n===r[0]?[n,t].concat(r.slice(1)):[n,t,r]},t))}const Gt=Yt.createLanguage({ComparisonOperator:function(){return Yt.alt(Yt.string(">="),Yt.string("<>"),Yt.string("<="),Yt.string("="),Yt.string(">"),Yt.string("<")).skip(Yt.optWhitespace)},LikeOperator:function(){return Yt.alt(Yt.regexp(/like/i).result("LIKE").desc("LIKE"),Yt.regexp(/not\s+like/i).result("NOT LIKE").desc("NOT LIKE")).notFollowedBy(Yt.regexp(/[a-zA-Z0-9_]/)).skip(Yt.optWhitespace)},IsNullOperator:function(){return Yt.alt(Yt.regexp(/is\s+null/i).result("IS NULL").desc("IS NULL"),Yt.regexp(/is\s+not\s+null/i).result("IS NOT NULL").desc("IS NOT NULL")).notFollowedBy(Yt.regexp(/[a-zA-Z0-9_]/)).skip(Yt.optWhitespace)},NotOperator:function(){return Yt.regexp(/not/i).result("NOT").notFollowedBy(Yt.regexp(/[a-zA-Z0-9_]/)).skip(Yt.optWhitespace).desc("NOT")},AndOperator:function(){return Yt.regexp(/and/i).result("AND").notFollowedBy(Yt.regexp(/[a-zA-Z0-9_]/)).skip(Yt.optWhitespace).desc("AND")},OrOperator:function(){return Yt.regexp(/or/i).result("OR").notFollowedBy(Yt.regexp(/[a-zA-Z0-9_]/)).skip(Yt.optWhitespace).desc("OR")},Parameter:function(t){return Yt.alt(Yt.regexp(/[a-zA-Z0-9_.*-]+/),t.Expression.wrap(Yt.string("{").skip(Yt.optWhitespace),Yt.string("}"))).atLeast(1).map(t=>["PARAM",t.length>1?["||"].concat(t):t[0]]).skip(Yt.optWhitespace).desc("parameter")},StringValueSql:function(){return Yt.regexp(/'([^']*)'/,1).atLeast(1).skip(Yt.optWhitespace).map(t=>t.join("'")).desc("string")},StringValueJs:function(){return Yt.regexp(/"((?:\\.|.)*?)"/,1).skip(Yt.optWhitespace).map(Vt).desc("string")},NumberValue:function(){return Yt.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).notFollowedBy(Yt.regexp(/[a-zA-Z0-9_]/)).skip(Yt.optWhitespace).map(Number).desc("number")},BooleanValue:function(){return Yt.alt(Yt.regexp(/true/i).result(!0).desc("TRUE"),Yt.regexp(/false/i).result(!1).desc("FALSE")).notFollowedBy(Yt.regexp(/[a-zA-Z0-9_]/)).skip(Yt.optWhitespace)},NullValue:function(){return Yt.regexp(/null/i).notFollowedBy(Yt.regexp(/[a-zA-Z0-9_]/)).skip(Yt.optWhitespace).result(null).desc("NULL")},FuncValue:function(t){return Yt.seqMap(Yt.regexp(/([a-zA-Z0-9_]+)/,1).skip(Yt.optWhitespace).desc("function"),t.ExpressionList.wrap(Yt.string("(").skip(Yt.optWhitespace),Yt.string(")").skip(Yt.optWhitespace)),(t,e)=>["FUNC",t.toUpperCase()].concat(e))},WhenPair:function(t){return Yt.seq(Yt.regexp(/when/i).notFollowedBy(Yt.regexp(/[a-zA-Z0-9_]/)).skip(Yt.optWhitespace).desc("WHEN").then(t.Expression),Yt.regexp(/then/i).notFollowedBy(Yt.regexp(/[a-zA-Z0-9_]/)).skip(Yt.optWhitespace).desc("THEN").then(t.Expression))},CaseStatement:function(t){return Yt.seqMap(Yt.regexp(/case/i).result("CASE").notFollowedBy(Yt.regexp(/[a-zA-Z0-9_]/)).skip(Yt.optWhitespace).desc("CASE"),t.WhenPair.many(),Yt.regexp(/else/i).notFollowedBy(Yt.regexp(/[a-zA-Z0-9_]/)).skip(Yt.optWhitespace).desc("ELSE").then(t.Expression).map(t=>[[!0,t]]).fallback(null).skip(Yt.regex(/end/i).notFollowedBy(Yt.regexp(/[a-zA-Z0-9_]/))).skip(Yt.optWhitespace),(...t)=>t.flat(2))},Value:function(t){return Yt.alt(t.NullValue,t.BooleanValue,t.NumberValue,t.StringValueSql,t.StringValueJs,t.FuncValue,t.CaseStatement)},ValueExpression:function(t){return Kt(Yt.string("||").skip(Yt.optWhitespace),Kt(Yt.alt(Yt.string("+"),Yt.string("-")).skip(Yt.optWhitespace),Kt(Yt.alt(Yt.string("*"),Yt.string("/")).skip(Yt.optWhitespace),Yt.alt(t.Value,t.Parameter,t.Expression.wrap(Yt.string("(").skip(Yt.optWhitespace),Yt.string(")").skip(Yt.optWhitespace))))))},Comparison:function(t){return Yt.alt(Yt.seqMap(t.ValueExpression,t.IsNullOperator,(t,e)=>[e,t]),Yt.seqMap(t.ValueExpression,t.ComparisonOperator,t.ValueExpression,(t,e,n)=>[e,t,n]),Yt.seqMap(t.ValueExpression,t.LikeOperator,t.ValueExpression.skip(Yt.regexp(/escape/i).result("ESCAPE").skip(Yt.whitespace).desc("ESCAPE")),t.ValueExpression,(t,e,n,r)=>[e,t,n,r]),Yt.seqMap(t.ValueExpression,t.LikeOperator,t.ValueExpression,(t,e,n)=>[e,t,n]))},ExpressionList:function(t){return t.Expression.sepBy(Yt.string(",").skip(Yt.optWhitespace))},Expression:function(t){return Kt(t.OrOperator,Kt(t.AndOperator,(e=t.NotOperator,n=t.Comparison.or(t.ValueExpression),Yt.seq(e,n).or(n)))).trim(Yt.optWhitespace);var e,n}});function Qt(t){return t?Gt.Expression.tryParse(t):null}function Zt(t,e=0){if(!Array.isArray(t))return JSON.stringify(t);const n={OR:10,AND:11,NOT:12,"=":20,"<>":20,">":20,">=":20,"<":20,"<=":20,LIKE:20,"NOT LIKE":20,"IS NULL":20,"IS NOT NULL":20,"||":30,"+":31,"-":31,"*":32,"/":32},r=t[0].toUpperCase();function i(t){return n[r]<=e?`(${t})`:t}if("FUNC"===r)return i(`${t[1]}(${t.slice(2).map(t=>Zt(t)).join(", ")})`);if("PARAM"===r)return"string"==typeof t[1]?i(t[1]):Array.isArray(t[1])&&"||"===t[1][0]?i(t[1].slice(1).map(t=>"string"==typeof t?t:`{${Zt(t)}}`).join("")):i(`{${Zt(t[1])}}`);if("IS NULL"===r||"IS NOT NULL"===r)return i(`${Zt(t[1],n[r])} ${r}`);if("LIKE"===r||"NOT LIKE"===r)return t[3]?i(`${Zt(t[1],n[r])} ${r} ${Zt(t[2],n[r])} ESCAPE ${Zt(t[3],n[r])}`):i(`${Zt(t[1],n[r])} ${r} ${Zt(t[2],n[r])}`);if("CASE"===r){const e=["CASE"];for(let n=1;n<t.length-1;n+=2){if(!Array.isArray(t[n])&&t[n]){null!=t[n+1]&&e.push("ELSE",Zt(t[n+1]));break}e.push("WHEN",Zt(t[n]),"THEN",Zt(t[n+1]))}return e.push("END"),e.join(" ")}if(r in n){const e=t.slice(1).map((e,r)=>Zt(e,n[t[0]]+Math.min(r-1,0)));return i("NOT"===r?`${r} ${e[0]}`:e.join(` ${r} `))}throw new Error("Unrecognized operator "+t[0])}const Xt=Array.isArray,te=new WeakMap,ee={};function ne(t,e){let n=!0;for(;n;){n=!1;for(let r=2;r<t.length;++r){const i=e(t[r-1],t[r],r-2);i!==ee&&(n=!0,(t=t.slice()).splice(r-1,2,i))}}return 2===t.length?t[1]:t}function re(t,e="",n=""){const r={"-":"\\-","/":"\\/","\\":"\\/","^":"\\^",$:"\\$","*":"\\*","+":"\\+","?":"\\?",".":"\\.","(":"\\(",")":"\\)","|":"\\|","[":"\\[","]":"\\]","{":"\\{","}":"\\}","\\%":".*","\\_":"."};let i=function(t,e){const n=t.split("");for(let t=0;t<n.length;++t){const r=n[t];if(r===e)n[t]=n[t+1]||"",n[t+1]="";else if("_"===r)n[t]="\\_";else if("%"===r)for(n[t]="\\%";"%"===n[t+1];)n[++t]=""}return n.filter(t=>t)}(t,e);if(!i.length)return new RegExp("^$",n);i=i.map(t=>r[t]||t),i[0]=".*"===i[0]?"":"^"+i[0];const o=i.length-1;return i[o]=[".*",""].includes(i[o])?"":i[o]+"$",new RegExp(i.join(""),n)}function ie(t,e){return"boolean"==typeof t&&(t=+t),"boolean"==typeof e&&(e=+e),typeof t!=typeof e?"string"==typeof t?1:-1:t>e?1:t<e?-1:0}function oe(t){switch(typeof t){case"number":return t;case"boolean":return+t;case"string":return parseFloat(t)||0}}function se(t){switch(typeof t){case"string":return t;case"number":return t.toString();case"boolean":return(+t).toString()}}function ae(t){if(!Array.isArray(t))return t;if("CASE"===t[0]){for(let e=1;e<t.length;e+=2){if(Array.isArray(t[e]))return t;if(t[e])return t[e+1]}return null}if("FUNC"===t[0]){if("COALESCE"===t[1]){const e=[];for(let n=2;n<t.length;++n){const r=t[n];if(null!=r&&(e.push(r),!Array.isArray(r)))break}return e.length?1===e.length?e[0]:["FUNC","COALESCE",...e]:null}if("UPPER"===t[1]){if(null==t[2])return null;if(!Xt(t[2]))return se(t[2]).toUpperCase()}else if("LOWER"===t[1]){if(null==t[2])return null;if(!Xt(t[2]))return se(t[2]).toLowerCase()}}else if("PARAM"===t[0]){if(null==t[1])return null}else{if("AND"===t[0]){for(let e=1;e<t.length;++e)if(!Array.isArray(t[e])&&null!=t[e]&&!t[e])return!1;const e=[];for(let n=1;n<t.length;++n){const r=t[n];if(null==r)return null;Array.isArray(r)&&("AND"===r[0]?e.push(...r.slice(1)):e.push(r))}return!e.length||(1===e.length&&e.push(!0),["AND",...e])}if("OR"===t[0]){const e=[];for(let n=1;n<t.length;++n){const r=t[n];if(Array.isArray(r))"OR"===r[0]?e.push(...r.slice(1)):e.push(r);else if(r)return!0}return e.length?(1===e.length&&e.push(!1),["OR",...e]):!!t.some(t=>null==t)&&null}if("NOT"===t[0]){if(null==t[1])return null;if(!Xt(t[1]))return!t[1];if("NOT"===t[1][0])return t[1][1]}else{if("IS NULL"===t[0])return Xt(t[1])?t:null==t[1]||null;if("IS NOT NULL"===t[0])return Xt(t[1])?t:null!=t[1]||null;if("LIKE"===t[0]){if(Xt(t[1])||Xt(t[2])||Xt(t[3]))return t;if(null==t[1]||null==t[2]||t.length>=4&&null==t[3])return null;let e=te.get(t);return e||(e=re(t[2],t[3]),te.set(t,e)),e.test(t[1])}if("NOT LIKE"===t[0]){if(Xt(t[1])||Xt(t[2])||Xt(t[3]))return t;if(null==t[1]||null==t[2]||t.length>=4&&null==t[3])return null;let e=te.get(t);return e||(e=re(t[2],t[3]),te.set(t,e)),!e.test(t[1])}if("="===t[0])return null==t[1]||null==t[2]?null:Xt(t[1])||Xt(t[2])?t:0===ie(t[1],t[2]);if("<>"===t[0])return null==t[1]||null==t[2]?null:Xt(t[1])||Xt(t[2])?t:0!==ie(t[1],t[2]);if(">"===t[0])return null==t[1]||null==t[2]?null:Xt(t[1])||Xt(t[2])?t:ie(t[1],t[2])>0;if(">="===t[0])return null==t[1]||null==t[2]?null:Xt(t[1])||Xt(t[2])?t:ie(t[1],t[2])>=0;if("<"===t[0])return null==t[1]||null==t[2]?null:Xt(t[1])||Xt(t[2])?t:ie(t[1],t[2])<0;if("<="===t[0])return null==t[1]||null==t[2]?null:Xt(t[1])||Xt(t[2])?t:ie(t[1],t[2])<=0;if("*"===t[0])return ne(t,(t,e)=>null==t||null==e?null:Xt(t)||Xt(e)?ee:oe(t)*oe(e));if("/"===t[0])return ne(t,(t,e,n)=>null==t||null==e?null:Xt(t)||Xt(e)?ee:0===n?oe(t)/oe(e):oe(t)*oe(e));if("+"===t[0])return ne(t,(t,e)=>null==t||null==e?null:Xt(t)||Xt(e)?ee:oe(t)+oe(e));if("-"===t[0])return ne(t,(t,e,n)=>null==t||null==e?null:Xt(t)||Xt(e)?ee:0===n?oe(t)-oe(e):oe(t)+oe(e));if("||"===t[0])return ne(t,(t,e)=>null==t||null==e?null:Xt(t)||Xt(e)?ee:se(t)+se(e))}}return t}function le(t,e,n,r){return Ht(t,t=>{if(r&&(t=r(t)),!Xt(t))return t;if("FUNC"===t[0]&&"NOW"===t[1]){if(n)return n}else if("PARAM"===t[0]){if(null==t[1])return null;if(e&&!Xt(t[1])){let n;return n="function"==typeof e?e(t[1]):e[t[1]],null==n?null:("object"==typeof n&&(n=n.value?n.value[0]:null),n)}}return ae(t)})}function ue(t,e){if(null!=t&&!t)return!1;if(null!=e&&!e)return!1;if(!Array.isArray(t)&&!Array.isArray(e))return null!=t&&null!=e||null;if(!Array.isArray(e)&&"AND"===t[0])return t;if(!Array.isArray(t)&&"AND"===e[0])return e;const n=["AND"];return Array.isArray(t)&&"AND"===t[0]?n.push(...t.slice(1)):n.push(t),Array.isArray(e)&&"AND"===e[0]?n.push(...e.slice(1)):n.push(e),n}function ce(t,e){if(!Array.isArray(t)&&t)return!0;if(!Array.isArray(e)&&e)return!0;if(!Array.isArray(t)&&!Array.isArray(e))return(null==t||null==e)&&null;if(!Array.isArray(e)&&"OR"===t[0])return t;if(!Array.isArray(t)&&"OR"===e[0])return e;const n=["OR"];return Array.isArray(t)&&"OR"===t[0]?n.push(...t.slice(1)):n.push(t),Array.isArray(e)&&"OR"===e[0]?n.push(...e.slice(1)):n.push(e),n}let fe=new Map,he=new Map;const de=new WeakMap;function pe(t){if(null===t)return"null";if(void 0===t)return"undefined";const e=typeof t;if("number"===e||"boolean"===e||"string"===e)return`${e}:${t}`;if("function"!==e&&"object"!==e)throw new Error(`Cannot memoize ${e} arguments`);let n=de.get(t);if(!n){n=`${e}:${Math.trunc(Math.random()*Number.MAX_SAFE_INTEGER).toString(36)}`,de.set(t,n)}return n}function ge(t){const e=pe(t);return(...n)=>{const r=JSON.stringify(n.map(pe))+e;if(fe.has(r))return fe.get(r);let i;return i=he.has(r)?he.get(r):t(...n),fe.set(r,i),i}}const me=setInterval(()=>{he=fe,fe=new Map},12e4);me.unref&&me.unref();const ve=new Set;function we(t,e,n){const r={type:t,message:e,timestamp:Date.now(),actions:n};return ve.add(r),T.redraw(),n||setTimeout(()=>{ye(r)},4e3),r}function ye(t){ve.delete(t),T.redraw()}const _e=window.clientConfig,be=window.configSnapshot,Ae=window.genieacsVersion;class Se extends Array{constructor(t,e){if(t>Se.__kMaxLength)throw new RangeError("Maximum BigInt size exceeded");super(t),this.sign=e}static BigInt(t){var e=Math.floor,n=Number.isFinite;if("number"==typeof t){if(0===t)return Se.__zero();if((0|t)===t)return 0>t?Se.__oneDigit(-t,!0):Se.__oneDigit(t,!1);if(!n(t)||e(t)!==t)throw new RangeError("The number "+t+" cannot be converted to BigInt because it is not an integer");return Se.__fromDouble(t)}if("string"==typeof t){const e=Se.__fromString(t);if(null===e)throw new SyntaxError("Cannot convert "+t+" to a BigInt");return e}if("boolean"==typeof t)return!0===t?Se.__oneDigit(1,!1):Se.__zero();if("object"==typeof t){if(t.constructor===Se)return t;const e=Se.__toPrimitive(t);return Se.BigInt(e)}throw new TypeError("Cannot convert "+t+" to a BigInt")}toDebugString(){const t=["BigInt["];for(const e of this)t.push((e?(e>>>0).toString(16):e)+", ");return t.push("]"),t.join("")}toString(t=10){if(2>t||36<t)throw new RangeError("toString() radix argument must be between 2 and 36");return 0===this.length?"0":0==(t&t-1)?Se.__toStringBasePowerOfTwo(this,t):Se.__toStringGeneric(this,t,!1)}static toNumber(t){var e=Math.clz32;const n=t.length;if(0===n)return 0;if(1===n){const e=t.__unsignedDigit(0);return t.sign?-e:e}const r=t.__digit(n-1),i=e(r),o=32*n-i;if(1024<o)return t.sign?-1/0:1/0;let s=o-1,a=r,l=n-1;const u=i+1;let c=32===u?0:a<<u;c>>>=12;const f=u-12;let h=12<=u?0:a<<20+u,d=20+u;0<f&&0<l&&(l--,a=t.__digit(l),c|=a>>>32-f,h=a<<f,d=f),0<d&&0<l&&(l--,a=t.__digit(l),h|=a>>>32-d,d-=32);const p=Se.__decideRounding(t,d,l,a);if((1===p||0===p&&1==(1&h))&&(h=h+1>>>0,0===h&&(c++,0!=c>>>20&&(c=0,s++,1023<s))))return t.sign?-1/0:1/0;const g=t.sign?-2147483648:0;return s=s+1023<<20,Se.__kBitConversionInts[1]=g|s|c,Se.__kBitConversionInts[0]=h,Se.__kBitConversionDouble[0]}static unaryMinus(t){if(0===t.length)return t;const e=t.__copy();return e.sign=!t.sign,e}static bitwiseNot(t){return t.sign?Se.__absoluteSubOne(t).__trim():Se.__absoluteAddOne(t,!0)}static exponentiate(t,e){if(e.sign)throw new RangeError("Exponent must be positive");if(0===e.length)return Se.__oneDigit(1,!1);if(0===t.length)return t;if(1===t.length&&1===t.__digit(0))return t.sign&&0==(1&e.__digit(0))?Se.unaryMinus(t):t;if(1<e.length)throw new RangeError("BigInt too big");let n=e.__unsignedDigit(0);if(1===n)return t;if(n>=Se.__kMaxLengthBits)throw new RangeError("BigInt too big");if(1===t.length&&2===t.__digit(0)){const e=1+(n>>>5),r=t.sign&&0!=(1&n),i=new Se(e,r);i.__initializeDigits();const o=1<<(31&n);return i.__setDigit(e-1,o),i}let r=null,i=t;for(0!=(1&n)&&(r=t),n>>=1;0!==n;n>>=1)i=Se.multiply(i,i),0!=(1&n)&&(r=null===r?i:Se.multiply(r,i));return r}static multiply(t,e){if(0===t.length)return t;if(0===e.length)return e;let n=t.length+e.length;32<=t.__clzmsd()+e.__clzmsd()&&n--;const r=new Se(n,t.sign!==e.sign);r.__initializeDigits();for(let n=0;n<t.length;n++)Se.__multiplyAccumulate(e,t.__digit(n),r,n);return r.__trim()}static divide(t,e){if(0===e.length)throw new RangeError("Division by zero");if(0>Se.__absoluteCompare(t,e))return Se.__zero();const n=t.sign!==e.sign,r=e.__unsignedDigit(0);let i;if(1===e.length&&65535>=r){if(1===r)return n===t.sign?t:Se.unaryMinus(t);i=Se.__absoluteDivSmall(t,r,null)}else i=Se.__absoluteDivLarge(t,e,!0,!1);return i.sign=n,i.__trim()}static remainder(t,e){if(0===e.length)throw new RangeError("Division by zero");if(0>Se.__absoluteCompare(t,e))return t;const n=e.__unsignedDigit(0);if(1===e.length&&65535>=n){if(1===n)return Se.__zero();const e=Se.__absoluteModSmall(t,n);return 0===e?Se.__zero():Se.__oneDigit(e,t.sign)}const r=Se.__absoluteDivLarge(t,e,!1,!0);return r.sign=t.sign,r.__trim()}static add(t,e){const n=t.sign;return n===e.sign?Se.__absoluteAdd(t,e,n):0<=Se.__absoluteCompare(t,e)?Se.__absoluteSub(t,e,n):Se.__absoluteSub(e,t,!n)}static subtract(t,e){const n=t.sign;return n===e.sign?0<=Se.__absoluteCompare(t,e)?Se.__absoluteSub(t,e,n):Se.__absoluteSub(e,t,!n):Se.__absoluteAdd(t,e,n)}static leftShift(t,e){return 0===e.length||0===t.length?t:e.sign?Se.__rightShiftByAbsolute(t,e):Se.__leftShiftByAbsolute(t,e)}static signedRightShift(t,e){return 0===e.length||0===t.length?t:e.sign?Se.__leftShiftByAbsolute(t,e):Se.__rightShiftByAbsolute(t,e)}static unsignedRightShift(){throw new TypeError("BigInts have no unsigned right shift; use >> instead")}static lessThan(t,e){return 0>Se.__compareToBigInt(t,e)}static lessThanOrEqual(t,e){return 0>=Se.__compareToBigInt(t,e)}static greaterThan(t,e){return 0<Se.__compareToBigInt(t,e)}static greaterThanOrEqual(t,e){return 0<=Se.__compareToBigInt(t,e)}static equal(t,e){if(t.sign!==e.sign)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t.__digit(n)!==e.__digit(n))return!1;return!0}static notEqual(t,e){return!Se.equal(t,e)}static bitwiseAnd(t,e){var n=Math.max;if(!t.sign&&!e.sign)return Se.__absoluteAnd(t,e).__trim();if(t.sign&&e.sign){const r=n(t.length,e.length)+1;let i=Se.__absoluteSubOne(t,r);const o=Se.__absoluteSubOne(e);return i=Se.__absoluteOr(i,o,i),Se.__absoluteAddOne(i,!0,i).__trim()}return t.sign&&([t,e]=[e,t]),Se.__absoluteAndNot(t,Se.__absoluteSubOne(e)).__trim()}static bitwiseXor(t,e){var n=Math.max;if(!t.sign&&!e.sign)return Se.__absoluteXor(t,e).__trim();if(t.sign&&e.sign){const r=n(t.length,e.length),i=Se.__absoluteSubOne(t,r),o=Se.__absoluteSubOne(e);return Se.__absoluteXor(i,o,i).__trim()}const r=n(t.length,e.length)+1;t.sign&&([t,e]=[e,t]);let i=Se.__absoluteSubOne(e,r);return i=Se.__absoluteXor(i,t,i),Se.__absoluteAddOne(i,!0,i).__trim()}static bitwiseOr(t,e){const n=(0,Math.max)(t.length,e.length);if(!t.sign&&!e.sign)return Se.__absoluteOr(t,e).__trim();if(t.sign&&e.sign){let r=Se.__absoluteSubOne(t,n);const i=Se.__absoluteSubOne(e);return r=Se.__absoluteAnd(r,i,r),Se.__absoluteAddOne(r,!0,r).__trim()}t.sign&&([t,e]=[e,t]);let r=Se.__absoluteSubOne(e,n);return r=Se.__absoluteAndNot(r,t,r),Se.__absoluteAddOne(r,!0,r).__trim()}static asIntN(t,e){if(0===e.length)return e;if(0===t)return Se.__zero();if(t>=Se.__kMaxLengthBits)return e;const n=t+31>>>5;if(e.length<n)return e;const r=e.__unsignedDigit(n-1),i=1<<(31&t-1);if(e.length===n&&r<i)return e;if((r&i)!==i)return Se.__truncateToNBits(t,e);if(!e.sign)return Se.__truncateAndSubFromPowerOfTwo(t,e,!0);if(0==(r&i-1)){for(let r=n-2;0<=r;r--)if(0!==e.__digit(r))return Se.__truncateAndSubFromPowerOfTwo(t,e,!1);return e.length===n&&r===i?e:Se.__truncateToNBits(t,e)}return Se.__truncateAndSubFromPowerOfTwo(t,e,!1)}static asUintN(t,e){if(0===e.length)return e;if(0===t)return Se.__zero();if(e.sign){if(t>Se.__kMaxLengthBits)throw new RangeError("BigInt too big");return Se.__truncateAndSubFromPowerOfTwo(t,e,!1)}if(t>=Se.__kMaxLengthBits)return e;const n=t+31>>>5;if(e.length<n)return e;const r=31&t;if(e.length==n){if(0===r)return e;if(0==e.__digit(n-1)>>>r)return e}return Se.__truncateToNBits(t,e)}static ADD(t,e){if(t=Se.__toPrimitive(t),e=Se.__toPrimitive(e),"string"==typeof t)return"string"!=typeof e&&(e=e.toString()),t+e;if("string"==typeof e)return t.toString()+e;if(t=Se.__toNumeric(t),e=Se.__toNumeric(e),Se.__isBigInt(t)&&Se.__isBigInt(e))return Se.add(t,e);if("number"==typeof t&&"number"==typeof e)return t+e;throw new TypeError("Cannot mix BigInt and other types, use explicit conversions")}static LT(t,e){return Se.__compare(t,e,0)}static LE(t,e){return Se.__compare(t,e,1)}static GT(t,e){return Se.__compare(t,e,2)}static GE(t,e){return Se.__compare(t,e,3)}static EQ(t,e){for(;;){if(Se.__isBigInt(t))return Se.__isBigInt(e)?Se.equal(t,e):Se.EQ(e,t);if("number"==typeof t){if(Se.__isBigInt(e))return Se.__equalToNumber(e,t);if("object"!=typeof e)return t==e;e=Se.__toPrimitive(e)}else if("string"==typeof t){if(Se.__isBigInt(e))return null!==(t=Se.__fromString(t))&&Se.equal(t,e);if("object"!=typeof e)return t==e;e=Se.__toPrimitive(e)}else if("boolean"==typeof t){if(Se.__isBigInt(e))return Se.__equalToNumber(e,+t);if("object"!=typeof e)return t==e;e=Se.__toPrimitive(e)}else if("symbol"==typeof t){if(Se.__isBigInt(e))return!1;if("object"!=typeof e)return t==e;e=Se.__toPrimitive(e)}else{if("object"!=typeof t)return t==e;if("object"==typeof e&&e.constructor!==Se)return t==e;t=Se.__toPrimitive(t)}}}static NE(t,e){return!Se.EQ(t,e)}static __zero(){return new Se(0,!1)}static __oneDigit(t,e){const n=new Se(1,e);return n.__setDigit(0,t),n}__copy(){const t=new Se(this.length,this.sign);for(let e=0;e<this.length;e++)t[e]=this[e];return t}__trim(){let t=this.length,e=this[t-1];for(;0===e;)t--,e=this[t-1],this.pop();return 0===t&&(this.sign=!1),this}__initializeDigits(){for(let t=0;t<this.length;t++)this[t]=0}static __decideRounding(t,e,n,r){if(0<e)return-1;let i;if(0>e)i=-e-1;else{if(0===n)return-1;n--,r=t.__digit(n),i=31}let o=1<<i;if(0==(r&o))return-1;if(o-=1,0!=(r&o))return 1;for(;0<n;)if(n--,0!==t.__digit(n))return 1;return 0}static __fromDouble(t){Se.__kBitConversionDouble[0]=t;const e=(2047&Se.__kBitConversionInts[1]>>>20)-1023,n=1+(e>>>5),r=new Se(n,0>t);let i=1048575&Se.__kBitConversionInts[1]|1048576,o=Se.__kBitConversionInts[0];const s=31&e;let a,l=0;if(s<20){const t=20-s;l=t+32,a=i>>>t,i=i<<32-t|o>>>t,o<<=32-t}else if(20===s)l=32,a=i,i=o;else{const t=s-20;l=32-t,a=i<<t|o>>>32-t,i=o<<t}r.__setDigit(n-1,a);for(let t=n-2;0<=t;t--)0<l?(l-=32,a=i,i=o):a=0,r.__setDigit(t,a);return r.__trim()}static __isWhitespace(t){return!!(13>=t&&9<=t)||(159>=t?32==t:131071>=t?160==t||5760==t:196607>=t?10>=(t&=131071)||40==t||41==t||47==t||95==t||4096==t:65279==t)}static __fromString(t,e=0){let n=0;const r=t.length;let i=0;if(i===r)return Se.__zero();let o=t.charCodeAt(i);for(;Se.__isWhitespace(o);){if(++i===r)return Se.__zero();o=t.charCodeAt(i)}if(43===o){if(++i===r)return null;o=t.charCodeAt(i),n=1}else if(45===o){if(++i===r)return null;o=t.charCodeAt(i),n=-1}if(0===e){if(e=10,48===o){if(++i===r)return Se.__zero();if(o=t.charCodeAt(i),88===o||120===o){if(e=16,++i===r)return null;o=t.charCodeAt(i)}else if(79===o||111===o){if(e=8,++i===r)return null;o=t.charCodeAt(i)}else if(66===o||98===o){if(e=2,++i===r)return null;o=t.charCodeAt(i)}}}else if(16===e&&48===o){if(++i===r)return Se.__zero();if(o=t.charCodeAt(i),88===o||120===o){if(++i===r)return null;o=t.charCodeAt(i)}}for(;48===o;){if(++i===r)return Se.__zero();o=t.charCodeAt(i)}const s=r-i;let a=Se.__kMaxBitsPerChar[e],l=Se.__kBitsPerCharTableMultiplier-1;if(s>1073741824/a)return null;const u=a*s+l>>>Se.__kBitsPerCharTableShift,c=new Se(u+31>>>5,!1),f=10>e?e:10,h=10<e?e-10:0;if(0==(e&e-1)){a>>=Se.__kBitsPerCharTableShift;const e=[],n=[];let s=!1;do{let l=0,u=0;for(;;){let e;if(o-48>>>0<f)e=o-48;else{if(!((32|o)-97>>>0<h)){s=!0;break}e=(32|o)-87}if(u+=a,l=l<<a|e,++i===r){s=!0;break}if(o=t.charCodeAt(i),32<u+a)break}e.push(l),n.push(u)}while(!s);Se.__fillFromParts(c,e,n)}else{c.__initializeDigits();let n=!1,s=0;do{let u=0,d=1;for(;;){let a;if(o-48>>>0<f)a=o-48;else{if(!((32|o)-97>>>0<h)){n=!0;break}a=(32|o)-87}const l=d*e;if(4294967295<l)break;if(d=l,u=u*e+a,s++,++i===r){n=!0;break}o=t.charCodeAt(i)}l=32*Se.__kBitsPerCharTableMultiplier-1;const p=a*s+l>>>Se.__kBitsPerCharTableShift+5;c.__inplaceMultiplyAdd(d,u,p)}while(!n)}if(i!==r){if(!Se.__isWhitespace(o))return null;for(i++;i<r;i++)if(o=t.charCodeAt(i),!Se.__isWhitespace(o))return null}return 0!=n&&10!==e?null:(c.sign=-1==n,c.__trim())}static __fillFromParts(t,e,n){let r=0,i=0,o=0;for(let s=e.length-1;0<=s;s--){const a=e[s],l=n[s];i|=a<<o,o+=l,32===o?(t.__setDigit(r++,i),o=0,i=0):32<o&&(t.__setDigit(r++,i),o-=32,i=a>>>l-o)}if(0!==i){if(r>=t.length)throw new Error("implementation bug");t.__setDigit(r++,i)}for(;r<t.length;r++)t.__setDigit(r,0)}static __toStringBasePowerOfTwo(t,e){var n=Math.clz32;const r=t.length;let i=e-1;i=(85&i>>>1)+(85&i),i=(51&i>>>2)+(51&i),i=(15&i>>>4)+(15&i);const o=i,s=e-1,a=t.__digit(r-1);let l=0|(32*r-n(a)+o-1)/o;if(t.sign&&l++,268435456<l)throw new Error("string too long");const u=Array(l);let c=l-1,f=0,h=0;for(let e=0;e<r-1;e++){const n=t.__digit(e),r=(f|n<<h)&s;u[c--]=Se.__kConversionChars[r];const i=o-h;for(f=n>>>i,h=32-i;h>=o;)u[c--]=Se.__kConversionChars[f&s],f>>>=o,h-=o}const d=(f|a<<h)&s;for(u[c--]=Se.__kConversionChars[d],f=a>>>o-h;0!==f;)u[c--]=Se.__kConversionChars[f&s],f>>>=o;if(t.sign&&(u[c--]="-"),-1!=c)throw new Error("implementation bug");return u.join("")}static __toStringGeneric(t,e,n){var r=Math.clz32;const i=t.length;if(0===i)return"";if(1===i){let r=t.__unsignedDigit(0).toString(e);return!1===n&&t.sign&&(r="-"+r),r}const o=32*i-r(t.__digit(i-1)),s=Se.__kMaxBitsPerChar[e]-1;let a=o*Se.__kBitsPerCharTableMultiplier;a+=s-1,a=0|a/s;const l=a+1>>1,u=Se.exponentiate(Se.__oneDigit(e,!1),Se.__oneDigit(l,!1));let c,f;const h=u.__unsignedDigit(0);if(1===u.length&&65535>=h){c=new Se(t.length,!1),c.__initializeDigits();let n=0;for(let e=2*t.length-1;0<=e;e--){const r=n<<16|t.__halfDigit(e);c.__setHalfDigit(e,0|r/h),n=0|r%h}f=n.toString(e)}else{const n=Se.__absoluteDivLarge(t,u,!0,!0);c=n.quotient;const r=n.remainder.__trim();f=Se.__toStringGeneric(r,e,!0)}c.__trim();let d=Se.__toStringGeneric(c,e,!0);for(;f.length<l;)f="0"+f;return!1===n&&t.sign&&(d="-"+d),d+f}static __unequalSign(t){return t?-1:1}static __absoluteGreater(t){return t?-1:1}static __absoluteLess(t){return t?1:-1}static __compareToBigInt(t,e){const n=t.sign;if(n!==e.sign)return Se.__unequalSign(n);const r=Se.__absoluteCompare(t,e);return 0<r?Se.__absoluteGreater(n):0>r?Se.__absoluteLess(n):0}static __compareToNumber(t,e){if(!0|e){const n=t.sign,r=0>e;if(n!==r)return Se.__unequalSign(n);if(0===t.length){if(r)throw new Error("implementation bug");return 0===e?0:-1}if(1<t.length)return Se.__absoluteGreater(n);const i=Math.abs(e),o=t.__unsignedDigit(0);return o>i?Se.__absoluteGreater(n):o<i?Se.__absoluteLess(n):0}return Se.__compareToDouble(t,e)}static __compareToDouble(t,e){var n=Math.clz32;if(e!=e)return e;if(e===1/0)return-1;if(e===-1/0)return 1;const r=t.sign;if(r!==0>e)return Se.__unequalSign(r);if(0===e)throw new Error("implementation bug: should be handled elsewhere");if(0===t.length)return-1;Se.__kBitConversionDouble[0]=e;const i=2047&Se.__kBitConversionInts[1]>>>20;if(2047==i)throw new Error("implementation bug: handled elsewhere");const o=i-1023;if(0>o)return Se.__absoluteGreater(r);const s=t.length;let a=t.__digit(s-1);const l=n(a),u=32*s-l,c=o+1;if(u<c)return Se.__absoluteLess(r);if(u>c)return Se.__absoluteGreater(r);let f=1048576|1048575&Se.__kBitConversionInts[1],h=Se.__kBitConversionInts[0];const d=31-l;if(d!==(u-1)%31)throw new Error("implementation bug");let p,g=0;if(20>d){const t=20-d;g=t+32,p=f>>>t,f=f<<32-t|h>>>t,h<<=32-t}else if(20===d)g=32,p=f,f=h;else{const t=d-20;g=32-t,p=f<<t|h>>>32-t,f=h<<t}if(a>>>=0,p>>>=0,a>p)return Se.__absoluteGreater(r);if(a<p)return Se.__absoluteLess(r);for(let e=s-2;0<=e;e--){0<g?(g-=32,p=f>>>0,f=h,h=0):p=0;const n=t.__unsignedDigit(e);if(n>p)return Se.__absoluteGreater(r);if(n<p)return Se.__absoluteLess(r)}if(0!==f||0!==h){if(0===g)throw new Error("implementation bug");return Se.__absoluteLess(r)}return 0}static __equalToNumber(t,e){var n=Math.abs;return e|0===e?0===e?0===t.length:1===t.length&&t.sign===0>e&&t.__unsignedDigit(0)===n(e):0===Se.__compareToDouble(t,e)}static __comparisonResultToBool(t,e){switch(e){case 0:return 0>t;case 1:return 0>=t;case 2:return 0<t;case 3:return 0<=t}throw new Error("unreachable")}static __compare(t,e,n){if(t=Se.__toPrimitive(t),e=Se.__toPrimitive(e),"string"==typeof t&&"string"==typeof e)switch(n){case 0:return t<e;case 1:return t<=e;case 2:return t>e;case 3:return t>=e}if(Se.__isBigInt(t)&&"string"==typeof e)return null!==(e=Se.__fromString(e))&&Se.__comparisonResultToBool(Se.__compareToBigInt(t,e),n);if("string"==typeof t&&Se.__isBigInt(e))return null!==(t=Se.__fromString(t))&&Se.__comparisonResultToBool(Se.__compareToBigInt(t,e),n);if(t=Se.__toNumeric(t),e=Se.__toNumeric(e),Se.__isBigInt(t)){if(Se.__isBigInt(e))return Se.__comparisonResultToBool(Se.__compareToBigInt(t,e),n);if("number"!=typeof e)throw new Error("implementation bug");return Se.__comparisonResultToBool(Se.__compareToNumber(t,e),n)}if("number"!=typeof t)throw new Error("implementation bug");if(Se.__isBigInt(e))return Se.__comparisonResultToBool(Se.__compareToNumber(e,t),2^n);if("number"!=typeof e)throw new Error("implementation bug");return 0===n?t<e:1===n?t<=e:2===n?t>e:3===n?t>=e:void 0}__clzmsd(){return Math.clz32(this[this.length-1])}static __absoluteAdd(t,e,n){if(t.length<e.length)return Se.__absoluteAdd(e,t,n);if(0===t.length)return t;if(0===e.length)return t.sign===n?t:Se.unaryMinus(t);let r=t.length;(0===t.__clzmsd()||e.length===t.length&&0===e.__clzmsd())&&r++;const i=new Se(r,n);let o=0,s=0;for(;s<e.length;s++){const n=e.__digit(s),r=t.__digit(s),a=(65535&r)+(65535&n)+o,l=(r>>>16)+(n>>>16)+(a>>>16);o=l>>>16,i.__setDigit(s,65535&a|l<<16)}for(;s<t.length;s++){const e=t.__digit(s),n=(65535&e)+o,r=(e>>>16)+(n>>>16);o=r>>>16,i.__setDigit(s,65535&n|r<<16)}return s<i.length&&i.__setDigit(s,o),i.__trim()}static __absoluteSub(t,e,n){if(0===t.length)return t;if(0===e.length)return t.sign===n?t:Se.unaryMinus(t);const r=new Se(t.length,n);let i=0,o=0;for(;o<e.length;o++){const n=t.__digit(o),s=e.__digit(o),a=(65535&n)-(65535&s)-i;i=1&a>>>16;const l=(n>>>16)-(s>>>16)-i;i=1&l>>>16,r.__setDigit(o,65535&a|l<<16)}for(;o<t.length;o++){const e=t.__digit(o),n=(65535&e)-i;i=1&n>>>16;const s=(e>>>16)-i;i=1&s>>>16,r.__setDigit(o,65535&n|s<<16)}return r.__trim()}static __absoluteAddOne(t,e,n=null){const r=t.length;null===n?n=new Se(r,e):n.sign=e;let i=!0;for(let e,o=0;o<r;o++){if(e=t.__digit(o),i){const t=-1===e;e=0|e+1,i=t}n.__setDigit(o,e)}return i&&n.__setDigitGrow(r,1),n}static __absoluteSubOne(t,e){const n=t.length,r=new Se(e=e||n,!1);let i=!0;for(let e,o=0;o<n;o++){if(e=t.__digit(o),i){const t=0===e;e=0|e-1,i=t}r.__setDigit(o,e)}if(i)throw new Error("implementation bug");for(let t=n;t<e;t++)r.__setDigit(t,0);return r}static __absoluteAnd(t,e,n=null){let r=t.length,i=e.length,o=i;if(r<i){o=r;const n=t,s=r;t=e,r=i,e=n,i=s}let s=o;null===n?n=new Se(s,!1):s=n.length;let a=0;for(;a<o;a++)n.__setDigit(a,t.__digit(a)&e.__digit(a));for(;a<s;a++)n.__setDigit(a,0);return n}static __absoluteAndNot(t,e,n=null){const r=t.length,i=e.length;let o=i;r<i&&(o=r);let s=r;null===n?n=new Se(s,!1):s=n.length;let a=0;for(;a<o;a++)n.__setDigit(a,t.__digit(a)&~e.__digit(a));for(;a<r;a++)n.__setDigit(a,t.__digit(a));for(;a<s;a++)n.__setDigit(a,0);return n}static __absoluteOr(t,e,n=null){let r=t.length,i=e.length,o=i;if(r<i){o=r;const n=t,s=r;t=e,r=i,e=n,i=s}let s=r;null===n?n=new Se(s,!1):s=n.length;let a=0;for(;a<o;a++)n.__setDigit(a,t.__digit(a)|e.__digit(a));for(;a<r;a++)n.__setDigit(a,t.__digit(a));for(;a<s;a++)n.__setDigit(a,0);return n}static __absoluteXor(t,e,n=null){let r=t.length,i=e.length,o=i;if(r<i){o=r;const n=t,s=r;t=e,r=i,e=n,i=s}let s=r;null===n?n=new Se(s,!1):s=n.length;let a=0;for(;a<o;a++)n.__setDigit(a,t.__digit(a)^e.__digit(a));for(;a<r;a++)n.__setDigit(a,t.__digit(a));for(;a<s;a++)n.__setDigit(a,0);return n}static __absoluteCompare(t,e){const n=t.length-e.length;if(0!=n)return n;let r=t.length-1;for(;0<=r&&t.__digit(r)===e.__digit(r);)r--;return 0>r?0:t.__unsignedDigit(r)>e.__unsignedDigit(r)?1:-1}static __multiplyAccumulate(t,e,n,r){var i=Math.imul;if(0===e)return;const o=65535&e,s=e>>>16;let a=0,l=0,u=0;for(let e=0;e<t.length;e++,r++){let c=n.__digit(r),f=65535&c,h=c>>>16;const d=t.__digit(e),p=65535&d,g=d>>>16,m=i(p,o),v=i(p,s),w=i(g,o),y=i(g,s);f+=l+(65535&m),h+=u+a+(f>>>16)+(m>>>16)+(65535&v)+(65535&w),a=h>>>16,l=(v>>>16)+(w>>>16)+(65535&y)+a,a=l>>>16,l&=65535,u=y>>>16,c=65535&f|h<<16,n.__setDigit(r,c)}for(;0!=a||0!==l||0!==u;r++){let t=n.__digit(r);const e=(65535&t)+l,i=(t>>>16)+(e>>>16)+u+a;l=0,u=0,a=i>>>16,t=65535&e|i<<16,n.__setDigit(r,t)}}static __internalMultiplyAdd(t,e,n,r,i){var o=Math.imul;let s=n,a=0;for(let n=0;n<r;n++){const r=t.__digit(n),l=o(65535&r,e),u=(65535&l)+a+s;s=u>>>16;const c=o(r>>>16,e),f=(65535&c)+(l>>>16)+s;s=f>>>16,a=c>>>16,i.__setDigit(n,f<<16|65535&u)}if(i.length>r)for(i.__setDigit(r++,s+a);r<i.length;)i.__setDigit(r++,0);else if(0!==s+a)throw new Error("implementation bug")}__inplaceMultiplyAdd(t,e,n){var r=Math.imul;n>this.length&&(n=this.length);const i=65535&t,o=t>>>16;let s=0,a=65535&e,l=e>>>16;for(let t=0;t<n;t++){const e=this.__digit(t),n=65535&e,u=e>>>16,c=r(n,i),f=r(n,o),h=r(u,i),d=r(u,o),p=a+(65535&c),g=l+s+(p>>>16)+(c>>>16)+(65535&f)+(65535&h);a=(f>>>16)+(h>>>16)+(65535&d)+(g>>>16),s=a>>>16,a&=65535,l=d>>>16,this.__setDigit(t,65535&p|g<<16)}if(0!=s||0!==a||0!==l)throw new Error("implementation bug")}static __absoluteDivSmall(t,e,n){null===n&&(n=new Se(t.length,!1));let r=0;for(let i,o=2*t.length-1;0<=o;o-=2){i=(r<<16|t.__halfDigit(o))>>>0;const s=0|i/e;r=0|i%e,i=(r<<16|t.__halfDigit(o-1))>>>0;const a=0|i/e;r=0|i%e,n.__setDigit(o>>>1,s<<16|a)}return n}static __absoluteModSmall(t,e){let n=0;for(let r=2*t.length-1;0<=r;r--){n=0|((n<<16|t.__halfDigit(r))>>>0)%e}return n}static __absoluteDivLarge(t,e,n,r){var i=Math.imul;const o=e.__halfDigitLength(),s=e.length,a=t.__halfDigitLength()-o;let l=null;n&&(l=new Se(a+2>>>1,!1),l.__initializeDigits());const u=new Se(o+2>>>1,!1);u.__initializeDigits();const c=Se.__clz16(e.__halfDigit(o-1));0<c&&(e=Se.__specialLeftShift(e,c,0));const f=Se.__specialLeftShift(t,c,1),h=e.__halfDigit(o-1);let d=0;for(let t,r=a;0<=r;r--){t=65535;const a=f.__halfDigit(r+o);if(a!==h){const n=(a<<16|f.__halfDigit(r+o-1))>>>0;t=0|n/h;let s=0|n%h;const l=e.__halfDigit(o-2),u=f.__halfDigit(r+o-2);for(;i(t,l)>>>0>(s<<16|u)>>>0&&(t--,s+=h,!(65535<s)););}Se.__internalMultiplyAdd(e,t,0,s,u);let c=f.__inplaceSub(u,r,o+1);0!==c&&(c=f.__inplaceAdd(e,r,o),f.__setHalfDigit(r+o,f.__halfDigit(r+o)+c),t--),n&&(1&r?d=t<<16:l.__setDigit(r>>>1,d|t))}return r?(f.__inplaceRightShift(c),n?{quotient:l,remainder:f}:f):n?l:void 0}static __clz16(t){return Math.clz32(t)-16}__inplaceAdd(t,e,n){let r=0;for(let i=0;i<n;i++){const n=this.__halfDigit(e+i)+t.__halfDigit(i)+r;r=n>>>16,this.__setHalfDigit(e+i,n)}return r}__inplaceSub(t,e,n){let r=0;if(1&e){e>>=1;let i=this.__digit(e),o=65535&i,s=0;for(;s<n-1>>>1;s++){const n=t.__digit(s),a=(i>>>16)-(65535&n)-r;r=1&a>>>16,this.__setDigit(e+s,a<<16|65535&o),i=this.__digit(e+s+1),o=(65535&i)-(n>>>16)-r,r=1&o>>>16}const a=t.__digit(s),l=(i>>>16)-(65535&a)-r;if(r=1&l>>>16,this.__setDigit(e+s,l<<16|65535&o),e+s+1>=this.length)throw new RangeError("out of bounds");0==(1&n)&&(i=this.__digit(e+s+1),o=(65535&i)-(a>>>16)-r,r=1&o>>>16,this.__setDigit(e+t.length,4294901760&i|65535&o))}else{e>>=1;let i=0;for(;i<t.length-1;i++){const n=this.__digit(e+i),o=t.__digit(i),s=(65535&n)-(65535&o)-r;r=1&s>>>16;const a=(n>>>16)-(o>>>16)-r;r=1&a>>>16,this.__setDigit(e+i,a<<16|65535&s)}const o=this.__digit(e+i),s=t.__digit(i),a=(65535&o)-(65535&s)-r;r=1&a>>>16;let l=0;0==(1&n)&&(l=(o>>>16)-(s>>>16)-r,r=1&l>>>16),this.__setDigit(e+i,l<<16|65535&a)}return r}__inplaceRightShift(t){if(0===t)return;let e=this.__digit(0)>>>t;const n=this.length-1;for(let r=0;r<n;r++){const n=this.__digit(r+1);this.__setDigit(r,n<<32-t|e),e=n>>>t}this.__setDigit(n,e)}static __specialLeftShift(t,e,n){const r=t.length,i=new Se(r+n,!1);if(0===e){for(let e=0;e<r;e++)i.__setDigit(e,t.__digit(e));return 0<n&&i.__setDigit(r,0),i}let o=0;for(let n=0;n<r;n++){const r=t.__digit(n);i.__setDigit(n,r<<e|o),o=r>>>32-e}return 0<n&&i.__setDigit(r,o),i}static __leftShiftByAbsolute(t,e){const n=Se.__toShiftAmount(e);if(0>n)throw new RangeError("BigInt too big");const r=n>>>5,i=31&n,o=t.length,s=0!==i&&0!=t.__digit(o-1)>>>32-i,a=o+r+(s?1:0),l=new Se(a,t.sign);if(0===i){let e=0;for(;e<r;e++)l.__setDigit(e,0);for(;e<a;e++)l.__setDigit(e,t.__digit(e-r))}else{let e=0;for(let t=0;t<r;t++)l.__setDigit(t,0);for(let n=0;n<o;n++){const o=t.__digit(n);l.__setDigit(n+r,o<<i|e),e=o>>>32-i}if(s)l.__setDigit(o+r,e);else if(0!==e)throw new Error("implementation bug")}return l.__trim()}static __rightShiftByAbsolute(t,e){const n=t.length,r=t.sign,i=Se.__toShiftAmount(e);if(0>i)return Se.__rightShiftByMaximum(r);const o=i>>>5,s=31&i;let a=n-o;if(0>=a)return Se.__rightShiftByMaximum(r);let l=!1;if(r)if(0!=(t.__digit(o)&(1<<s)-1))l=!0;else for(let e=0;e<o;e++)if(0!==t.__digit(e)){l=!0;break}if(l&&0===s){0==~t.__digit(n-1)&&a++}let u=new Se(a,r);if(0===s)for(let e=o;e<n;e++)u.__setDigit(e-o,t.__digit(e));else{let e=t.__digit(o)>>>s;const r=n-o-1;for(let n=0;n<r;n++){const r=t.__digit(n+o+1);u.__setDigit(n,r<<32-s|e),e=r>>>s}u.__setDigit(r,e)}return l&&(u=Se.__absoluteAddOne(u,!0,u)),u.__trim()}static __rightShiftByMaximum(t){return t?Se.__oneDigit(1,!0):Se.__zero()}static __toShiftAmount(t){if(1<t.length)return-1;const e=t.__unsignedDigit(0);return e>Se.__kMaxLengthBits?-1:e}static __toPrimitive(t,e="default"){if("object"!=typeof t)return t;if(t.constructor===Se)return t;const n=t[Symbol.toPrimitive];if(n){const t=n(e);if("object"!=typeof t)return t;throw new TypeError("Cannot convert object to primitive value")}const r=t.valueOf;if(r){const e=r.call(t);if("object"!=typeof e)return e}const i=t.toString;if(i){const e=i.call(t);if("object"!=typeof e)return e}throw new TypeError("Cannot convert object to primitive value")}static __toNumeric(t){return Se.__isBigInt(t)?t:+t}static __isBigInt(t){return"object"==typeof t&&t.constructor===Se}static __truncateToNBits(t,e){const n=t+31>>>5,r=new Se(n,e.sign),i=n-1;for(let t=0;t<i;t++)r.__setDigit(t,e.__digit(t));let o=e.__digit(i);if(0!=(31&t)){const e=32-(31&t);o=o<<e>>>e}return r.__setDigit(i,o),r.__trim()}static __truncateAndSubFromPowerOfTwo(t,e,n){var r=Math.min;const i=t+31>>>5,o=new Se(i,n);let s=0;const a=i-1;let l=0;for(const t=r(a,e.length);s<t;s++){const t=e.__digit(s),n=0-(65535&t)-l;l=1&n>>>16;const r=0-(t>>>16)-l;l=1&r>>>16,o.__setDigit(s,65535&n|r<<16)}for(;s<a;s++)o.__setDigit(s,0|-l);let u=a<e.length?e.__digit(a):0;const c=31&t;let f;if(0==c){const t=0-(65535&u)-l;l=1&t>>>16;f=65535&t|0-(u>>>16)-l<<16}else{const t=32-c;u=u<<t>>>t;const e=1<<32-t,n=(65535&e)-(65535&u)-l;l=1&n>>>16;f=65535&n|(e>>>16)-(u>>>16)-l<<16,f&=e-1}return o.__setDigit(a,f),o.__trim()}__digit(t){return this[t]}__unsignedDigit(t){return this[t]>>>0}__setDigit(t,e){this[t]=0|e}__setDigitGrow(t,e){this[t]=0|e}__halfDigitLength(){const t=this.length;return 65535>=this.__unsignedDigit(t-1)?2*t-1:2*t}__halfDigit(t){return 65535&this[t>>>1]>>>((1&t)<<4)}__setHalfDigit(t,e){const n=t>>>1,r=this.__digit(n),i=1&t?65535&r|e<<16:4294901760&r|65535&e;this.__setDigit(n,i)}static __digitPow(t,e){let n=1;for(;0<e;)1&e&&(n*=t),e>>>=1,t*=t;return n}}function xe(t,e){return Se.add(t,e)}function De(t,e){return Se.multiply(t,e)}function Ee(t,e){return Se.divide(t,e)}function Oe(t,e){return Se.remainder(t,e)}function ke(t){return Se.toNumber(t)}function Ce(t,e){return Se.notEqual(t,e)}function Pe(t,e){return Se.lessThan(t,e)}Se.__kMaxLength=33554432,Se.__kMaxLengthBits=Se.__kMaxLength<<5,Se.__kMaxBitsPerChar=[0,0,32,51,64,75,83,90,96,102,107,111,115,119,122,126,128,131,134,136,139,141,143,145,147,149,151,153,154,156,158,159,160,162,163,165,166],Se.__kBitsPerCharTableShift=5,Se.__kBitsPerCharTableMultiplier=1<<Se.__kBitsPerCharTableShift,Se.__kConversionChars=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],Se.__kBitConversionBuffer=new ArrayBuffer(8),Se.__kBitConversionDouble=new Float64Array(Se.__kBitConversionBuffer),Se.__kBitConversionInts=new Int32Array(Se.__kBitConversionBuffer);const Te=Se.BigInt;function Ie(t,e){return Se.bitwiseAnd(t,e)}function Ne(t,e){return Se.bitwiseOr(t,e)}function je(t,e){return Se.bitwiseXor(t,e)}function Re(t){return Se.bitwiseNot(t)}function ze(t,e){return Se.leftShift(t,e)}function Me(t,e){return Se.signedRightShift(t,e)}function Le(t){return Se.toNumber(t)}function Be(t,e){return Se.equal(t,e)}function Ue(t,e){return Se.notEqual(t,e)}function $e(t,e){return Se.greaterThanOrEqual(t,e)}function Fe(t,e){return Se.asIntN(t,e)}const qe=Se.BigInt,We=qe(0),Je=qe(1),Ye=Re(We),Ve=qe(32),He=[],Ke=[];for(let t=0;t<=512;++t){const e=ze(Je,qe(t));He.push(e),Ke.push(Re(e))}const Ge=He.filter((t,e)=>e%2==0).reduce((t,e)=>Ne(t,e));function Qe(t){const e=[];let n=0;for(;Ue(t,We);){let r=Le(Fe(32,t));t=Me(t,Ve);let i=Math.clz32(r);for(;i<32;){const t=31-i;e.push(n+t),r^=1<<t,i=Math.clz32(r)}n+=32}return e}function Ze(t){const e=[];let n=0;for(;Ue(t,We);){let r=Le(Fe(32,t));r=1431655765&r|r>>1&1431655765,t=Me(t,Ve);let i=Math.clz32(r);for(;i<32;){const t=31-i;e.push(n+t),r^=1<<t,i=Math.clz32(r)}n+=32}return e}function Xe(t,e){const n=new Map;for(const r of e){const e=r-r%2;if(n.has(e))continue;const i=new Set;for(const e of t)(e.set.has(r)||e.set.has(r+1))&&i.add(e);i.size&&n.set(e,i)}if(n.size<=1)return[t];for(const e of t){let r=-1;for(const[i,o]of n)if(o.has(e))if(-1!==r){if(n.set(r,new Set([...n.get(r),...o])),n.delete(i),1===n.size)return[t]}else r=i}return[...n.values()].map(t=>[...t])}function tn(t){return Ne(ze(Ie(t,Ge),Je),Ie(Me(t,Je),Ge))}function en(t,e=512){let n=0;for(;n<e&&Ue(t,We);++n)t=Ie(t,(r=t,i=Je,Se.subtract(r,i)));var r,i;return n}class nn{constructor(t,e,n){this._bigint=t,this._set=e,this._hash=n}get bigint(){return this._bigint}get set(){return this._set}get hash(){return this._hash}raise(t){if(!this._set.has(t))return this;const e=je(this._bigint,He[t]),n=new Set(this._set);n.delete(t);const r=this._hash^1<<t;return new nn(e,n,r)}covers(t){return this.set.size<=t.set.size&&Be(Ie(this.bigint,t.bigint),this.bigint)}static parse(t){const e=t.split("");let n=We,r=0;const i=new Set;for(const[t,o]of e.entries()){if("-"===o)continue;const e=2*t;if("0"===o)n=Ne(n,He[e]),i.add(e),r^=1<<e;else if("1"===o)n=Ne(n,He[e+1]),i.add(e+1),r^=2<<e;else{if("/"!==o)throw new Error("Invalid cube string");n=Ne(n,He[e]),i.add(e),n=Ne(n,He[e+1]),i.add(e+1),r^=3<<e}}return new nn(n,i,r)}toString(){let t=this.bigint.toString(2);t.length%2&&(t="0"+t);return t.match(/.{2}/g).reverse().map(t=>"00"===t?"-":"01"===t?"0":"10"===t?"1":"/").join("")}static from(t){let e=We,n=0;const r=new Set;for(const i of t)r.add(i),n^=1<<i,e=Ne(e,He[i]);return new nn(e,r,n)}static fromBigInt(t){let e=0;const n=new Set;let r=0,i=t;for(;Ue(i,We);){let t=Le(Fe(32,i));e^=t,i=Me(i,Ve);let o=Math.clz32(t);for(;o<32;){const e=31-o;n.add(r+e),t^=1<<e,o=Math.clz32(t)}r+=32}return new nn(t,n,e)}}class rn{constructor(t,e,n){this._cubes=t,this._count=e,this._bigint=n}static from(t){const e=[];let n=We;const r=[];for(const i of t){n=Ne(n,i.bigint),e.push(i);for(const t of i.set){for(;r.length<=t+1-t%2;)r.push(0);++r[t]}}return new rn(e,r,n)}get bigint(){return this._bigint}get cubes(){return this._cubes}count(t){return this._count[t]}filter(t){const e=this._count.slice();let n=this._bigint;const r=this._cubes.filter(r=>{if(t(r))return!0;for(const t of r.set)--e[t]||(n=je(n,He[t]));return!1});return new rn(r,e,n)}pop(){const t=this._cubes.pop();if(t){for(const e of t.set)--this._count[e]||(this._bigint=je(this._bigint,He[e]));return t}}push(t){const e=this._cubes.push(t);for(const e of t.set)++this._count[e];return this._bigint=Ne(this._bigint,t.bigint),e}unshift(t){const e=this._cubes.unshift(t);for(const e of t.set)++this._count[e];return this._bigint=Ne(this._bigint,t.bigint),e}}function on(t,e=We,n=Ie(t.bigint,Re(Ne(e,tn(e))))){let r=!1,i=!1;do{if(r=!1,t=t.filter(t=>{if(Ue(Ie(e,t.bigint),We))return!1;const o=Ie(t.bigint,n),s=en(o,2);return 1===s?(r=!0,e=Ne(e,o),n=Be(Ie(Ge,o),We)?je(n,Me(o,Je)):je(n,ze(o,Je)),!1):(0===s&&(i=!0),!0)}),i)return!0}while(r);if(t.cubes.length<=1)return!1;let o=-1,s=0,a=0,l=0;const u=Ze(n=Ie(t.bigint,n)),c=new Set;for(const r of u){const i=t.count(r),u=t.count(r+1),f=i+u;if(i&&u){if(f>=s){const t=Math.min(i,u);(f>s||t>a)&&(o=r,s=f,a=t)}}else{if(f===t.cubes.length)return!1;c.add(r),e=Ne(e,He[i?r:r+1]),n=je(n,He[i?r+1:r])}l=Math.max(l,f)}if(-1===o)return!1;if(3*l<t.cubes.length&&u.length-c.size>8){const r=Xe(t.cubes,u.filter(t=>!c.has(t)));if(r.length>1){for(const t of r)if(!on(rn.from(t),e,n))return!1;return!0}}return!!on(t,Ne(e,He[o]),je(n,He[o+1]))&&on(t,Ne(e,He[o+1]),je(n,He[o]))}function sn(t,e=We,n=t.bigint){let r=!1,i=!1;do{if(r=!1,t=t.filter(t=>{if(Ue(Ie(e,t.bigint),We))return!1;const o=Ie(t.bigint,n),s=en(o,2);return 1===s?(r=!0,e=Ne(e,o),n=Be(Ie(Ge,o),We)?je(n,Me(o,Je)):je(n,ze(o,Je)),!1):(0===s&&(i=!0),!0)}),i)return[]}while(r);if(!t.cubes.length)return[nn.fromBigInt(tn(e))];n=Ie(t.bigint,n);const o=[];if(1===t.cubes.length){const t=tn(e);for(const e of Qe(n))o.push(nn.fromBigInt(Ne(t,He[1^e])));return o}let s=-1,a=0,l=0,u=0;const c=Ze(n),f=new Set;for(const r of c){const i=t.count(r),c=t.count(r+1),h=i+c;if(i&&c){if(h>=a){const t=Math.min(i,c);(h>a||t>l)&&(s=r,a=h,l=t)}}else h===t.cubes.length&&(f.add(r),o.push(nn.fromBigInt(tn(Ne(e,He[i?r:r+1])))),n=je(n,He[i?r:r+1]));u=Math.max(u,h)}if(3*u<t.cubes.length&&c.length-f.size>8){const r=Xe(t.cubes,c.filter(t=>!f.has(t)));if(r.length>1){let t=sn(rn.from(r.pop()),e,n);for(const i of r){if(!t.length)return o;const r=sn(rn.from(i),e,n),s=[];for(const e of t)for(const t of r)s.push(nn.fromBigInt(Ne(e.bigint,t.bigint)));t=s}return[...o,...t]}}if(-1===s)return function t(e,n,r,i){let o=!1,s=!1,a=512,l=We;do{if(a=512,l=We,o=!1,e=e.filter(t=>{if(Ue(Ie(r,t.bigint),We))return!1;const e=Ie(t.bigint,i),n=en(e,a);return 1===n?(o=!0,r=Ne(r,e),!1):(n<a&&(l=e,a=n),0===n&&(s=!0),!0)}),s)return}while(o);if(!e.cubes.length)return void n.push(nn.fromBigInt(tn(r)));const u=Qe(l);if(1===e.cubes.length){const t=tn(r);for(const e of u)n.push(nn.fromBigInt(Ne(t,He[1^e])));return}let c=-1,f=0;for(const t of u){const n=e.count(t);n>f&&(c=t,f=n)}t(e,n,Ne(r,He[c]),i),t(e,n,r,je(i,He[c]))}(t,o,e,n),o;const h=sn(t,Ne(e,He[s]),je(n,He[s+1]));let d=sn(t,Ne(e,He[s+1]),je(n,He[s]));const p=3<<s,g=Ne(He[s],He[s+1]),m=new Set;t:for(const[t,e]of h.entries()){const n=e.hash^p;for(const r of d)if(r.hash===n&&Be(je(e.bigint,r.bigint),g)){h[t]=nn.fromBigInt(Ie(e.bigint,r.bigint)),m.add(r);continue t}}return m.size&&(d=d.filter(t=>!m.has(t))),[...o,...h,...d]}function an(t,e){return on(t,tn(e.bigint))}function ln(t,e,n,r){const i=tn(t.bigint);let o=n.map(t=>new Set(Qe(Ie(i,t.bigint))));o=o.filter(t=>t.size);let s=e.map(t=>new Set(Qe(Ie(i,t.bigint))));s=s.filter(t=>t.size);const a=new Set;for(const e of t.set)a.add(1^e);const l=[];for(let t=Math.max(...a);t>=0;--t)l.push(0);for(const t of s)for(const e of t)++l[e];for(;s.length&&o.length;){const e=new Set;for(const t of o)1===t.size&&e.add(...t);if(e.size){for(const t of e)a.delete(t),o=o.filter(e=>!e.has(t)),s=s.filter(e=>!e.has(t));const n=new Set(a);for(const t of o)for(const e of t)n.delete(e);for(const e of n)a.delete(e),t=t.raise(1^e),s=s.filter(t=>!(t.delete(e)&&!t.size));if(!o.length||!s.length)break}const n=new Set;for(const t of s)1===t.size&&n.add(...t);if(n.size){let e=0,i=-1;for(const o of n)l[o]>e&&r(1^o,t.set)&&(e=l[o],i=o);if(i>=0){a.delete(i),t=t.raise(1^i),s=s.filter(t=>!(t.delete(i)&&!t.size));for(const t of o)t.delete(i);continue}}let i=0,u=-1;for(const e of a)l[e]>i&&r(1^e,t.set)&&(i=l[e],u=e);if(u<0){a.clear();break}a.delete(u),t=t.raise(1^u);for(const t of s)t.delete(u);for(const t of o)t.delete(u)}if(o.length){const t=fn(o);for(const e of t)a.delete(e)}for(const e of a)r(1^e,t.set)&&(t=t.raise(1^e));return t}function un(t,e,n,r){const i=tn(t.bigint);let o=e.map(t=>new Set(Qe(Ie(i,t.bigint))));o=o.filter(t=>t.size);const s=[...t.set].map(t=>1^t),a=[];for(let t=Math.max(...s);t>=0;--t)a.push(0);for(const t of o)for(const e of t)++a[e];for(;s.length;){const e=new Set;for(const t of o)1===t.size&&e.add(...t);s.sort((t,n)=>+e.has(t)-+e.has(n)||a[t]-a[n]);const i=[];for(;s.length;){const e=s.pop();if(!r(1^e,t.set)){i.unshift(e);continue}const a=t.raise(1^e);if(!an(n,a)){o=o.filter(t=>!t.has(e)),s.push(...i);break}t=a;for(const t of o)t.delete(e);o=o.filter(t=>t.size),s.push(...i.splice(0))}}return t}function cn(t,e,n,r,i){if(!t.length)return t;(t=t.slice()).sort((t,e)=>t.set.size-e.set.size);const o=t[0];do{let o=t[0];r.has(o)||(o=n?ln(o,t,n,i):un(o,t,rn.from([...t,...e]),i)),(t=t.filter(t=>!o.covers(t))).push(o)}while(t[0].set.size>=o.set.size&&Ue(t[0].bigint,o.bigint));return t}function fn(t){let e=new Set;const n=function(t){const e=new Map,n=t.length;for(let t=0;t<n;++t)e.set(t,new Set);for(let r=0;r<n;++r){const i=t[r],o=e.get(r);for(let s=r+1;s<n;++s){const n=t[s];let a=!1;for(const t of i)if(n.has(t)){a=!0;break}if(!a){const t=e.get(s);o.add(s),t.add(r)}}}const r=Array.from(t.keys());r.sort((t,n)=>e.get(n).size-e.get(t).size);let i=[],o=0,s=0;return function t(r,a,l){if(s>n)return;if(!a.length&&!l.length){if(++s,r.length>=i.length){const t=r.reduce((t,n)=>t+e.get(n).size,0);(t>o||r.length>i.length)&&(i=r,o=t,s=0)}return}const u=new Set,c=e.get(a[0]);for(const n of a){if(c.has(n))continue;const o=e.get(n),s=a.filter(t=>o.has(t)&&!u.has(t)),f=l.filter(t=>o.has(t));if(t([...r,n],s,f),i.length>r.length+a.length)return;l.push(n),u.add(n)}}([],r,[]),i.map(e=>t[e])}(t);let r=t;for(const i of n){const n=new Map;for(const e of t)for(const t of e)if(i.has(t)){let r=n.get(t);r||n.set(t,r=new Set),r.add(e)}const[o,s]=Array.from(n).reduce((t,e)=>e[1].size>t[1].size?e:t);r=r.filter(t=>!s.has(t)),e.add(o)}return e=function(t,e){let n=t.map(t=>new Set([...t].filter(t=>e.has(t))));const r=new Set;for(;;){for(const t of n)if(1===t.size){const[e]=t;r.add(e)}if(n=n.filter(t=>{for(const e of t)if(r.has(e))return!1;return t.size>1}),!n.length)break;const t=new Map;for(const e of n){for(const n of e)t.has(n)||t.set(n,new Set);if(2===e.size){const[n,r]=e,i=t.get(n),o=t.get(r);i.add(r),o.add(n)}}const e=Array.from(t).reduce((t,e)=>e[1].size<t[1].size?e:t)[0];for(const t of n)t.delete(e)}return r}(t,e),r.length&&(e=new Set([...e,...fn(r)])),e}function hn(t,e,n,r){let i=!1,o=!1;const s=[];do{if(i=!1,t=t.filter(t=>{if(Ue(Ie(n,t.bigint),We))return!1;const a=Ie(t.bigint,r),l=en(a,2);if(1===l&&!e.has(t))return i=!0,n=Ne(n,a),r=Be(Ie(Ge,a),We)?je(r,Me(a,Je)):je(r,ze(a,Je)),!1;if(0===l){const n=e.get(t);if(null!=n)return s.push(n),!1;o=!0}return!0}),o)return[]}while(i);if(t.cubes.length<=1)return[new Set(s)];let a=-1,l=0,u=0,c=0;const f=Ze(r=Ie(t.bigint,r)),h=new Set;for(const e of f){const i=t.count(e),o=t.count(e+1),s=i+o;if(i&&o){if(s>=l){const t=Math.min(i,o);(s>l||t>u)&&(a=e,l=s,u=t)}}else h.add(e),n=Ne(n,He[i?e:e+1]),r=je(r,He[i?e+1:e]);c=Math.max(c,s)}if(-1===a)return[new Set(s)];if(3*c<t.cubes.length&&f.length-h.size>8){const i=Xe(t.cubes,f.filter(t=>!h.has(t)));if(i.length>1){let t=[new Set(s)];for(const o of i){const i=t;t=hn(rn.from(o),e,n,r);const s=[];for(const e of t)for(const t of i)s.push(new Set([...e,...t]));t=s}return t}}let d=hn(t,e,Ne(n,He[a]),je(r,He[a+1])),p=hn(t,e,Ne(n,He[a+1]),je(r,He[a]));const g=new Set,m=new Set;for(const t of d)for(const e of p)if(t.size<=e.size){let n=!0;for(const r of t)if(!e.has(r)){n=!1;break}n&&m.delete(e)}else{let n=!0;for(const r of e)if(!t.has(r)){n=!1;break}n&&g.delete(t)}return g.size&&(d=d.filter(t=>!g.has(t))),m.size&&(p=p.filter(t=>!m.has(t))),[...d,...p].map(t=>new Set([...s,...t]))}function dn(t,e,n){const r=fn(function(t,e,n){const r=new Map,i=new WeakMap;for(const[e,n]of t.entries())i.set(n,e);const o=rn.from([...t,...e,...n]);for(const e of t){const t=tn(e.bigint),n=hn(o,i,t,Ie(o.bigint,Re(Ne(e.bigint,t))));for(const t of n){let e=0;for(const n of t)e^=1<<n;const n=r.get(e);if(!n){r.set(e,[t]);continue}let i=!1;t:for(const e of n)if(e.size===t.size){for(const n of e)if(!t.has(n))continue t;i=!0;break}i||n.push(t)}}return[...r.values()].flat()}(t,e,n));return t.filter((t,e)=>r.has(e))}function pn(t,e){const[n,r]=function(t,e){const n=rn.from([...e,...t]),r=[],i=[];for(let e=0;e<t.length;++e){const t=n.pop();an(n,t)?i.push(t):r.push(t),n.unshift(t)}return[r,i]}(t,e),i=dn(function(t,e,n){const r=rn.from([...n,...e]);return t.filter(t=>!an(r,t))}(r,n,e),n,e);return[...n,...i]}function gn(t,e,n){let r=!1,i=!1;do{if(r=!1,t=t.filter(t=>{if(Ue(Ie(e,t.bigint),We))return!1;const o=Ie(t.bigint,n),s=en(o,2);return 1===s?(r=!0,e=Ne(e,o),n=Be(Ie(Ge,o),We)?je(n,Me(o,Je)):je(n,ze(o,Je)),!1):(0===s&&(i=!0),!0)}),i)return Ye}while(r);if(t.cubes.length<=1)return e;let o=-1,s=0,a=0,l=0;const u=Ze(n=Ie(t.bigint,n)),c=new Set;for(const e of u){const n=t.count(e),r=t.count(e+1),i=n+r;if(n&&r){if(i>=s){const t=Math.min(n,r);(i>s||t>a)&&(o=e,s=i,a=t)}}else c.add(e),t=n?t.filter(t=>!t.set.has(e)):t.filter(t=>!t.set.has(e+1));l=Math.max(l,i)}if(-1===o)return e;if(3*l<t.cubes.length&&u.length-c.size>8){const r=Xe(t.cubes,u.filter(t=>!c.has(t)));let i=Ye;if(r.length>1){for(const t of r)i=Ie(i,gn(rn.from(t),e,n));return i}}return Ie(gn(t,Ne(e,He[o]),je(n,He[o+1])),gn(t,Ne(e,He[o+1]),je(n,He[o])))}function mn(t,e,n){!function(t){if(t.length<=1)return;const e=t.reduce((t,e)=>e.set.size<=t.set.size?e:t);t.sort((t,n)=>{const r=en(Ie(t.bigint,e.bigint)),i=t.set.size-r+(e.set.size-r),o=en(Ie(n.bigint,e.bigint));return i-(n.set.size-o+(e.set.size-o))})}(t=t.slice());for(let r=t.length;r>0;--r){const r=t.shift(),i=tn(r.bigint),o=Ne(r.bigint,i),s=[...t,...e].filter(t=>Be(Ie(i,t.bigint),We)),a=gn(rn.from(s),i,Re(o));$e(a,We)&&(Be(a,i)?(t.push(r),n.add(r)):t.push(nn.fromBigInt(tn(a))))}return t}function vn(t,e,n,r){const i=function(t,e){const n=[];for(let r=t.length;r>0;--r){const r=t.shift(),i=tn(r.bigint),o=Ne(r.bigint,i),s=[...t,...e].filter(t=>Be(Ie(i,t.bigint),We)),a=gn(rn.from(s),i,Re(o));Ue(a,i)&&$e(a,We)&&n.push(nn.fromBigInt(tn(a))),t.push(r)}return n}(t,e),o=[],s=r?null:rn.from([...t,...e]);for(let t=i.length;t>0;--t){const t=i.shift(),e=r?ln(t,i,r,n):un(t,i,s,n);for(const t of i)e.covers(t)&&o.push(e);i.push(t)}return o.length?pn([...t,...o],e):t}function wn(t){return t.reduce((t,e)=>t+e.set.size,0)}function yn(t,e,n,r=(()=>!0)){if(!t.length)return t;const i=new WeakSet,o=function(t,e){const n=[...e,...t],r=[];for(let e=0;e<t.length;++e){const t=n.pop(),e=tn(t.bigint),i=[];for(const t of n){const n=Ie(e,t.bigint),r=en(n,2);0===r?i.push(t):1===r&&i.push(nn.fromBigInt(je(t.bigint,n)))}on(rn.from(i),e)||r.push(t),n.unshift(t)}return r}(t=pn(t=cn(t,e,n,i,r),e),e);o.length&&(t=t.filter(t=>!o.includes(t)),e=[...e,...o]);let s=wn(t);for(;;){let o=mn(t,e,i);o=cn(o,e,n,i,r),o=pn(o,e);let a=wn(o);if(a>=s&&(o=vn(t,e,r,n),a=wn(o),a>=s))break;s=a,t=o}return[...o,...t]}function _n(t){return t.map(t=>nn.from(t))}function bn(t){return t.map(t=>[...t.set])}function An(t){return bn(sn(rn.from(_n(t))))}function Sn(t,e=[],n={}){const r=_n(t),i=_n(e);return bn(yn(r,i,n.computeOffSet?sn(rn.from([...r,...i])):void 0,n.canRaise))}const xn=Te(0),Dn=Te(1),En=Te(2),On=Te(-1);class kn{constructor(t){this.map=new Map,t?(this.map.set(t,1),this.sortedKeys=[t]):this.sortedKeys=[]}reciprocal(){const t=new kn;t.sortedKeys=this.sortedKeys,t.map=new Map;for(const[e,n]of this.map)t.map.set(e,0-n);return t}static multiply(t,e){const n=new kn;n.sortedKeys=t.sortedKeys.slice(),n.map=new Map(t.map);for(const[t,r]of e.map){const e=n.map.get(t);if(e){const i=r+e;i?n.map.set(t,i):(n.map.delete(t),n.sortedKeys=n.sortedKeys.filter(e=>e!==t))}else n.map.set(t,r),n.sortedKeys.push(t)}return n.sortedKeys.sort((t,e)=>t.length!==e.length?e.length-t.length:t>e?1:t<e?-1:0),n}static compare(t,e){if(t.sortedKeys.length!==e.sortedKeys.length)return e.sortedKeys.length-t.sortedKeys.length;for(let n=0;n<t.sortedKeys.length;++n){const r=t.sortedKeys[n],i=t.map.get(r),o=e.sortedKeys[n],s=e.map.get(o);if(i!==s)return s-i;if(r.length>o.length)return-1;if(r.length<o.length)return 1;if(r>o)return 1;if(r<o)return-1}return 0}}function Cn(t,e){for(;Ce(e,xn);){const n=e;e=Oe(t,e),t=n}return t}class Pn{constructor(t){this.terms=t}static simplifyTerms(t){const e=t.slice().sort((t,e)=>kn.compare(t.indeterminates,e.indeterminates));for(let t=1;t<e.length;++t){const n=e[t-1],r=e[t];if(0===kn.compare(n.indeterminates,r.indeterminates)){const i=xe(De(n.coefficientNumerator,r.coefficientDenominator),De(r.coefficientNumerator,n.coefficientDenominator)),o=De(n.coefficientDenominator,r.coefficientDenominator),s=Cn(i,o);e[t]={indeterminates:r.indeterminates,coefficientNumerator:Ee(i,s),coefficientDenominator:Ee(o,s)},e[t-1]={indeterminates:n.indeterminates,coefficientNumerator:xn,coefficientDenominator:n.coefficientDenominator}}}return e.filter(t=>Ce(t.coefficientNumerator,xn))}static fromIndeterminate(t){const e=new kn(JSON.stringify(t));return new Pn([{indeterminates:e,coefficientNumerator:Dn,coefficientDenominator:Dn}])}static fromConstant(t){const[e,n]=Math.abs(t).toString(2).split(".",2);let r=Te("0b"+e);t<0&&(r=De(r,On));let i=Dn;var o,s;n&&(o=En,s=Te(n.length),i=Se.exponentiate(o,s),r=xe(De(r,i),Te("0b"+n)));const a=[{indeterminates:new kn,coefficientNumerator:r,coefficientDenominator:i}];return new Pn(a)}negation(){const t=this.terms.map(t=>({indeterminates:t.indeterminates,coefficientNumerator:De(t.coefficientNumerator,On),coefficientDenominator:t.coefficientDenominator}));return new Pn(t)}reciprocal(){const t=this.terms.map(t=>({indeterminates:t.indeterminates.reciprocal(),coefficientNumerator:t.coefficientDenominator,coefficientDenominator:t.coefficientNumerator}));return new Pn(t)}constant(){const t=this.terms.filter(t=>!t.indeterminates.sortedKeys.length);return new Pn(t)}add(t){return new Pn(Pn.simplifyTerms(this.terms.concat(t.terms)))}subtract(t){return this.add(t.negation())}multiply(t){const e=[];for(const n of this.terms)for(const r of t.terms){const t=De(n.coefficientNumerator,r.coefficientNumerator),i=De(n.coefficientDenominator,r.coefficientDenominator),o=Cn(t,i);e.push({indeterminates:kn.multiply(n.indeterminates,r.indeterminates),coefficientNumerator:Ee(t,o),coefficientDenominator:Ee(i,o)})}return new Pn(Pn.simplifyTerms(e))}divide(t){return this.multiply(t.reciprocal())}toString(){const t=[];for(const e of this.terms){const n=ke(e.coefficientNumerator)/ke(e.coefficientDenominator),r=[];if(e.indeterminates.sortedKeys.length){for(const t of e.indeterminates.sortedKeys){const n=e.indeterminates.map.get(t);for(let e=Math.abs(n);e>0;--e)n>0?r.push(t):r.push(`["/",1,${t}]`)}1!==n&&r.push(n.toString()),r.length>1?t.push(`["*",${r.join(",")}]`):t.push(r[0])}else t.push(n.toString())}return t.length?1===t.length?t[0]:`["+",${t.join(",")}]`:"0"}}class Tn{}class In extends Tn{true(){return[[]]}false(){return[]}null(){return[]}}class Nn extends Tn{true(){return[]}false(){return[[]]}null(){return[]}}class jn extends Tn{true(){return[]}false(){return[]}null(){return[[]]}}class Rn extends Tn{constructor(t){if(super(),this.negate=!1,Array.isArray(t)){const e=t[0];"<>"===e?((t=t.slice())[0]="=",this.negate=!0):">="===e?((t=t.slice())[0]="<",this.negate=!0):"<="===e&&((t=t.slice())[0]=">",this.negate=!0)}this.expStr=JSON.stringify(t)}true(t){let e=t.get(this.expStr);return null==e&&t.set(this.expStr,e=t.size),[[e<<2^(this.negate?1:3)]]}false(t){let e=t.get(this.expStr);return null==e&&t.set(this.expStr,e=t.size),[[e<<2^(this.negate?3:1)]]}null(t){let e=t.get(this.expStr);return null==e&&t.set(this.expStr,e=t.size),[[e<<2,e<<2^2]]}}class zn extends Tn{constructor(t){super(),this.exprSynth=t}true(t){return this.exprSynth.false(t)}false(t){return this.exprSynth.true(t)}null(t){return this.exprSynth.null(t)}}class Mn extends Tn{constructor(t){super(),this.exprSynth=t}true(t){return this.exprSynth.null(t)}false(t){return[...this.exprSynth.true(t),...this.exprSynth.false(t)]}null(){return[]}}class Ln extends Tn{constructor(...t){super(),this.exprSynths=t.filter(t=>!(t instanceof Nn));const e=[];this.exprSynths=this.exprSynths.filter(t=>!(t instanceof Ln)||(e.push(...t.exprSynths),!1)),this.exprSynths.push(...e)}true(t){return 0===this.exprSynths.length?[]:1===this.exprSynths.length?this.exprSynths[0].true(t):this.exprSynths.some(t=>t instanceof In)?[[]]:this.exprSynths.map(e=>e.true(t)).flat()}false(t){return 0===this.exprSynths.length?[[]]:1===this.exprSynths.length?this.exprSynths[0].false(t):this.exprSynths.some(t=>t instanceof In||t instanceof jn)?[]:An(this.exprSynths.map(e=>An(e.false(t))).flat())}null(t){if(0===this.exprSynths.length)return[];if(1===this.exprSynths.length)return this.exprSynths[0].null(t);const e=this.exprSynths.map(e=>e.null(t)).flat(),n=this.exprSynths.map(e=>e.true(t)).flat();return An([...An(e),...n])}}class Bn extends Tn{constructor(...t){super(),this.exprSynths=t.filter(t=>!(t instanceof In));const e=[];this.exprSynths=this.exprSynths.filter(t=>!(t instanceof Bn)||(e.push(...t.exprSynths),!1)),this.exprSynths.push(...e)}true(t){return 0===this.exprSynths.length?[[]]:1===this.exprSynths.length?this.exprSynths[0].true(t):this.exprSynths.some(t=>t instanceof Nn||t instanceof jn)?[]:An(this.exprSynths.map(e=>An(e.true(t))).flat())}false(t){return 0===this.exprSynths.length?[]:1===this.exprSynths.length?this.exprSynths[0].false(t):this.exprSynths.some(t=>t instanceof Nn)?[[]]:this.exprSynths.map(e=>e.false(t)).flat()}null(t){if(0===this.exprSynths.length)return[];if(1===this.exprSynths.length)return this.exprSynths[0].null(t);const e=this.exprSynths.map(e=>e.null(t)).flat(),n=this.exprSynths.map(e=>e.false(t)).flat();return An([...An(e),...n])}}class Un extends Tn{constructor(t){super(),this.exprSynths=t}true(t){const e=[],n=[];for(let r=0;r<this.exprSynths.length;r+=2){const i=this.exprSynths[r].true(t),o=this.exprSynths[r+1].true(t);e.push(...An([...n,...An(i),...An(o)])),r<this.exprSynths.length-2&&n.push(...An([...this.exprSynths[r].false(t),...this.exprSynths[r].null(t)]))}return e}false(t){const e=[],n=[];for(let r=0;r<this.exprSynths.length;r+=2){const i=this.exprSynths[r].true(t),o=this.exprSynths[r+1].false(t);e.push(...An([...n,...An(i),...An(o)])),r<this.exprSynths.length-2&&n.push(...An([...this.exprSynths[r].false(t),...this.exprSynths[r].null(t)]))}return e}null(t){const e=[],n=[];for(let r=0;r<this.exprSynths.length;r+=2){const i=this.exprSynths[r].true(t),o=this.exprSynths[r+1].null(t);e.push(...An([...n,...An(i),...An(o)])),n.push(...An([...this.exprSynths[r].false(t),...this.exprSynths[r].null(t)]))}return e.push(...An([...n])),e}}const $n=Pn.fromConstant(0),Fn=Pn.fromConstant(1),qn={"=":"=","<>":"<>",">":"<",">=":"<=","<":">","<=":">="};function Wn(t){if(!Array.isArray(t))return t;const e=t[0];if("FUNC"===e&&"COALESCE"===t[1]){const e=["CASE"];for(let n=2;n<t.length;++n)e.push(Wn(["IS NOT NULL",t[n]]),t[n]);return Wn(e)}if("CASE"===e){const e=[];for(let n=1;n<t.length;n+=2){let r=t[n];if(r instanceof Pn&&(r=JSON.parse(r.toString())),!Array.isArray(r)&&!r)continue;const i=t[n+1];if(Array.isArray(i)&&"CASE"===i[0]){for(let t=1;t<i.length;t+=2)e.push([ue(r,i[t]),i[t+1]]);if(e.push([r,null]),!Array.isArray(r)&&r)break}else e.push([r,i])}for(;null==e[e.length-1][1];)e.pop();return["CASE",...e.flat()]}const n=new Map;for(const[e,r]of t.entries()){if(!Array.isArray(r))continue;if("CASE"!==r[0])continue;const t=[];for(let e=1;e<r.length;e+=2)t.push([r[e],r[e+1]]);n.set(e,t)}if(n.size){let e=[[!0,t]];for(const[t,r]of n){const n=[];for(const[i,o]of r)n.push(...e.map(e=>{const n=e[1].slice();return n[t]=o,[ue(i,e[0]),n]}));e=n}for(const t of e)t[1]=Wn(t[1]);if(!0===e[0][0])return e[0][1];for(;null==e[e.length-1][1];)e.pop();return["CASE",...e.flat()]}function r(t){return null==t?null:t instanceof Pn?t:"number"==typeof t?Pn.fromConstant(t):"string"==typeof t?Pn.fromConstant(parseFloat(t)||0):"boolean"==typeof t?Pn.fromConstant(+t):Pn.fromIndeterminate(t)}if("+"===e){const e=[];for(let n=1;n<t.length;++n){const i=r(t[n]);if(null==i)return null;e.push(i)}return e.reduce((t,e)=>t.add(e),$n)}if("*"===e){const e=[];for(let n=1;n<t.length;++n){const i=r(t[n]);if(null==i)return null;e.push(i)}return e.reduce((t,e)=>t.multiply(e),Fn)}if("-"===e){const e=[];for(let n=1;n<t.length;++n){const i=r(t[n]);if(null==i)return null;e.push(i)}return e.reduce((t,e)=>t.subtract(e))}if("/"===e){const e=[];for(let n=1;n<t.length;++n){const i=r(t[n]);if(null==i)return null;e.push(i)}return e.reduce((t,e)=>t.divide(e))}if(["=","<>",">",">=","<","<="].includes(e)){if(null==t[1]||null==t[2])return null;let n,r;if(t[1]instanceof Pn?n=t[1]:"number"==typeof t[1]&&(n=Pn.fromConstant(t[1])),t[2]instanceof Pn?r=t[2]:"number"==typeof t[2]&&(r=Pn.fromConstant(t[2])),n||r)if(n||(n=Pn.fromIndeterminate(t[1])),r||(r=Pn.fromIndeterminate(t[2])),n=n.subtract(r),r=n.constant().negation(),n=n.add(r),n.terms.length){let i=1;const o=n.terms[0].coefficientNumerator,s=n.terms[0].coefficientDenominator;(Pe(o,xn)||Pe(s,xn))&&(i*=-1);const a=new Pn([{indeterminates:new kn,coefficientNumerator:s,coefficientDenominator:o}]);n=n.multiply(a),r=r.multiply(a);const l=n.terms[0].indeterminates.sortedKeys;let u=n.terms[0].indeterminates.map.get(l[0])<0?-1:0;for(const t of n.terms)for(const e of t.indeterminates.map.values())u+=e;u<0&&(i*=-1,n=n.reciprocal(),r=r.reciprocal()),t=i<0?[qn[e],n,r]:[e,n,r]}else{if(t=[e,JSON.parse(n.toString()),JSON.parse(r.toString())],"="===e)return t[1]===t[2];if("<>"===e)return t[1]!==t[2];if(">"===e)return t[1]>t[2];if(">="===e)return t[1]>=t[2];if("<"===e)return t[1]<t[2];if("<="===e)return t[1]<=t[2]}}return t=ae(t=t.map(t=>t instanceof Pn?JSON.parse(t.toString()):t))}function Jn(t){return(t=Ht(t,Wn))instanceof Pn?t=JSON.parse(t.toString()):Array.isArray(t)&&"CASE"===t[0]&&(t=t.map(t=>t instanceof Pn?JSON.parse(t.toString()):t)),t}function Yn(t){return t instanceof Tn?t:Array.isArray(t)?"CASE"===t[0]?new Un(t.slice(1).map(t=>Yn(t))):new Rn(t):null==t?new jn:t?new In:new Nn}function Vn(t,e){if(!t.length)return!1;const n=[];for(const r of t){if(!r.length)return!0;const t=[];for(const n of r){let r=e.get(n>>>2);if(!(1&n)!=!(2&n)&&(r=["NOT",r]),Array.isArray(r)&&"NOT"===r[0]&&Array.isArray(r[1])){const t=r[1];r="IS NULL"===t[0]?["IS NOT NULL",...t.slice(1)]:"="===t[0]?["<>",...t.slice(1)]:"<>"===t[0]?["=",...t.slice(1)]:">"===t[0]?["<=",...t.slice(1)]:">="===t[0]?["<",...t.slice(1)]:"<"===t[0]?[">=",...t.slice(1)]:"<="===t[0]?[">",...t.slice(1)]:"NOT"===t[0]?t[1]:["NOT",t]}t.push(r)}t.length>1?n.push(["AND"].concat(t)):n.push(t[0])}return n.length>1?["OR"].concat(n):n[0]}function Hn(t){const e=new Map;for(const[n,r]of t){const t=r[0];if(["=",">","<"].includes(t)&&!Array.isArray(r[2])){const i=JSON.stringify(r[1]);let o=e.get(i);o||e.set(i,o=[]),o.push({op:t,rhs:r[2],var:n})}else{const t=JSON.stringify(r);let i=e.get(t);i||e.set(t,i=[]),i.push({op:"",rhs:null,var:n})}}const n=[],r=new Map;for(const[i,o]of e){const e=t.size;t.set(e,["IS NULL",JSON.parse(i)]),'["PARAM","DeviceID.ID"]'!==i&&'["PARAM","_id"]'!==i||n.push([e<<2^3]);const s=new Map;for(const t of o){if(!t.op)continue;const e=JSON.stringify(t.rhs),n=s.get(e);n?n.set(t.op,t.var):s.set(e,new Map([[t.op,t.var]]))}for(const[e,r]of s)if(r.size>1){if(!r.has("=")){const n=t.size;t.set(n,["=",JSON.parse(i),JSON.parse(e)]),o.push({op:"=",rhs:JSON.parse(e),var:n}),r.set("=",n)}if(!r.has(">")){const n=t.size;t.set(n,[">",JSON.parse(i),JSON.parse(e)]),o.push({op:">",rhs:JSON.parse(e),var:n}),r.set(">",n)}if(!r.has("<")){const n=t.size;t.set(n,["<",JSON.parse(i),JSON.parse(e)]),o.push({op:"<",rhs:JSON.parse(e),var:n}),r.set("<",n)}n.push([r.get("=")<<2^1,r.get(">")<<2^1,r.get("<")<<2^1])}for(let t=0;t<o.length;++t){const i=o[t];if(r.set(i.var,e),n.push([e<<2^3,i.var<<2^1]),n.push([e<<2^3,i.var<<2^3]),n.push([i.var<<2^0,i.var<<2^2,e<<2^2]),i.op)for(let e=t+1;e<o.length;++e){const t=o[e];if(!t.op)continue;let r=0;if(Array.isArray(i.rhs)||Array.isArray(t.rhs)){if(JSON.stringify(i.rhs)!==JSON.stringify(t.rhs))continue}else"string"==typeof i.rhs?"string"==typeof t.rhs?i.rhs>t.rhs?r=1:i.rhs<t.rhs&&(r=-1):r=1:r="string"==typeof t.rhs?-1:+i.rhs-+t.rhs;if(i.op===t.op)0===r?n.push([i.var<<2^1,t.var<<2^1]):"="===i.op?n.push([i.var<<2^3,t.var<<2^3]):">"===i.op&&r>0||"<"===i.op&&r<0?n.push([i.var<<2^3,t.var<<2^1]):("<"===i.op&&r>0||">"===i.op&&r<0)&&n.push([i.var<<2^1,t.var<<2^3]);else if("="===i.op||"="===t.op){let e=i,o=t,s=r;"="!==i.op&&(o=i,e=t,s=-r),">"!==o.op&&"<"!==o.op||(0===s?n.push([e.var<<2^3,o.var<<2^3]):s>0&&">"===o.op||s<0&&"<"===o.op?n.push([e.var<<2^3,o.var<<2^1]):n.push([e.var<<2^3,o.var<<2^3]))}else[">","<"].includes(i.op)&&[">","<"].includes(t.op)&&(">"===i.op&&r<0||"<"===i.op&&r>0?n.push([i.var<<2^1,t.var<<2^1]):n.push([i.var<<2^3,t.var<<2^3]))}}}return{dcSet:n,isNull:r}}function Kn(t,e){const n=[];t:for(const r of t){const t=new Map;for(const e of r)t.set(e>>2,(t.get(e>>2)||0)|1<<(3&e));const i=[],o=[];for(const[n,r]of t){if(10===r)continue t;const t=e.get(n)<<2,s=n<<2;5===r?i.push(3^t):1===r?o.push([3^t,3^s]):4===r?o.push([3^t,1^s]):8&r?i.push(3^s):2&r&&i.push(1^s)}let s=[i];for(;o.length;){const t=[],e=o.pop();for(const n of e)t.push(...s.map(t=>[...t,n]));s=t}n.push(...s)}return n}function Gn(t){const e=new Map;let n=t.true(e);const r=new Map(Array.from(e).map(([t,e])=>[e,JSON.parse(t)])),{dcSet:i,isNull:o}=Hn(r);n=Kn(n,o);return n=Sn(n,i,{canRaise:(t,e)=>!(o.has(t>>2)&&1&t&&e.has(3^t))}),Vn(n,r)}function Qn(t){if(!Array.isArray(t))return t;if("CASE"===t[0]){t=t.slice();for(let e=1;e<t.length;e+=2)t[e]=Yn(t[e]);return t}const e=t[0];if("IS NULL"===e)return new Mn(Yn(t[1]));if("IS NOT NULL"===e)return new zn(new Mn(Yn(t[1])));if("NOT"===e)return new zn(Yn(t[1]));if("OR"===e)return new Ln(...t.slice(1).map(t=>Yn(t)));if("AND"===e)return new Bn(...t.slice(1).map(t=>Yn(t)));for(let e=1;e<t.length;++e)if(t[e]instanceof Tn)t[e]=Gn(t[e]);else if(Array.isArray(t[e])&&"CASE"===t[e][0])for(let n=2;n<t[e].length;n+=2)t[e][n]instanceof Tn&&(t[e][n]=Gn(t[e][n]));return t}function Zn(t,e){if(!(e=Jn(e)))return[t,!1];if(e=Ht(e,Qn),!t)return Array.isArray(e)&&"CASE"===e[0]&&(e=Yn(e)),e instanceof Tn&&(e=Gn(e)),[e,e];const n=Yn(e),r=Yn(t=Ht(t=Jn(t),Qn)),i=new Map,o=n.true(i),s=r.true(i),a=r.null(i),l=r.false(i),u=new Map(Array.from(i).map(([t,e])=>[e,JSON.parse(t)])),{dcSet:c,isNull:f}=Hn(u),h=Kn([...s,...o],f),d=Kn(An([...An([...a,...l]),...An(o)]),f),p=function(t){return(e,n)=>{const r=e>>2,i=t.get(r);if(null!=i)return!(1&e)||(!!n.has(i<<2^2)||(!!n.has(i<<2^3)||!n.has(3^e)));for(const[e,i]of t)if(i===r&&!n.has(e<<2^1)&&!n.has(e<<2^3)){if(n.has(e<<2^0))return!1;if(n.has(e<<2^2))return!1}return!0}}(f),g=Sn(h,c,{canRaise:p}),m=Sn(d,c,{canRaise:p});return[Vn(g,u),Vn(m,u)]}function Xn(t,e){if(!(e=Jn(e)))return!0;if(t=Jn(t),!Array.isArray(t))return!!t;const n=Yn(t=Ht(t,Qn)),r=Yn(e=Ht(e,Qn)),i=new Map,o=n.true(i),s=r.true(i),a=new Map(Array.from(i).map(([t,e])=>[e,JSON.parse(t)])),{dcSet:l}=Hn(a);return u=[...An(s),...l,...o],on(rn.from(_n(u)));var u}const tr=ge(Zt),er=ge(le);let nr,rr,ir,or=0;const sr={filter:new WeakMap,bookmark:new WeakMap,limit:new WeakMap,sort:new WeakMap,fulfilled:new WeakMap,fulfilling:new WeakSet,accessed:new WeakMap,value:new WeakMap},ar={};for(const t of["devices","faults","files","presets","provisions","virtualParameters","files","config","users","permissions"])ar[t]={objects:new Map,count:new Map,fetch:new Map,combinedFilter:null};class lr{get fulfilled(){return sr.accessed.set(this,Date.now()),!!sr.fulfilled.get(this)}get fulfilling(){return sr.accessed.set(this,Date.now()),sr.fulfilling.has(this)}get value(){return sr.accessed.set(this,Date.now()),sr.value.get(this)}}async function ur(t){const e=t.extract,n=t.deserialize;return t.extract=(t,r)=>{if("function"==typeof e)return e(t,r);if(304!==t.status&&2!==Math.floor(t.status/100)){const e=new Error;throw e.message=0===t.status?"Server is unrachable":"Unexpected response status code "+t.status,e.code=t.status,e.response=t.responseText,e}let i;if("function"==typeof n)i=n(t.responseText);else if((t.getResponseHeader("content-type")||"").startsWith("application/json"))try{i=t.responseText?JSON.parse(t.responseText):null}catch(e){throw new Error("Invalid JSON: "+t.responseText.slice(0,80))}else i=t.responseText;return i},T.request(t)}function cr(t){if(!Array.isArray(t))return t;return er(t,null,or)}function fr(t,e){const n=tr(e);let r=ar[t].count.get(n);return r||(r=new lr,ar[t].count.set(n,r),sr.filter.set(r,e),r)}function hr(t,e,n){return ue(t,Object.entries(e).sort((t,e)=>Math.abs(e[1])-Math.abs(t[1])).reverse().reduce((t,e)=>{const[r,i]=e;if(i<=0){if(null==n[r])return ce(["IS NOT NULL",["PARAM",r]],ue(["IS NULL",["PARAM",r]],t));let e=null;return e=ce(e,[">",["PARAM",r],n[r]]),ce(e,ue(["=",["PARAM",r],n[r]],t))}{let e=["IS NULL",["PARAM",r]];return null==n[r]?ue(e,t):(e=ce(e,["<",["PARAM",r],n[r]]),ce(e,ue(["=",["PARAM",r],n[r]],t)))}},!0))}function dr(t,e,n,r){let i=[];for(const n of ar[t].objects.values())le(e,n,or)&&i.push(n);return i=i.sort(function(t){const e=Object.entries(t).sort((t,e)=>Math.abs(e[1])-Math.abs(t[1]));return(t,n)=>{for(const[r,i]of e){let e=t[r],o=n[r];if(null!=e&&"object"==typeof e&&(e=e.value?e.value[0]:null),null!=o&&"object"==typeof o&&(o=o.value?o.value[0]:null),e>o)return i;if(e<o)return-1*i;if(e!==o){const t={null:1,number:2,string:3},n=t[null==e?"null":typeof e]||4,r=t[null==o?"null":typeof o]||4;return Math.max(-1,Math.min(1,n-r))*i}}return 0}}(n)),r&&(i=i.slice(0,r)),i}function pr(t,e,n={}){const r=tr(e),i=Object.assign({},n.sort);for(const[t,e]of Object.entries(i))i[t]+=Math.sign(e);const o=n.limit||0;"devices"===t?i["DeviceID.ID"]=i["DeviceID.ID"]||1:i._id=i._id||1;const s=`${r}:${o}:${JSON.stringify(i)}`;let a=ar[t].fetch.get(s);return a||(a=new lr,ar[t].fetch.set(s,a),sr.filter.set(a,e),sr.limit.set(a,o),sr.sort.set(a,i),function(t,e){const n=sr.limit.get(e);let r=sr.filter.get(e);r=cr(r);const i=sr.bookmark.get(e),o=sr.sort.get(e);!i&&n||(i&&(r=hr(r,o,i)),Xn(ar[t].combinedFilter,r)&&sr.fulfilled.set(e,or)),sr.value.set(e,dr(t,r,o,n))}(t,a),a)}function gr(t,e,n){(function(t,e){let n=!1;if(e>or){for(const t of Object.values(ar))t.combinedFilter=null;or=e}const r=[];for(const[e,i]of Object.entries(ar))for(const[o,s]of i.count)sr.accessed.get(s)>=t?sr.fulfilling.has(s)||or<=sr.fulfilled.get(s)||(sr.fulfilling.add(s),r.push(new Promise((t,r)=>{n=!0;let i=sr.filter.get(s);i=cr(i),ur({method:"HEAD",url:`api/${e}/?`+T.buildQueryString({filter:tr(i)}),extract:t=>{if(!t.status)throw new Error("Server is unrachable");if(200!==t.status)throw new Error("Unexpected response status code "+t.status);return+t.getResponseHeader("x-total-count")},background:!0}).then(e=>{sr.value.set(s,e),sr.fulfilled.set(s,or),sr.fulfilling.delete(s),t()}).catch(t=>r(t))}))):i.count.delete(o);const i={};for(const[e,o]of Object.entries(ar))for(const[s,a]of o.fetch)if(sr.accessed.get(a)>=t){if(!(sr.fulfilling.has(a)||or<=sr.fulfilled.get(a))){sr.fulfilling.add(a),i[e]=i[e]||[],i[e].push(a);const t=sr.limit.get(a),o=sr.sort.get(a);t&&r.push(new Promise((r,i)=>{n=!0;let s=sr.filter.get(a);s=cr(s),ur({method:"GET",url:`api/${e}/?`+T.buildQueryString({filter:tr(s),limit:1,skip:t-1,sort:JSON.stringify(o),projection:Object.keys(o).join(",")})}).then(t=>{if(t.length){const e=Object.keys(o).reduce((e,n)=>(null!=t[0][n]&&("object"==typeof t[0][n]?null!=t[0][n].value&&(e[n]=t[0][n].value[0]):e[n]=t[0][n]),e),{});sr.bookmark.set(a,e)}else sr.bookmark.delete(a);r()}).catch(i)}))}}else o.fetch.delete(s);return new Promise((t,e)=>{Promise.all(r).then(()=>{const r=[];for(const[t,e]of Object.entries(i)){let i=null;for(const t of e){let e=sr.filter.get(t);e=er(e,null,or);const n=sr.bookmark.get(t),r=sr.sort.get(t);n&&(e=hr(e,r,n)),i=ce(i,e)}const[o,s]=Zn(ar[t].combinedFilter,i);if(!s){for(const n of e){let e=sr.filter.get(n);e=er(e,null,or);const r=sr.limit.get(n),i=sr.bookmark.get(n),o=sr.sort.get(n);i&&(e=hr(e,o,i)),sr.value.set(n,dr(t,e,o,r)),sr.fulfilled.set(n,or),sr.fulfilling.delete(n)}continue}n=!0;let a=new Set;ar[t].combinedFilter||(a=new Set(ar[t].objects.keys()));const l=s;ar[t].combinedFilter=o,r.push(new Promise((n,r)=>{ur({method:"GET",url:`api/${t}/?`+T.buildQueryString({filter:tr(l)})}).then(r=>{for(const e of r){const n="devices"===t?e["DeviceID.ID"].value[0]:e._id;ar[t].objects.set(n,e),a.delete(n)}for(const e of a){const n=ar[t].objects.get(e);le(l,n,or)&&ar[t].objects.delete(e)}for(const n of e){let e=sr.filter.get(n);e=cr(e);const r=sr.limit.get(n),i=sr.bookmark.get(n),o=sr.sort.get(n);i&&(e=hr(e,o,i)),sr.value.set(n,dr(t,e,o,r)),sr.fulfilled.set(n,or),sr.fulfilling.delete(n)}n()}).catch(r)}))}Promise.all(r).then(()=>t(n)).catch(e)}).catch(e)})})(t,e).then(n,t=>{we("error",t.message),n&&n(!1)})}function mr(t,e){for(const n of e)n.status="pending",n.device=t;return ur({method:"POST",url:`api/devices/${encodeURIComponent(t)}/tasks`,body:e,extract:t=>{if(200!==t.status)throw new Error(t.response);const n=t.getResponseHeader("Connection-Request"),r=JSON.parse(t.response);for(const[t,n]of r.entries())e[t]._id=n._id,e[t].status=n.status,e[t].fault=n.fault;return n}})}function vr(t,e){return ur({method:"POST",url:`api/devices/${encodeURIComponent(t)}/tags`,body:e})}function wr(t,e){return ur({method:"DELETE",url:`api/${t}/${encodeURIComponent(e)}`})}function yr(t,e,n){for(const t in n)void 0===n[t]&&(n[t]=null);return ur({method:"PUT",url:`api/${t}/${encodeURIComponent(e)}`,body:n})}function _r(t,e){const n=["=",["PARAM","devices"===t?"DeviceID.ID":"_id"],e];return ur({method:"HEAD",url:`api/${t}/?`+T.buildQueryString({filter:tr(n)}),extract:t=>{if(!t.status)throw new Error("Server is unrachable");if(200!==t.status)throw new Error("Unexpected response status code "+t.status);return+t.getResponseHeader("x-total-count")},background:!0})}function br(t,e){return Array.isArray(t)?er(t,e,or):t}function Ar(t,e,n){const r={newPassword:e};return n&&(r.authPassword=n),ur({method:"PUT",url:`api/users/${t}/password`,background:!0,body:r})}function Sr(t){return T("svg.icon.icon-"+t,{key:"icon-"+t},T("use",{href:"icons.svg#icon-"+t}))}setInterval((function(){T.request({url:"status",method:"GET",background:!0,extract:t=>{if(200!==t.status)nr||(nr=we("warning","Server is unreachable",{}));else{nr&&(ye(nr),nr=null);const e=t.getResponseHeader("x-config-snapshot")!==be,n=t.getResponseHeader("genieacs-version")!==Ae;!rr!=!e&&(rr?(ye(rr),rr=null):rr=we("warning","Configuration has been modified, please reload the page",{Reload:()=>{window.location.reload()}})),!ir!=!n&&(ir?(ye(ir),ir=null):ir=we("warning","Server has been updated, please reload the page",{Reload:()=>{window.location.reload()}}))}}}).catch(t=>{we("error",t.message)})}),3e3);const xr=new Set,Dr=new Set;function Er(t){let e=xr.size;for(const n of t)xr.has(n)||++e;return e<=100}function Or(...t){if(Er(t))for(const e of t)e.status="queued",xr.add(e);else we("error","Too many tasks in queue")}function kr(t){xr.delete(t)}function Cr(){return xr}function Pr(){xr.clear()}function Tr(){return Dr}function Ir(t){xr.size+t.devices.length>100?we("error","Too many tasks in queue"):Dr.add(t)}function Nr(t,e){const n={};if(!Er(t))return Promise.reject(new Error("Too many tasks in queue"));for(const e of t)n[e.device]=n[e.device]||[],n[e.device].push(e),e.status="queued",xr.add(e);return new Promise(t=>{let r=1;for(const[i,o]of Object.entries(n))++r,mr(i,o).then(n=>{for(const t of o)"pending"===t.status?t.status="stale":"done"===t.status&&xr.delete(t);e(i,null,n,o),0==--r&&t()}).catch(n=>{for(const t of o)t.status="stale";e(i,n,null,o),0==--r&&t()});0==--r&&t()})}const jr=new WeakSet;function Rr(t){return T("span.parameter",{title:t},""+t)}function zr(t,e,n){function r(t){13===t.keyCode?e():27===t.keyCode?n():t.redraw=!1}let i;return i="xsd:boolean"===t.parameterValues[0][2]?T("select",{value:t.parameterValues[0][1].toString(),onchange:e=>{e.redraw=!1,t.parameterValues[0][1]=i.dom.value},onkeydown:r,oncreate:t=>{t.dom.focus()}},[T("option",{value:"true"},"true"),T("option",{value:"false"},"false")]):T("input",{type:["xsd:dateTime","xsd:int","xsd:unsignedInt"].includes(t.parameterValues[0][2])?"number":"text",value:t.parameterValues[0][1],oninput:e=>{e.redraw=!1,t.parameterValues[0][1]=i.dom.value},onkeydown:r,oncreate:t=>{t.dom.focus(),t.dom.select(),t.dom.parentNode.parentNode.scrollTop=0}}),[T("span","Editing ",Rr(t.parameterValues[0][0])),i]}function Mr(t){t.fileName&&t.fileType?jr.delete(t):jr.add(t);const e=pr("files",!0);let n="",r="";for(const e of t.devices){const t=e.split("-");""===n?n=t[0]:n!==t[0]&&(n=null),3===t.length&&(""===r?r=t[1]:r!==t[1]&&(r=null))}n&&(n=decodeURIComponent(n)),r&&(r=decodeURIComponent(r));const i=["","1 Firmware Upgrade Image","2 Web Content","3 Vendor Configuration File","4 Tone File","5 Ringer File"].map(e=>T("option",{disabled:!e,value:e,selected:(t.fileType||"")===e},e)),o=[""].concat(e.value.filter(t=>!(t["metadata.oui"]&&t["metadata.oui"]!==n||t["metadata.productClass"]&&t["metadata.productClass"]!==r)).map(t=>t._id)).map(e=>T("option",{disabled:!e,value:e,selected:(t.fileName||"")===e},e));return["Push ",T("select",{onchange:n=>{const r=n.target.value;t.fileName=r,t.fileType="";for(const n of e.value)n._id===r&&(t.fileType=n["metadata.fileType"])},disabled:e.fulfilling,style:"width: 350px"},o)," as ",T("select",{onchange:e=>{t.fileType=e.target.value}},i)]}const Lr=()=>({view:t=>{const e=Cr(),n=Tr();let r,i;const o=function(t){const e=[];for(const n of t){let t;if(n.actions){const e=Object.entries(n.actions).map(([t,e])=>T("button.primary",{onclick:e},t));e.length&&(t=T("div",{style:"float: right"},e))}e.push(T("div.notification",{class:n.type,style:"position: absolute;opacity: 0",oncreate:t=>{t.dom.style.opacity="1"},onbeforeremove:t=>(t.dom.style.opacity="0",new Promise(t=>{setTimeout(()=>{t()},500)})),key:n.timestamp},T("div",t,n.message)))}return e}(ve),s=function(t){const e=[];for(const n of t){const r=()=>{t.delete(n);for(const t of n.devices){const e=Object.assign({device:t},n);delete e.devices,Or(e)}},i=()=>{t.delete(n)};let o;"setParameterValues"===n.name?o=zr(n,r,i):"download"===n.name&&(o=Mr(n));const s=T("button.primary",{title:"Queue task",onclick:r,disabled:jr.has(n)},"Queue"),a=T("button",{title:"Cancel edit",onclick:i},"Cancel");e.push(T(".staging",o,T("div.actions",s,a)))}return e}(n),a=function(t){const e=[],n={};for(const e of t)n[e.device]=n[e.device]||[],n[e.device].push(e);for(const[t,i]of Object.entries(n)){e.push(T("strong",t));for(const t of i){const n=[];"fault"!==t.status&&"stale"!==t.status||n.push(T("button",{title:"Retry this task",onclick:()=>{Or(t)}},Sr("retry"))),n.push(T("button",{title:"Remove this task",onclick:()=>{kr(t)}},Sr("remove"))),"setParameterValues"===t.name?e.push(T("div."+t.status,T("span","Set ",Rr(t.parameterValues[0][0])," to '",(r=t.parameterValues[0][1],T("span.value",{title:r},""+r)),"'"),T(".actions",n))):"refreshObject"===t.name?e.push(T("div."+t.status,T("span","Refresh ",Rr(t.parameterName)),T(".actions",n))):"reboot"===t.name?e.push(T("div."+t.status,"Reboot",T(".actions",n))):"factoryReset"===t.name?e.push(T("div."+t.status,"Factory reset",T(".actions",n))):"addObject"===t.name?e.push(T("div."+t.status,T("span","Add ",Rr(t.objectName)),T(".actions",n))):"deleteObject"===t.name?e.push(T("div."+t.status,T("span","Delete ",Rr(t.objectName)),T(".actions",n))):"getParameterValues"===t.name?e.push(T("div."+t.status,`Refresh ${t.parameterNames.length} parameters`,T(".actions",n))):"download"===t.name?e.push(T("div."+t.status,`Push file: ${t.fileName} (${t.fileType})`,T(".actions",n))):e.push(T("div."+t.status,t.name,T(".actions",n)))}}var r;return e}(e);function l(){let t=10;for(const e of o)e.dom.style.top=""+t,t+=e.dom.offsetHeight+10}function u(){let e=i.dom.offsetTop+i.dom.offsetHeight;if(s.length)for(const t of s)e=Math.max(e,t.dom.offsetTop+t.dom.offsetHeight);else if(t.state.mouseIn)for(const t of r.children)e=Math.max(e,t.dom.offsetTop+t.dom.offsetHeight);r.dom.style.height=e}if(s.length+a.length){const n={queued:0,pending:0,fault:0,stale:0};for(const t of e)n[t.status]+=1;const o=T(".actions",T("button.primary",{title:"Commit queued tasks",disabled:!n.queued,onclick:()=>{Nr(Array.from(Cr()).filter(t=>"queued"===t.status),(t,e,n,r)=>{if(e)we("error",`${t}: ${e.message}`);else if("OK"===n){for(const e of r){if("stale"===e.status)return void we("error",t+": No contact from device");if("fault"===e.status)return void we("error",t+": Task(s) faulted")}we("success",t+": Task(s) committed")}else we("error",`${t}: ${n}`)}).then(()=>{gr(0,Date.now())}).catch(t=>{we("error",t.message)})}},"Commit"),T("button",{title:"Clear tasks",onclick:Pr,disabled:!a.length},"Clear"));i=T(".status",T("span.queued",{class:n.queued?"active":""},"Queued: "+n.queued),T("span.pending",{class:n.pending?"active":""},"Pending: "+n.pending),T("span.fault",{class:n.fault?"active":""},"Fault: "+n.fault),T("span.stale",{class:n.stale?"active":""},"Stale: "+n.stale),o),r=T(".drawer",{key:"drawer",style:"opacity: 0;height: 0;",oncreate:e=>{t.state.mouseIn=!1,e.dom.style.opacity="1",u()},onmouseover:e=>{t.state.mouseIn=!0,u(),e.redraw=!1},onmouseleave:e=>{t.state.mouseIn=!1,u(),e.redraw=!1},onupdate:u,onbeforeremove:t=>(t.dom.onmouseover=null,t.dom.onmouseleave=null,t.dom.style.opacity="0",t.dom.style.height="0",new Promise(t=>{setTimeout(t,500)}))},i,s.length?s:T(".queue",a))}return T("div.drawer-wrapper",r,T("div.notifications-wrapper",{key:"notifications",style:"position: relative;",onupdate:l,oncreate:l},o))}}),Br=()=>({view:()=>window.username?T("div.user-menu",window.username,T("button",{onclick:t=>(t.target.disabled=!0,ur({method:"POST",url:"logout"}).then(()=>{location.hash="",location.reload()}).catch(e=>{t.target.disabled=!1,we("error",e.message)}),!1)},"Log out")):T("div.user-menu",T("a",{href:"#!/login?"+T.buildQueryString({continue:T.route.get()})},"Log in"))}),Ur=()=>({view:t=>{const e={[t.attrs.page]:"active"},n=[];return window.authorizer.hasAccess("presets",1)&&n.push(T("li",{class:e.presets},T("a",{href:"#!/admin/presets"},"Presets"))),window.authorizer.hasAccess("provisions",1)&&n.push(T("li",{class:e.provisions},T("a",{href:"#!/admin/provisions"},"Provisions"))),window.authorizer.hasAccess("virtualParameters",1)&&n.push(T("li",{class:e.virtualParameters},T("a",{href:"#!/admin/virtualParameters"},"Virtual Parameters"))),window.authorizer.hasAccess("files",1)&&n.push(T("li",{class:e.files},T("a",{href:"#!/admin/files"},"Files"))),window.authorizer.hasAccess("config",1)&&n.push(T("li",{class:e.config},T("a",{href:"#!/admin/config"},"Config"))),window.authorizer.hasAccess("permissions",1)&&n.push(T("li",{class:e.permissions},T("a",{href:"#!/admin/permissions"},"Permissions"))),window.authorizer.hasAccess("users",1)&&n.push(T("li",{class:e.users},T("a",{href:"#!/admin/users"},"Users"))),T("nav#side-menu",T("ul",n))}});let $r=null;function Fr(t){$r=t}function qr(t){return t===$r&&($r=null,!0)}document.addEventListener("keydown",t=>{$r&&27===t.keyCode&&qr($r)&&T.redraw()}),window.addEventListener("popstate",()=>{qr($r)&&T.redraw()});const Wr=["presets","provisions","virtualParameters","files","config","users","permissions"],Jr=()=>({view:t=>{let e,n;if(Wr.includes(t.attrs.page)){n="admin";const r={};r.page=t.attrs.page,e=T(Ur,r)}const r={};return r.page=n||t.attrs.page,[T("#header",[T("img.logo",{src:"logo.svg"}),T(Br),T(I,r),T(Lr)]),T("#content-wrapper",e,T("#content",{class:"page-"+t.attrs.page},[t.children])),$r?T(".overlay-wrapper",{tabindex:0,onclick:()=>{qr($r)},style:"opacity: 0",oncreate:t=>{t.dom.focus(),t.dom.style.opacity="1"},onbeforeremove:t=>(t.dom.style.opacity="0",new Promise(t=>{setTimeout(()=>{t()},500)}))},T(".overlay",{onclick:t=>{t.stopPropagation()}},$r())):null]}});const Yr=Object.freeze({__proto__:null,init:async function(){return T.request({url:"init"})},component:t=>{let e=t.attrs;const n=new Set;for(const[t,r]of Object.entries(e))r&&n.add(t);return{view:()=>{document.title="Initialization wizard - GenieACS";const t=["users","presets","filters","device","index","overview"].map(t=>(e[t]||n.delete(t),T("input",{type:"checkbox",checked:n.has(t),disabled:!e[t],style:"display: inline; margin-right: 0.5em;",onclick:e=>{e.target.checked?n.add(t):n.delete(t)}})));return T(".wizard-dialog",[T("h1","Initialization wizard"),T("p","This wizard will seed the database with a minimal initial configuration to serve as a starting point. Select what you want to initialize and click 'ABRACADABRA!'."),T("div",T("label",t[0],"Users, roles and permissions")),T("div",T("label",t[1],"Presets and provisions")),T("div",T("label",t[2],"Devices predefined search filters")),T("div",T("label",t[3],"Device details page")),T("div",T("label",t[4],"Devices listing page")),T("div",T("label",t[5],"Overview page")),T("button.primary",{style:"margin: 10px;",disabled:0===n.size,onclick:t=>{t.target.disabled=!0;const r={};for(const t of n)r[t]=!0;T.request({method:"POST",url:"init",body:r}).then(()=>{setTimeout(()=>{T.request({url:"init"}).then(n=>{t.target.disabled=!1,e=n,we("success","Initialization complete",{"Open Sesame!":()=>{T.route.set("/login"),window.location.reload()}})}).catch(t=>{we("error",t.message)})},3e3),r.users&&alert("An administrator user has been created for you. Use admin/admin to log in. Don't forget to change the default password.")}).catch(t=>{we("error",t.message)})}},"ABRACADABRA!")])}}}}),Vr={year:31104e6,month:2592e6,day:864e5,hour:36e5,minute:6e4,second:1e3};const Hr=ge((t,e,n)=>{let r=n;t=le(t,null,n,t=>{if(!Array.isArray(t))return t;for(let n=1;n<t.length;++n)if(Array.isArray(t[n])&&"PARAM"===t[n][0]&&!Array.isArray(t[n][1])){let i=null;const o=e[t[n][1]];o&&o.value&&(i=o.value[0],r=Math.min(r,o.valueTimestamp)),(t=t.slice())[n]=i}return"FUNC"!==t[0]||"DATE_STRING"!==t[1]||Array.isArray(t[2])?t:new Date(t[2]).toLocaleString()});let i=null,o=null;if(Array.isArray(t)){if("PARAM"===t[0]){const n=e[t[1]];n&&n.value&&(r=n.valueTimestamp,o=n.value[0],i=t[1])}}else o=t;return{value:o,timestamp:r,parameter:i}}),Kr=_e.ui.overview.charts,Gr=ge(Qt);const Qr=new WeakMap;const Zr={parameter:()=>({view:t=>{const e=t.attrs.device,{value:n,timestamp:r,parameter:i}=Hr(t.attrs.parameter,t.attrs.device,or);if(null==n)return null;let o;e[i]&&e[i].writable&&(o=ei("button",{title:"Edit parameter value",onclick:()=>{var t;t={name:"setParameterValues",devices:[e["DeviceID.ID"].value[0]],parameterValues:[[i,e[i].value[0],e[i].value[1]]]},xr.size+t.devices.length>100?we("error","Too many tasks in queue"):Dr.add(t)}},Sr("edit")));const s=ei("long-text",{text:""+n});return ei("span",{class:"parameter-value",onmouseover:t=>{if(t.redraw=!1,t.target===s.dom){const e=Date.now(),n=new Date(r).toLocaleString();t.target.title=`${n} (${function(t){let e="",n=2;for(const[r,i]of Object.entries(Vr))if(t>=i){let o;if(n>1?(o=Math.floor(t/i),t-=o*i):o=Math.round(t/i),e+=o>1?`${o} ${r}s `:`${o} ${r} `,!--n)break}return e+"ago"}(e-r)})`}}},s,o)}}),"parameter-list":()=>({view:t=>{const e=t.attrs.device,n=Object.values(t.attrs.parameters).map(t=>{const n=ei.context({device:e,parameter:t.parameter},t.type||"parameter",t);return ei("tr",{onupdate:t=>{t.dom.style.display=n.dom?"":"none"}},ei("th",t.label),ei("td",n))});return ei("table.parameter-list",n)}}),"parameter-table":()=>({oninit:t=>{const e=t.attrs.parameter;if(!Array.isArray(e)||"PARAM"!==e[0])throw new Error("Object must be a parameter path");t.state.object=e[1],t.state.parameters=Object.values(t.attrs.childParameters)},view:t=>{const e=t.attrs.device,n=br(t.state.object,e),r=t.state.parameters;if("string"!=typeof n||!e[n])return null;const i=new Set,o=n+".";for(const t in e)if(t.startsWith(o)){const e=t.indexOf(".",o.length);-1===e?i.add(t):i.add(t.slice(0,e))}const s=Object.values(r).map(t=>ei("th",t.label)),a=ei("thead",ei("tr",s)),l=[];for(const n of i){let i=null==t.attrs.filter||t.attrs.filter;if(i=Ht(i,t=>Array.isArray(t)&&"PARAM"===t[0]?["PARAM",["||",n,".",t[1]]]:t),!br(i,e))continue;const o=r.map(t=>{const r=Ht(t.parameter,t=>Array.isArray(t)&&"PARAM"===t[0]?["PARAM",["||",n,".",t[1]]]:t);return ei("td",ei.context({device:e,parameter:r},t.type||"parameter",Object.assign({},t,{device:e,parameter:r,label:null})))});!0===e[n].writable&&o.push(ei("td",ei("button",{title:"Delete this instance",onclick:()=>{Or({name:"deleteObject",device:e["DeviceID.ID"].value[0],objectName:n})}},Sr("delete-instance")))),l.push(ei("tr",o))}let u;return l.length||l.push(ei("tr.empty",ei("td",{colspan:s.length},"No instances"))),!0===e[n].writable&&l.push(ei("tr",ei("td",{colspan:s.length}),ei("td",ei("button",{title:"Create a new instance",onclick:()=>{Or({name:"addObject",device:e["DeviceID.ID"].value[0],objectName:n})}},Sr("add-instance"))))),t.attrs.label&&(u=ei("h2",t.attrs.label)),[u,ei("table.table",a,ei("tbody",l))]}}),"overview-dot":()=>({view:t=>{const e=t.attrs.device,n=Kr[t.attrs.chart];if(!n)return null;for(const t of Object.values(n.slices)){if(br(t.filter,e)){const e=ei("svg",{width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},ei("circle",{cx:"0.5em",cy:"0.5em",r:"0.4em",fill:t.color}));return ei("span.overview-dot",e,""+t.label)}}return null}}),container:()=>({view:t=>{if(t.attrs.filter&&!br(t.attrs.filter,t.attrs.device))return null;const e=Object.values(t.attrs.components).map(t=>"object"!=typeof t?""+t:ei(t.type,t));return t.attrs.element?ei(t.attrs.element,e):e}}),"summon-button":()=>({view:t=>{const e=t.attrs.device;return ei("button.primary",{title:"Initiate session and refresh basic parameters",onclick:n=>{n.target.disabled=!0;Nr([{name:"getParameterValues",parameterNames:Object.values(t.attrs.parameters).map(t=>Array.isArray(t)&&"PARAM"===t[0]?br(t[1],e):null).filter(t=>!!t),device:e["DeviceID.ID"].value[0]}],(t,e,n,r)=>{if(e)we("error",`${t}: ${e.message}`);else{for(const t of r)"stale"===t.status&&kr(t);"OK"!==n?we("error",`${t}: ${n}`):"stale"===r[0].status?we("error",t+": No contact from device"):"fault"===r[0].status?we("error",t+": Refresh faulted"):we("success",t+": Summoned")}}).then(()=>{n.target.disabled=!1,gr(0,Date.now())}).catch(t=>{n.target.disabled=!1,we("error",t.message)})}},"Summon")}}),"device-faults":()=>({view:t=>{const e=t.attrs.device["DeviceID.ID"].value[0],n=pr("faults",["AND",[">",["PARAM","_id"],e+":"],["<",["PARAM","_id"],e+":zzzz"]]),r=["Channel","Code","Message","Retries","Timestamp"].map(t=>ei("th",t)),i=ei("thead",ei("tr",r)),o=[];for(const t of n.value)o.push([ei("td",t.channel),ei("td",t.code),ei("td",t.message),ei("td",t.retries),ei("td",new Date(t.timestamp).toLocaleString()),ei("td",ei("button",{title:"Delete fault",onclick:e=>{e.redraw=!1,wr("faults",t._id).then(()=>{we("success","Fault deleted"),gr(Date.now(),Date.now()),ei.redraw()}).catch(t=>{we("error",t.message),gr(Date.now(),Date.now())})}},Sr("remove")))]);let s;return s=o.length?ei("tbody",o.map(t=>ei("tr",t))):ei("tbody",ei("tr.empty",ei("td",{colspan:r.length},"No faults"))),ei("table.table",i,s)}}),"all-parameters":()=>({view:t=>{const e=t.attrs.device,n=ei("input",{type:"text",placeholder:"Search parameters",oninput:e=>{t.state.searchString=e.target.value,e.redraw=!1,clearTimeout(t.state.timeout),t.state.timeout=setTimeout(ei.redraw,500)}}),r=/\.[0-9]+$/;let i;if(t.state.searchString){const e=t.state.searchString.split(" ").filter(t=>t);e.length&&(i=new RegExp(e.map(t=>t.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")).join(".*"),"i"))}const o=[],s=function(t){if(Qr.has(t))return Qr.get(t);const e=[];for(const n of Object.keys(t)){let t=0;for(let e=n.lastIndexOf(".",n.length-2);e>=0;e=n.lastIndexOf(".",e-1))++t;for(;e.length<=t;)e.push([]);e[t].push(n)}return Qr.set(t,e),e}(e);let a=0;for(const t of s){let n=0;for(const r of t){const t=e[r],s=t.value&&t.value[0]?`${r} ${t.value[0]}`:r;i&&!i.test(s)||(++n,a<100&&o.push(r))}a+=n}o.sort();const l=o.map(t=>{const n=e[t],i=[],o={key:t};return!1===n.object?i.push(ei("parameter",Object.assign({device:e,parameter:Gr(t)}))):n.object&&n.writable&&(r.test(t)?i.push(ei("button",{title:"Delete this instance",onclick:()=>{Or({name:"deleteObject",device:e["DeviceID.ID"].value[0],objectName:t})}},Sr("delete-instance"))):i.push(ei("button",{title:"Create a new instance",onclick:()=>{Or({name:"addObject",device:e["DeviceID.ID"].value[0],objectName:t})}},Sr("add-instance")))),i.push(ei("button",{title:"Refresh tree",onclick:()=>{Or({name:"getParameterValues",device:e["DeviceID.ID"].value[0],parameterNames:[t]})}},Sr("refresh"))),ei("tr",o,ei("td.left",ei("long-text",{text:t})),ei("td.right",i))});return ei(".all-parameters",ei("a.download-csv",{href:`api/devices/${encodeURIComponent(e["DeviceID.ID"].value[0])}.csv`,download:"",style:"float: right;"},"Download"),n,ei(".parameter-list",ei("table",ei("tbody",l)),ei("m",`Displaying ${o.length} out of ${a} parameters.`)))}}),"device-actions":()=>({view:t=>{const e=t.attrs.device,n=[];return n.push(ei("button.primary",{title:"Reboot device",onclick:()=>{Or({name:"reboot",device:e["DeviceID.ID"].value[0]})}},"Reboot")),n.push(ei("button.critical",{title:"Factory reset device",onclick:()=>{Or({name:"factoryReset",device:e["DeviceID.ID"].value[0]})}},"Reset")),n.push(ei("button.critical",{title:"Push a firmware or a config file",onclick:()=>{Ir({name:"download",devices:[e["DeviceID.ID"].value[0]]})}},"Push file")),n.push(ei("button.primary",{title:"Delete device",onclick:()=>{if(!confirm("Deleting this device. Are you sure?"))return;const t=e["DeviceID.ID"].value[0];wr("devices",t).then(()=>{we("success",t+": Device deleted"),ei.route.set("/devices")}).catch(t=>{we("error",t.message)})}},"Delete")),ei(".actions-bar",n)}}),tags:()=>({view:t=>{const e=t.attrs.device;let n=!0;null!=t.attrs.writable&&(n=t.attrs.writable);const r=[];for(const t of Object.keys(e))t.startsWith("Tags.")&&r.push(t.slice(5));return r.sort(),n?ei(".tags",r.map(t=>ei("span.tag",t,ei("button",{onclick:n=>{n.target.disabled=!0;const r=e["DeviceID.ID"].value[0];vr(r,{[t]:!1}).then(()=>{n.target.disabled=!1,we("success",r+": Tags updated"),gr(0,Date.now())}).catch(t=>{n.target.disabled=!1,we("error",`${r}: ${t.message}`)})}},Sr("remove")))),ei("span.tag.writable",ei.trust("&nbsp;"),ei("button",{onclick:t=>{t.target.disabled=!0;const n=e["DeviceID.ID"].value[0],r=prompt("Enter tag to assign to device:");r?vr(n,{[r]:!0}).then(()=>{t.target.disabled=!1,we("success",n+": Tags updated"),gr(0,Date.now())}).catch(e=>{t.target.disabled=!1,we("error",`${n}: ${e.message}`)}):t.target.disabled=!1}},Sr("add")))):ei(".tags",r.map(t=>ei("span.tag",t)))}}),ping:t=>{let e,n;const r=()=>{if(!n){const e=t.dom;return void(e&&(e.innerHTML=""))}let r="";(function(t){return ur({url:"api/ping/"+encodeURIComponent(t),background:!0})})(n).then(t=>{r=null!=t.avg?Math.trunc(t.avg)+" ms":"Unreachable"}).catch(()=>{r="Error!",clearInterval(e)}).finally(()=>{const e=t.dom;e&&(e.innerHTML=`Pinging ${n}: ${r}`)})};return{onremove:()=>{clearInterval(e)},view:t=>{const i=t.attrs.device;let o,s=i["InternetGatewayDevice.ManagementServer.ConnectionRequestURL"];if(s||(s=i["Device.ManagementServer.ConnectionRequestURL"]),s&&s.value){o=new URL(s.value[0]).hostname}return n!==o&&(n=o,clearInterval(e),n&&(r(),e=setInterval(r,3e3))),ei("div",`Pinging ${n}:`)}}},"device-link":()=>({view:t=>{let e;t.attrs.device&&(e=t.attrs.device["DeviceID.ID"].value[0]);const n=Object.values(t.attrs.components).map(e=>{if("object"!=typeof e)return""+e;const n=Object.assign({},t.attrs,e);return ei(n.type,n)});return e?ei("a",{href:"#!/devices/"+encodeURIComponent(e)},n):n}}),"long-text":()=>({view:t=>{const e=t.attrs.text,n=t.attrs.element||"span";function r(t){t.dom.classList.add("long-text-overflowed"),t.dom.onclick=t=>{Fr(()=>T("textarea.long-text",{value:e,cols:80,rows:24,readonly:"",oncreate:t=>{t.dom.focus(),t.dom.select()}})),t.stopPropagation(),T.redraw()}}return T(n,{oncreate:t=>{t.dom.clientWidth!==t.dom.scrollWidth&&r(t)},onupdate:t=>{t.dom.clientWidth===t.dom.scrollWidth?(t.dom.classList.remove("long-text-overflowed"),t.dom.onclick=null):r(t)},class:"long-text",title:e},e)}})},Xr=new WeakMap,ti=new WeakMap,ei=new Proxy(T,{apply:(t,e,n)=>{const r=n[0];return"string"!=typeof r?n[0]=ii(r):Zr[r]&&(n[0]=ii(Zr[r])),Reflect.apply(t,void 0,n)},get:(t,e)=>"context"===e?ni:Reflect.get(t,e)});function ni(t,...e){const n=Reflect.apply(ei,void 0,e);return ti.set(n,t),n}function ri(t,e){if(Array.isArray(t))for(const n of t)ri(n,e);else if(t&&"object"==typeof t&&t.tag){const n=Object.assign({},e,ti.get(t));if("string"!=typeof t.tag&&(ti.set(t,n),t.attrs=Object.assign({},n,t.attrs)),t.children&&t.children.length)for(const e of t.children)ri(e,n)}}function ii(t){let e=Xr.get(t);if(!e){if("function"!=typeof t){e=Object.assign({},t);const n=t.view;e.view=function(t){const e=ti.get(t)||{},r=Reflect.apply(n,this,[t]);return ri(r,e),r}}else{if(t.prototype&&t.prototype.view)throw new Error("Class components not supported");e=e=>{const n=t(e),r=n.view;return n.view=function(t){const e=ti.get(t)||{},n=Reflect.apply(r,this,[t]);return ri(n,e),n},n}}Xr.set(t,e)}return e}const oi=()=>({view:t=>{const e=t.attrs.onPasswordChange,n=!t.attrs.noAuth,r=t.attrs.username;r&&(t.state.username=r);const i=[ei("p",ei("label",{for:"username"},"Username"),ei("input",{name:"username",type:"text",value:t.state.username,disabled:!!r,oninput:e=>{t.state.username=e.target.value},oncreate:t=>{t.dom.focus()}}))];let o={newPassword:"New password",confirmPassword:"Confirm password"};n&&(o=Object.assign({authPassword:"Your password"},o));for(const[e,n]of Object.entries(o))i.push(ei("p",ei("label",{for:e},n),ei("input",{name:e,type:"password",value:t.state[e],oninput:n=>{t.state[e]=n.target.value}})));const s=ei("button.primary",{type:"submit"},"Change password");i.push(ei(".actions-bar",s));const a=[ei("h1","Change password"),ei("form",{onsubmit:r=>{r.redraw=!1,r.preventDefault(),!t.state.username||!t.state.newPassword||n&&!t.state.authPassword?we("error","Please fill all fields"):t.state.newPassword!==t.state.confirmPassword?we("error","Password confirm doesn't match new password"):(s.dom.disabled=!0,Ar(t.state.username,t.state.newPassword,t.state.authPassword).then(()=>{we("success","Password updated successfully"),e&&e(),s.dom.disabled=!1}).catch(t=>{we("error",t.message),s.dom.disabled=!1}))}},i)];return ei("div.put-form",a)}});const si=Object.freeze({__proto__:null,init:function(t){return Promise.resolve(t)},component:()=>({view:t=>(window.username&&ei.route.set(t.attrs.continue||"/"),document.title="Login - GenieACS",[ei("h1","Log in"),ei("form",ei("p",ei("label",{for:"username"},"Username"),ei("input",{name:"username",type:"text",value:t.state.username,oncreate:t=>{t.dom.focus()},oninput:e=>{t.state.username=e.target.value}})),ei("p",ei("label",{for:"password"},"Password"),ei("input",{name:"password",type:"password",value:t.state.password,oninput:e=>{t.state.password=e.target.value}})),ei("p",ei("button.primary",{type:"submit",onclick:e=>{var n,r;return e.target.disabled=!0,(n=t.state.username,r=t.state.password,ur({method:"POST",url:"login",background:!0,body:{username:n,password:r}})).then(()=>{location.reload()}).catch(t=>{we("error",t.response||t.message),e.target.disabled=!1}),!1}},"Login"))),ei("a",{onclick:()=>{const t=()=>{const e={onPasswordChange:()=>{qr(t),ei.redraw()}};return ei(oi,e)};Fr(t)}},"Change password")])})}),ai=ge(Zt);const li=()=>({view:t=>function(t){const e=t.slices,n=Array.from(Object.values(t.slices)).reduce((t,e)=>t+(e.count.value||0),0),r=[],i=[],o=[];let s,a,l=0,u=100*Math.cos(2*Math.PI*l),c=100*Math.sin(2*Math.PI*l);for(const t of Object.values(e)){const e=n>0?(t.count.value||0)/n:0;if(r.push(ei(".legend-line",[ei("span.color",{style:`background-color: ${t.color} !important;`}),t.label+": ",ei("a",{href:"#!/devices/?"+ei.buildQueryString({filter:ai(t.filter)})},t.count.value||0),` (${(100*e).toFixed(2)}%)`])),e>0){l+=e,s=100*Math.cos(2*Math.PI*l),a=100*Math.sin(2*Math.PI*l);const n=`M ${u} ${c} A 100 100 0 ${e>.5?1:0} 1 ${s} ${a} L 0 0 z`;u=s,c=a,i.push(ei("path",{d:n,fill:t.color}));const r=50*Math.cos(2*Math.PI*(l-e/2)),f=50*Math.sin(2*Math.PI*(l-e/2));o.push(ei("a",{"xlink:href":"#!/devices/?"+ei.buildQueryString({filter:ai(t.filter)})},[ei("path",{d:n,"fill-opacity":0}),ei("text",{x:r,y:f,"dominant-baseline":"middle","text-anchor":"middle"},(100*e).toFixed(2)+"%")]))}}return r.push(ei("span.legend-total","Total: "+n)),ei("div",{class:"pie-chart"},[ei("svg",{viewBox:"-102 -102 204 204",width:"204px",height:"204px",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},i.concat(o)),ei(".legend",r)])}(t.attrs.chart)}),ui=_e.ui.overview.groups||{},ci={};for(const t of Object.values(ui))for(const e of Object.values(t.charts))ci[e]=_e.ui.overview.charts[e];function fi(t){t=Object.assign({},t);for(let[e,n]of Object.entries(t)){t[e]=n=Object.assign({},n),n.slices=Object.assign({},n.slices);for(let[t,e]of Object.entries(n.slices)){const r=e.filter;n.slices[t]=e=Object.assign({},e),e.count=fr("devices",r)}}return t}const hi=Object.freeze({__proto__:null,init:function(){return window.authorizer.hasAccess("devices",1)?Promise.resolve({charts:fi(ci)}):Promise.reject(new Error("You are not authorized to view this page"))},component:()=>({view:t=>{document.title="Overview - GenieACS";const e=[];for(const n of Object.values(ui)){n.label&&e.push(ei("h1",n.label));const r=[];for(const e of Object.values(n.charts)){const n=t.attrs.charts[e],i=[];n.label&&i.push(ei("h2",n.label));const o={};o.chart=n,i.push(ei(li,o)),r.push(ei(".overview-chart",i))}e.push(ei(".overview-chart-group",r))}return e}})});const di=()=>{let t=new Set;return{view:e=>{const n=e.attrs.attributes,r=e.attrs.data,i=e.attrs.valueCallback,o=e.attrs.total,s=e.attrs.showMoreCallback,a=e.attrs.sortAttributes,l=e.attrs.onSortChange,u=e.attrs.downloadUrl,c=e.attrs.actionsCallback,f=e.attrs.recordActionsCallback,h=new Set;for(const e of r){const n=e._id||e["DeviceID.ID"].value[0];t.has(n)&&h.add(n)}return t=h,function(t,e,n,r,i,o,s,a,l,u,c){const f=e||[];let h=[];"function"==typeof u?(h=u(i),Array.isArray(h)||(h=[h])):Array.isArray(u)&&(h=u);const d=[];if(h.length){const t=ei("input",{type:"checkbox",checked:f.length&&i.size===f.length,onchange:t=>{for(const e of f){const n=e._id||e["DeviceID.ID"].value[0];t.target.checked?i.add(n):i.delete(n)}},disabled:!n});d.push(ei("th",t))}for(let e=0;e<t.length;e++){const n=t[e].label;if(!o.hasOwnProperty(e)){d.push(ei("th",n));continue}let r=1,i=Sr("unsorted");o[e]>0?i=Sr("sorted-asc"):o[e]<0&&(i=Sr("sorted-dsc"));const a=ei("button",{onclick:()=>(o[e]>0&&(r*=-1),s({[e]:r}))},i);d.push(ei("th",[n,a]))}const p=[];for(const e of f){const n=e._id||e["DeviceID.ID"].value[0],r=[];if(h.length){const t=ei("input",{type:"checkbox",checked:i.has(n),onchange:t=>{t.target.checked?i.add(n):i.delete(n)},onclick:t=>{t.stopPropagation(),t.redraw=!1}});r.push(ei("td",t))}for(const n of t){const t={};let i;if("function"==typeof l)i=l(n,e);else if("code"===n.type){const r=e[n.id].split("\n",11);r.length>10&&(r[10]=["︙"]),null==t.title&&(t.title=r.join("\n")),i=r[0]||""}else i=e[n.id];r.push(ei("td",t,i))}let o=[];"function"==typeof c?(o=c(e),Array.isArray(o)||(o=[o])):Array.isArray(c)&&(o=c);for(const t of o)r.push(ei("td.table-row-links",t));p.push(ei("tr",{onclick:t=>{["INPUT","BUTTON","A"].includes(t.target.nodeName)?t.redraw=!1:i.delete(n)||i.add(n)}},r))}p.length||p.push(ei("tr.empty",ei("td",{colspan:d.length},"No records")));const g=[];null!=n?g.push(`${f.length}/${n}`):g.push(""+f.length),g.push(ei("button",{title:"Show more records",onclick:r,disabled:!e.length||f.length>=Math.min(200,n)},"More")),a&&g.push(ei("a.download-csv",{href:a,download:""},"Download"));const m=ei("tfoot",ei("tr",ei("td",{colspan:d.length},g))),v=[ei("table.table.highlight",ei("thead",ei("tr",d)),ei("tbody",p),m)];return h.length&&v.push(ei("div.actions-bar",h)),v}(n,r,o,s,t,a,l,u,i,c,f)}}};class pi{constructor(t,e){this.callback=e,this.element=null,this.hideTimeout=null,this.visible=!1,this.default=null,this.selection=null,this.container=document.createElement("div"),this.container.style.position="absolute",this.container.style.display="block",this.container.style.opacity="0",this.container.className=t}attach(t){t.setAttribute("autocomplete","off"),t.addEventListener("focus",()=>{this.element=t;const e=t.getBoundingClientRect();this.container.style.left=e.left+window.pageXOffset+"px",this.container.style.width=e.width+"px",this.container.style.top=e.bottom+window.pageYOffset+"px",this.update()}),t.addEventListener("blur",()=>{this.element===t&&this.visible&&this.hide()}),t.addEventListener("keydown",e=>{this.element===t&&("Escape"===e.key?this.visible&&this.hide():"Enter"===e.key?null!=this.default&&(t.value=this.default,e.preventDefault(),this.update()):"ArrowDown"===e.key?(e.preventDefault(),null==this.selection?this.selection=0:++this.selection,this.update()):"ArrowUp"===e.key&&(e.preventDefault(),--this.selection,this.update()))}),t.addEventListener("input",()=>{this.element===t&&(this.selection=null,this.update())})}hide(){this.container.style.opacity="0",this.visible=!1,this.default=null,this.selection=null,clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(()=>{for(this.hideTimeout=null;this.container.firstChild;)this.container.removeChild(this.container.firstChild);document.body.removeChild(this.container)},500)}update(){const t=this.element;this.callback(t.value,e=>{if(this.element!==t)return;if(this.default=null,!e.length)return void(this.visible&&this.hide());for(;this.container.firstChild;)this.container.removeChild(this.container.firstChild);let n;this.visible||(this.hideTimeout?(clearTimeout(this.hideTimeout),this.hideTimeout=null):(document.body.appendChild(this.container),window.getComputedStyle(this.container).opacity),this.container.style.opacity="1",this.visible=!0),null!=this.selection?(this.selection=(this.selection%e.length+e.length)%e.length,this.default=e[this.selection].value):this.default=e[0].value;for(const[r,i]of e.entries()){const e=document.createElement("div");i.tip&&(e.title=i.tip),e.classList.add("suggestion"),r===this.selection&&(e.classList.add("selected"),n=e);const o=document.createTextNode(i.value);e.appendChild(o),e.addEventListener("mousedown",e=>{e.preventDefault(),t.value=i.value,this.element===t&&this.update()}),this.container.appendChild(e)}n&&(this.container.scrollTop=Math.min(this.container.scrollTop,n.offsetTop),this.container.scrollTop=Math.max(this.container.scrollTop,n.offsetTop+n.scrollHeight-this.container.clientHeight))})}}const gi={devices:{},faults:{Device:{parameter:["PARAM","device"],type:"string"},Channel:{parameter:["PARAM","channel"],type:"string"},Code:{parameter:["PARAM","code"],type:"string"},Retries:{parameter:["PARAM","retries"],type:"number"},Timestamp:{parameter:["PARAM","timestamp"],type:"timestamp"}},presets:{ID:{parameter:["PARAM","_id"],type:"string"},Channel:{parameter:["PARAM","channel"],type:"string"},Weight:{parameter:["PARAM","weight"],type:"number"}},provisions:{ID:{parameter:["PARAM","_id"],type:"string"}},virtualParameters:{ID:{parameter:["PARAM","_id"],type:"string"}},files:{ID:{parameter:["PARAM","_id"],type:"string"},Type:{parameter:["PARAM","metadata.fileType"],type:"string"},OUI:{parameter:["PARAM","metadata.oui"],type:"string"},"Product class":{parameter:["PARAM","metadata.productClass"],type:"string"},Version:{parameter:["PARAM","metadata.version"],type:"string"}},permissions:{Role:{parameter:["PARAM","role"],type:"string"},Resource:{parameter:["PARAM","resource"],type:"string"},Access:{parameter:["PARAM","access"],type:"number"}},users:{Username:{parameter:["PARAM","_id"],type:"string"}}};for(const t of Object.values(_e.ui.filters))gi.devices[t.label]={parameter:t.parameter,type:(t.type||"").split(",").map(t=>t.trim())};function mi(t,e){let n;if(gi[t]&&gi[t][e]){const r=gi[t][e],i="devices"===t?r.type:r.type.split(","),o=[];for(const t of i)switch(t.trim()){case"string":o.push("case insensitive string pattern");break;case"number":o.push("numeric value");break;case"timestamp":o.push("Unix timestamp or string in the form YYYY-MM-DDTHH:mm:ss.sssZ");break;case"mac":o.push("partial case insensitive MAC address");break;case"tag":o.push("case sensitive string")}o.length&&(n=`${e}: ${o.join(", ")}`)}return n}function vi(t,e,n){if(!gi[t])return null;const r=gi[t][e].type;n=n.trim();const i=["OR"];if(0===r.length||r.includes("number")){const r=function(t,e){let n="=";for(const t of["<>","=","<=","<",">=",">"])if(e.startsWith(t)){n=t,e=e.slice(t.length).trim();break}const r=parseInt(e);return r!==+e?null:[n,t,r]}(gi[t][e].parameter,n);r&&i.push(r)}if(0===r.length||r.includes("string")){const r=function(t,e){return["LIKE",["FUNC","LOWER",t],e.toLowerCase()]}(gi[t][e].parameter,n);r&&i.push(r)}if(0===r.length||r.includes("timestamp")){const r=function(t,e){let n="=";for(const t of["<>","=","<=","<",">=",">"])if(e.startsWith(t)){n=t,e=e.slice(t.length).trim();break}let r=parseInt(e);return r!==+e&&(r=Date.parse(e)),isNaN(r)?null:[n,t,r]}(gi[t][e].parameter,n);r&&i.push(r)}if(r.includes("mac")){const r=function(t,e){return(e=e.replace(/[^a-f0-9]/gi,"").toLowerCase())?12===e.length?["LIKE",["FUNC","LOWER",t],e.replace(/(..)(?!$)/g,"$1:")]:["OR",["LIKE",["FUNC","LOWER",t],`%${e.replace(/(..)(?!$)/g,"$1:")}%`],["LIKE",["FUNC","LOWER",t],`%${e.replace(/(.)(.)/g,"$1:$2")}%`]]:null}(gi[t][e].parameter,n);r&&i.push(r)}if(r.includes("tag")){const t=["IS NOT NULL",["PARAM","Tags."+n.replace(/[^a-zA-Z0-9-]+/g,"_")]];t&&i.push(t)}return i.length<=1?null:2===i.length?i[1]:i}const wi=Array.isArray;const yi=ge(t=>{const e=function(t){return gi[t]?Object.keys(gi[t]):[]}(t);return new pi("autocomplete",(n,r)=>{n=n.toLowerCase(),r(e.filter(t=>t.toLowerCase().includes(n)).map(e=>({value:e+": ",tip:mi(t,e)})))})});function _i(t){t=Jn(t),Array.isArray(t)&&"CASE"===t[0]&&(t=["AND",...t.slice(1)]),function(t){if(!wi(t)){if(!0===t)return{};throw new Error("Primitives are not valid queries")}(function t(e,n){const r=e[0];if("AND"===r&&2===(e=e.filter(t=>!0!==t)).length)return t(e[1],n);if("OR"===r&&2===(e=e.filter(t=>!1!==t)).length)return t(e[1],n);if(!n&&"AND"===r||n&&"OR"===r)return{$and:e.slice(1).map(e=>t(e,n))};if(!n&&"OR"===r||n&&"AND"===r)return{$or:e.slice(1).map(e=>t(e,n))};if("NOT"===r)return t(e[1],!n);if(wi(e[2]))throw new Error(`Invalid RHS operand of ${r} clause`);if("LIKE"===r||"NOT LIKE"===r){let t,i;if("NOT LIKE"===r&&(n=!n),!Array.isArray(e[1]))throw new Error(`Invalid LHS operand of ${r} clause`);if("FUNC"===e[1][0]&&"UPPER"===e[1][1]){if(e[2]!==e[2].toUpperCase())throw new Error(`Invalid RHS operand of ${r} clause`);t=e[1][2][1],i="i"}else if("FUNC"===e[1][0]&&"LOWER"===e[1][1]){if(e[2]!==e[2].toLowerCase())throw new Error(`Invalid RHS operand of ${r} clause`);t=e[1][2][1],i="i"}else{if("PARAM"!==e[1][0])throw new Error(`Invalid LHS operand of ${r} clause`);t=e[1][1],i=""}const o=re(e[2],e[3],i);return n?{[t]:{$nin:[o,null]}}:{[t]:o}}if("_tags"===r){let t=e[2];return n&&(t=!t),t?{_tags:e[1]}:{_tags:{$ne:e[1]}}}if(!wi(e[1])||"PARAM"!==e[1][0])throw new Error(`Invalid LHS operand of ${r} clause`);if("IS NULL"===r){return{[e[1][1]]:null}}if("IS NOT NULL"===r){return{[e[1][1]]:{$ne:null}}}if(wi(e[2])||null==e[2])throw new Error(`Invalid RHS operand of ${r} clause`);if("="===r){const t=e[1][1],r=e[2];return n?{[t]:{$nin:[r,null]}}:{[t]:r}}if("<>"===r){const t=e[1][1],r=e[2];return n?{[t]:r}:{[t]:{$nin:[r,null]}}}if(">"===r){const t=e[1][1],r=e[2];return n?{[t]:{$lte:r}}:{[t]:{$gt:r}}}if(">="===r){const t=e[1][1],r=e[2];return n?{[t]:{$lt:r}}:{[t]:{$gte:r}}}if("<"===r){const t=e[1][1],r=e[2];return n?{[t]:{$gte:r}}:{[t]:{$lt:r}}}if("<="===r){const t=e[1][1],r=e[2];return n?{[t]:{$gt:r}}:{[t]:{$lte:r}}}throw new Error("Unrecognized operator "+r)})(t,!1)}(t)}function bi(t){return Array.isArray(t)&&"FUNC"===t[0]&&"Q"===t[1]?`${t[2]}: ${t[3]}`:Zt(t)}const Ai=ge(t=>{if(!t)return[""];const e=[],n=Qt(t);if(Array.isArray(n)&&"AND"===n[0])for(const t of n.slice(1))e.push(bi(t));else e.push(bi(n));return e.push(""),e}),Si=()=>({view:t=>{function e(){t.state.filterInvalid=0,t.state.filterList=t.state.filterList.filter(t=>t);let e=t.state.filterList.map((e,n)=>{try{return function(t,e){let n;if(/^[\s0-9a-zA-Z]+:/.test(e)){const t=e.split(":",1)[0],r=e.slice(t.length+1).trim();n=["FUNC","Q",t.trim(),r]}else n=Qt(e);return _i(Ht(n,e=>{if(Array.isArray(e)&&"FUNC"===e[0]){if("Q"===e[1])return vi(t,e[2],e[3]);if("NOW"===e[1])return Date.now()}return e})),n}(t.attrs.resource,e)}catch(e){t.state.filterInvalid|=1<<n}return null});t.state.filterList.push(""),t.state.filterInvalid||(delete t.state.filter,0===e.length?t.attrs.onChange(""):(e=e.length>1?["AND"].concat(e):e[0],t.attrs.onChange(Zt(e))))}return t.state.filterList&&t.attrs.filter===t.state.filter||(t.state.filterInvalid=0,t.state.filter=t.attrs.filter,t.state.filterList=Ai(t.attrs.filter)),T("div.filter",[T("b","Filter")].concat(t.state.filterList.map((n,r)=>T("input",{type:"text",class:""+(t.state.filterInvalid>>r&1?"error":""),value:n,onchange:n=>{t.state.filterList=t.state.filterList.slice(),t.state.filterList[r]=n.target.value.trim(),e()},oncreate:e=>{yi(t.attrs.resource).attach(e.dom)}}))))}}),xi=_e.ui.pageSize||10,Di=ge(Qt),Ei=ge(JSON.parse),Oi=ge(t=>{const e=function(t){const e=new Set;return Ht(t,t=>(Xt(t)&&"PARAM"===t[0]&&e.add(t[1]),t)),Array.from(e)}(t);if(1===e.length){const t=le(e[0]);if("string"==typeof t)return t}return null}),ki=ge((t,e)=>{const n={};for(const t of e)n[t.label]=Zt(t.parameter);return"api/devices.csv?"+ei.buildQueryString({filter:Zt(t),columns:JSON.stringify(n)})}),Ci=ge(t=>Ht(t,t=>Array.isArray(t)&&"FUNC"===t[0]&&"Q"===t[1]?vi("devices",t[2],t[3]):t));function Pi(t){const e=[];return e.push(ei("button.primary",{title:"Reboot selected devices",disabled:!t.size,onclick:()=>{Or(...[...t].map(t=>({name:"reboot",device:t})))}},"Reboot")),e.push(ei("button.critical",{title:"Factory reset selected devices",disabled:!t.size,onclick:()=>{Or(...[...t].map(t=>({name:"factoryReset",device:t})))}},"Reset")),e.push(ei("button.critical",{title:"Push a firmware or a config file",disabled:!t.size,onclick:()=>{Ir({name:"download",devices:[...t]})}},"Push file")),e.push(ei("button.primary",{title:"Delete selected devices",disabled:!t.size,onclick:()=>{const e=Array.from(t);if(!confirm(`Deleting ${e.length} devices. Are you sure?`))return;let n=1;for(const t of e)++n,wr("devices",t).then(()=>{we("success",t+": Deleted"),0==--n&&gr(0,Date.now())}).catch(e=>{we("error",`${t}: ${e.message}`),0==--n&&gr(0,Date.now())});0==--n&&gr(0,Date.now())}},"Delete")),e.push(ei("button.primary",{title:"Tag selected devices",disabled:!t.size,onclick:()=>{const e=Array.from(t),n=prompt(`Enter tag to assign to ${e.length} devices:`);if(!n)return;let r=1;for(const t of e)++r,vr(t,{[n]:!0}).then(()=>{we("success",t+": Tags updated"),0==--r&&gr(0,Date.now())}).catch(e=>{we("error",`${t}: ${e.message}`),0==--r&&gr(0,Date.now())});0==--r&&gr(0,Date.now())}},"Tag")),e.push(ei("button.primary",{title:"Untag selected devices",disabled:!t.size,onclick:()=>{const e=Array.from(t),n=prompt(`Enter tag to unassign from ${e.length} devices:`);if(!n)return;let r=1;for(const t of e)++r,vr(t,{[n]:!1}).then(()=>{we("success",t+": Tags updated"),0==--r&&gr(0,Date.now())}).catch(e=>{we("error",`${t}: ${e.message}`),0==--r&&gr(0,Date.now())});0==--r&&gr(0,Date.now())}},"Untag")),e}const Ti=Object.freeze({__proto__:null,init:function(t){return new Promise((e,n)=>{if(!window.authorizer.hasAccess("devices",2))return void n(new Error("You are not authorized to view this page"));const r=t.hasOwnProperty("filter")?""+t.filter:"",i=t.hasOwnProperty("sort")?""+t.sort:"",o=Object.values(_e.ui.index);o.length||o.push({label:"ID",parameter:["PARAM","DeviceID.ID"]}),e({filter:r,indexParameters:o,sort:i})})},component:()=>({view:t=>{document.title="Devices - GenieACS";const e=t.attrs.indexParameters;const n=t.attrs.sort?Ei(t.attrs.sort):{},r={};for(let t=0;t<e.length;t++){const i=e[t];if(i.unsortable)continue;const o=Oi(i.parameter);o&&(r[t]=n[o]||0)}let i=!t.attrs.filter||Di(t.attrs.filter);i=Ci(i);const o=pr("devices",i,{limit:t.state.showCount||xi,sort:n}),s=fr("devices",i),a=ki(i,e),l={};l.attributes=e,l.data=o.value,l.total=s.value,l.showMoreCallback=function(){t.state.showCount=(t.state.showCount||xi)+xi,ei.redraw()},l.sortAttributes=r,l.onSortChange=function(r){const i=Object.assign({},n);for(const[t,n]of Object.entries(r)){const r=Oi(e[t].parameter);r&&(delete i[r],i[r]=n)}const o={sort:JSON.stringify(i)};t.attrs.filter&&(o.filter=t.attrs.filter),ei.route.set("/devices",o)},l.downloadUrl=a,l.valueCallback=(t,e)=>ei.context({device:e,parameter:t.parameter},t.type||"parameter",t),l.recordActionsCallback=t=>ei("a",{href:"#!/devices/"+encodeURIComponent(t["DeviceID.ID"].value[0])},"Show"),window.authorizer.hasAccess("devices",3)&&(l.actionsCallback=Pi);const u={resource:"devices"};return u.filter=t.attrs.filter,u.onChange=function(e){const n={filter:e};t.attrs.sort&&(n.sort=t.attrs.sort),ei.route.set("/devices",n)},[ei("h1","Listing devices"),ei(Si,u),ei(di,l)]}})});const Ii=Object.freeze({__proto__:null,init:function(t){return window.authorizer.hasAccess("devices",2)?Promise.resolve({deviceId:t.id,deviceFilter:["=",["PARAM","DeviceID.ID"],t.id]}):Promise.reject(new Error("You are not authorized to view this page"))},component:()=>({view:t=>{document.title=t.attrs.deviceId+" - Devices - GenieACS";const e=pr("devices",t.attrs.deviceFilter).value;if(!e.length)return"Loading";const n=_e.ui.device,r=[];for(const t of Object.values(n))r.push(ei.context({device:e[0]},t.type,t));return[ei("h1",t.attrs.deviceId),r]}})}),Ni=()=>({view:function(t){return document.title="Error! - GenieACS",ei("p.error",t.attrs.error)}});let ji,Ri,zi;function Mi(){zi||(zi=we("error","Error loading JS resource, please reload the page",{Reload:()=>{window.location.reload()}}))}function Li(){return ji?Promise.resolve():new Promise((t,e)=>{const r=[n.e(1).then(n.t.bind(null,9,7)),n.e(1).then(n.t.bind(null,10,7)),n.e(1).then(n.t.bind(null,11,7))];Promise.all(r).then(e=>{ji=e[0],t()}).catch(t=>{Mi(),e(t)})})}function Bi(){return Ri?Promise.resolve():new Promise((t,e)=>{n.e(2).then(n.t.bind(null,12,7)).then(e=>{Ri=e,t()}).catch(t=>{Mi(),e(t)})})}const Ui=_e.ui.pageSize||10,$i=ge(Qt),Fi=ge(JSON.parse),qi=[{id:"device",label:"Device"},{id:"channel",label:"Channel"},{id:"code",label:"Code"},{id:"message",label:"Message"},{id:"detail",label:"Detail"},{id:"retries",label:"Retries"},{id:"timestamp",label:"Timestamp"}],Wi=ge(t=>{const e={};for(const t of qi)e[t.label]="timestamp"===t.id?`DATE_STRING(${t.id})`:t.id;return"api/faults.csv?"+ei.buildQueryString({filter:Zt(t),columns:JSON.stringify(e)})}),Ji=ge(t=>Ht(t,t=>Array.isArray(t)&&"FUNC"===t[0]&&"Q"===t[1]?vi("faults",t[2],t[3]):t));const Yi=Object.freeze({__proto__:null,init:function(t){if(!window.authorizer.hasAccess("faults",2))return Promise.reject(new Error("You are not authorized to view this page"));const e=t.hasOwnProperty("sort")?""+t.sort:"",n=t.hasOwnProperty("filter")?""+t.filter:"";return new Promise((t,r)=>{Bi().then(()=>{t({filter:n,sort:e})}).catch(r)})},component:()=>({view:t=>{document.title="Faults - GenieACS";const e=t.attrs.sort?Fi(t.attrs.sort):{},n={};for(let t=0;t<qi.length;t++){const r=qi[t];"detail"!==r.id&&(n[t]=e[r.id]||0)}let r=!t.attrs.filter||$i(t.attrs.filter);r=Ji(r);const i=pr("faults",r,{limit:t.state.showCount||Ui,sort:e}),o=fr("faults",r),s=Wi(r),a={};a.attributes=qi,a.data=i.value,a.valueCallback=(t,e)=>{if("device"===t.id){const t="#!/devices/"+encodeURIComponent(e.device);return ei("a",{href:t},e.device)}return"detail"===t.id?ei("long-text",{text:Ri.stringify(e.detail)}):"timestamp"===t.id?new Date(e.timestamp).toLocaleString():e[t.id]},a.total=o.value,a.showMoreCallback=function(){t.state.showCount=(t.state.showCount||Ui)+Ui,ei.redraw()},a.sortAttributes=n,a.onSortChange=function(n){const r=Object.assign({},e);for(const[t,e]of Object.entries(n))delete r[qi[t].id],r[qi[t].id]=e;const i={sort:JSON.stringify(r)};t.attrs.filter&&(i.filter=t.attrs.filter),ei.route.set("/faults",i)},a.downloadUrl=s,window.authorizer.hasAccess("faults",3)&&(a.actionsCallback=t=>ei("button.primary",{disabled:0===t.size,title:"Delete selected faults",onclick:e=>{e.redraw=!1,e.target.disabled=!0,confirm(`Deleting ${t.size} faults. Are you sure?`)&&Promise.all(Array.from(t).map(t=>wr("faults",t))).then(t=>{we("success",t.length+" faults deleted"),gr(0,Date.now())}).catch(t=>{we("error",t.message),gr(0,Date.now())})}},"Delete"));const l={resource:"faults"};return l.filter=t.attrs.filter,l.onChange=function(e){const n={filter:e};t.attrs.sort&&(n.sort=t.attrs.sort),ei.route.set("/faults",n)},[ei("h1","Listing faults"),ei(Si,l),ei(di,a)]}})}),Vi=()=>({view:t=>ei("textarea",{name:t.attrs.id,value:t.attrs.value,oncreate:e=>{const n=ji.fromTextArea(e.dom,{mode:t.attrs.mode,lineNumbers:!0,readOnly:t.attrs.readOnly,extraKeys:{"Ctrl-Enter":()=>{t.attrs.onSubmit&&t.attrs.onSubmit(e.dom)},"Cmd-Enter":()=>{t.attrs.onSubmit&&t.attrs.onSubmit(e.dom)}}});t.attrs.onChange&&n.on("change",e=>{t.attrs.onChange(e.getValue())}),t.attrs.focus&&n.focus(),t.attrs.onReady&&t.attrs.onReady(n)}})}),Hi={presets:"preset",provisions:"provision",virtualParameters:"virtual parameter",files:"file",users:"user",permissions:"permission"};function Ki(t,e,n){if("combo"===e.type){let r="",i=e.options;null!=t.object[e.id]&&(i.includes(t.object[e.id])||(i=i.concat([t.object[e.id]])),r=t.object[e.id]);const o=[ei("option",{value:""},"")];for(const t of i)o.push(ei("option",{value:t},t));return ei("select",{name:e.id,value:r,oncreate:n?t=>{t.dom.focus()}:null,onchange:n=>{t.object[e.id]=n.target.value,n.redraw=!1}},o)}if("multi"===e.type){const r=Array.from(new Set(e.options.concat(t.object[e.id]||[]))),i=new Set(t.object[e.id]),o=r.map(r=>{const s=`${e.id}-${r}`;return ei("tr",[ei("td",ei("input",{type:"checkbox",id:s,value:r,oncreate:t=>{n&&!o.length&&t.dom.focus(),i.has(r)&&(t.dom.checked=!0)},onchange:n=>{n.target.checked?i.add(r):i.delete(r),t.object[e.id]=Array.from(i),n.redraw=!1}})),ei("td",r)])});return ei("table",o)}if("code"===e.type){const n={id:e.id,value:t.object[e.id],mode:"javascript",onSubmit:t=>{t.form.querySelector("button[type=submit]").click()},onChange:n=>{t.object[e.id]=n}};return ei(Vi,n)}return"file"===e.type?ei("input",{type:"file",name:e.id,oncreate:n?t=>{t.dom.focus()}:null,onchange:n=>{t.object[e.id]=n.target.files,n.redraw=!1}}):"textarea"===e.type?ei("textarea",{name:e.id,value:t.object[e.id],readonly:"_id"===e.id&&!t.isNew,cols:e.cols||80,rows:e.rows||4,style:"resize: none;",oncreate:n?t=>{const e=t.dom;e.focus(),e.setSelectionRange(e.value.length,e.value.length)}:null,oninput:n=>{t.object[e.id]=n.target.value,n.redraw=!1},onkeypress:t=>{if(t.redraw=!1,13===t.which&&!t.shiftKey){return t.target.form.querySelector("button[type=submit]").click(),!1}return!0}}):ei("input",{type:"password"===e.type?"password":"text",name:e.id,disabled:"_id"===e.id&&!t.isNew,value:t.object[e.id],oncreate:n?t=>{t.dom.focus()}:null,oninput:n=>{t.object[e.id]=n.target.value,n.redraw=!1}})}const Gi=()=>({view:t=>{const e=t.attrs.actionHandler,n=t.attrs.attributes,r=t.attrs.resource,i=t.attrs.base||{};t.state.current||(t.state.current={isNew:!i._id,object:Object.assign({},i)});const o=t.state.current,s=[];let a=!1;for(const t of n){let e=!1;a||!o.isNew&&"_id"===t.id||(e=a=!0),s.push(ei("p",ei("label",{for:t.id},t.label||t.id),ei("br"),Ki(o,t,e)))}const l=ei("button.primary",{type:"submit"},"Save"),u=[l];o.isNew||u.push(ei("button.primary",{type:"button",title:"Delete "+(Hi[r]||r),onclick:t=>{t.redraw=!1,t.target.disabled=!0,e("delete",o.object).then(()=>{t.target.disabled=!1})}},"Delete")),s.push(ei(".actions-bar",u));const c=[ei("h1",`${o.isNew?"New":"Editing"} ${Hi[r]||r}`),ei("form",{onsubmit:t=>{t.redraw=!1,t.preventDefault(),l.dom.disabled=!0,e("save",o.object).then(()=>{l.dom.disabled=!1})}},s)];return ei("div.put-form",c)}}),Qi=_e.ui.pageSize||10,Zi=ge(Qt),Xi=ge(JSON.parse),to=[{id:"_id",label:"Name"},{id:"channel",label:"Channel"},{id:"weight",label:"Weight"},{id:"schedule",label:"Schedule"},{id:"events",label:"Events"},{id:"precondition",label:"Precondition",type:"textarea"},{id:"provision",label:"Provision",type:"combo"},{id:"provisionArgs",label:"Arguments",type:"textarea"}],eo=ge(t=>Ht(t,t=>Array.isArray(t)&&"FUNC"===t[0]&&"Q"===t[1]?vi("presets",t[2],t[3]):t));function no(t,e,n){return new Promise((r,i)=>{const o=Object.assign({},e);if("save"===t){const t=o._id;delete o._id;const e={};if(t||(e._id="ID can not be empty"),o.provision||(e.provision="Provision not selected"),Object.keys(e).length)return void r(e);if(o.precondition)try{o.precondition=Zt(Zi(o.precondition))}catch(t){return void r({precondition:"Precondition must be valid expression"})}_r("presets",t).then(e=>e&&n?(gr(0,Date.now()),void r({_id:"Preset already exists"})):e||n?void yr("presets",t,o).then(()=>{we("success","Preset "+(e?"updated":"created")),gr(0,Date.now()),r()}).catch(i):(gr(0,Date.now()),void r({_id:"Preset does not exist"}))).catch(i)}else"delete"===t?wr("presets",o._id).then(()=>{we("success","Preset deleted"),gr(0,Date.now()),r()}).catch(t=>{i(t),gr(0,Date.now())}):i(new Error("Undefined action"))})}const ro={resource:"presets",attributes:to},io=ge(t=>{const e={};for(const t of to)e[t.label]=t.id;return"api/presets.csv?"+ei.buildQueryString({filter:Zt(t),columns:JSON.stringify(e)})});const oo=Object.freeze({__proto__:null,init:function(t){if(!window.authorizer.hasAccess("presets",2))return Promise.reject(new Error("You are not authorized to view this page"));const e=t.hasOwnProperty("sort")?""+t.sort:"",n=t.hasOwnProperty("filter")?""+t.filter:"";return Promise.resolve({filter:n,sort:e})},component:()=>({view:t=>{document.title="Presets - GenieACS";const e=t.attrs.sort?Xi(t.attrs.sort):{},n={};for(let t=0;t<to.length;t++){const r=to[t];"events"!==r.id&&"precondition"!==r.id&&"provision"!==r.id&&"provisionArgs"!==r.id&&(n[t]=e[r.id]||0)}let r=!t.attrs.filter||Zi(t.attrs.filter);r=eo(r);const i=pr("presets",r,{limit:t.state.showCount||Qi,sort:e}),o=fr("presets",r),s=new Set,a=new Set(["refresh","value","tag","reboot","reset","download","instances"]),l=pr("provisions",!0);if(l.fulfilled)for(const t of l.value)s.add(t._id),a.add(t._id);to.find(t=>"provision"===t.id).options=Array.from(a);const u=io(r),c={};c.attributes=to,c.data=i.value,c.total=o.value,c.showMoreCallback=function(){t.state.showCount=(t.state.showCount||Qi)+Qi,ei.redraw()},c.sortAttributes=n,c.onSortChange=function(n){const r=Object.assign({},e);for(const[t,e]of Object.entries(n))delete r[to[t].id],r[to[t].id]=e;const i={sort:JSON.stringify(r)};t.attrs.filter&&(i.filter=t.attrs.filter),ei.route.set("/admin/presets",i)},c.downloadUrl=u,c.valueCallback=(t,e)=>{if("precondition"===t.id){let t="#!/devices";return e.precondition.length&&(t+="?"+ei.buildQueryString({filter:e.precondition})),ei("a",{href:t,title:e.precondition},e.precondition)}return"provision"===t.id&&s.has(e[t.id])?ei("a",{href:"#!/admin/provisions?"+ei.buildQueryString({filter:`Q("ID", "${e.provision}")`})},e.provision):e[t.id]},c.recordActionsCallback=t=>[ei("a",{onclick:()=>{const e=()=>t.provision?ei(Gi,Object.assign({base:t,actionHandler:(t,n)=>new Promise(r=>{no(t,n,!1).then(t=>{const n=t?Object.values(t):[];if(n.length)for(const t of n)we("error",t);else qr(e);r()}).catch(t=>{we("error",t.message),r()})})},ro)):ei("div",{style:"margin:20px"},"This UI only supports presets with a single 'provision' configuraiton. If this preset was originally created from the old UI (genieacs-gui), you must edit it there.");Fr(e)}},"Show")],window.authorizer.hasAccess("presets",3)&&(c.actionsCallback=t=>[ei("button.primary",{title:"Create new preset",onclick:()=>{const t=()=>ei(Gi,Object.assign({actionHandler:(e,n)=>new Promise(r=>{no(e,n,!0).then(e=>{const n=e?Object.values(e):[];if(n.length)for(const t of n)we("error",t);else qr(t);r()}).catch(t=>{we("error",t.message),r()})})},ro));Fr(t)}},"New"),ei("button.primary",{title:"Delete selected presets",disabled:!t.size,onclick:e=>{confirm(`Deleting ${t.size} presets. Are you sure?`)&&(e.redraw=!1,e.target.disabled=!0,Promise.all(Array.from(t).map(t=>wr("presets",t))).then(t=>{we("success",t.length+" presets deleted"),gr(0,Date.now())}).catch(t=>{we("error",t.message),gr(0,Date.now())}))}},"Delete")]);const f={resource:"presets"};return f.filter=t.attrs.filter,f.onChange=function(e){const n={filter:e};t.attrs.sort&&(n.sort=t.attrs.sort),ei.route.set("/admin/presets",n)},[ei("h1","Listing presets"),ei(Si,f),ei(di,c)]}})}),so=_e.ui.pageSize||10,ao=ge(Qt),lo=ge(JSON.parse),uo=[{id:"_id",label:"Name"},{id:"script",label:"Script",type:"code"}],co=ge(t=>Ht(t,t=>Array.isArray(t)&&"FUNC"===t[0]&&"Q"===t[1]?vi("provisions",t[2],t[3]):t));function fo(t,e,n){return new Promise((r,i)=>{const o=Object.assign({},e);if("save"===t){const t=o._id;if(delete o._id,!t)return void r({_id:"ID can not be empty"});_r("provisions",t).then(e=>e&&n?(gr(0,Date.now()),void r({_id:"Provision already exists"})):e||n?void yr("provisions",t,o).then(()=>{we("success","Provision "+(e?"updated":"created")),gr(0,Date.now()),r()}).catch(i):(gr(0,Date.now()),void r({_id:"Provision does not exist"}))).catch(i)}else"delete"===t?wr("provisions",o._id).then(()=>{we("success","Provision deleted"),gr(0,Date.now()),r()}).catch(t=>{gr(0,Date.now()),i(t)}):i(new Error("Undefined action"))})}const ho={resource:"provisions",attributes:uo},po=ge(t=>{const e={};for(const t of uo)e[t.label]=t.id;return"api/provisions.csv?"+ei.buildQueryString({filter:Zt(t),columns:JSON.stringify(e)})});const go=Object.freeze({__proto__:null,init:function(t){if(!window.authorizer.hasAccess("provisions",2))return Promise.reject(new Error("You are not authorized to view this page"));const e=t.hasOwnProperty("sort")?""+t.sort:"",n=t.hasOwnProperty("filter")?""+t.filter:"";return new Promise((t,r)=>{Li().then(()=>{t({filter:n,sort:e})}).catch(r)})},component:()=>({view:t=>{document.title="Provisions - GenieACS";const e=t.attrs.sort?lo(t.attrs.sort):{},n={};for(let t=0;t<uo.length;t++)n[t]=e[uo[t].id]||0;let r=!t.attrs.filter||ao(t.attrs.filter);r=co(r);const i=pr("provisions",r,{limit:t.state.showCount||so,sort:e}),o=fr("provisions",r),s=po(r),a={};a.attributes=uo,a.data=i.value,a.total=o.value,a.showMoreCallback=function(){t.state.showCount=(t.state.showCount||so)+so,ei.redraw()},a.sortAttributes=n,a.onSortChange=function(n){const r=Object.assign({},e);for(const[t,e]of Object.entries(n))delete r[uo[t].id],r[uo[t].id]=e;const i={sort:JSON.stringify(r)};t.attrs.filter&&(i.filter=t.attrs.filter),ei.route.set("/admin/provisions",i)},a.downloadUrl=s,a.recordActionsCallback=t=>[ei("a",{onclick:()=>{const e=()=>ei(Gi,Object.assign({base:t,actionHandler:(t,n)=>new Promise(r=>{fo(t,n,!1).then(t=>{const n=t?Object.values(t):[];if(n.length)for(const t of n)we("error",t);else qr(e);r()}).catch(t=>{we("error",t.message),r()})})},ho));Fr(e)}},"Show")],window.authorizer.hasAccess("provisions",3)&&(a.actionsCallback=t=>[ei("button.primary",{title:"Create new provision",onclick:()=>{const t=()=>ei(Gi,Object.assign({actionHandler:(e,n)=>new Promise(r=>{fo(e,n,!0).then(e=>{const n=e?Object.values(e):[];if(n.length)for(const t of n)we("error",t);else qr(t);r()}).catch(t=>{we("error",t.message),r()})})},ho));Fr(t)}},"New"),ei("button.primary",{title:"Delete selected provisions",disabled:!t.size,onclick:e=>{confirm(`Deleting ${t.size} provisions. Are you sure?`)&&(e.redraw=!1,e.target.disabled=!0,Promise.all(Array.from(t).map(t=>wr("provisions",t))).then(t=>{we("success",t.length+" provisions deleted"),gr(0,Date.now())}).catch(t=>{we("error",t.message),gr(0,Date.now())}))}},"Delete")]);const l={resource:"provisions"};return l.filter=t.attrs.filter,l.onChange=function(e){const n={filter:e};t.attrs.sort&&(n.sort=t.attrs.sort),ei.route.set("/admin/provisions",n)},[ei("h1","Listing provisions"),ei(Si,l),ei(di,a)]}})}),mo=_e.ui.pageSize||10,vo=ge(Qt),wo=ge(JSON.parse),yo=[{id:"_id",label:"Name"},{id:"script",label:"Script",type:"code"}],_o=ge(t=>Ht(t,t=>Array.isArray(t)&&"FUNC"===t[0]&&"Q"===t[1]?vi("virtualParameters",t[2],t[3]):t));function bo(t,e,n){return new Promise((r,i)=>{const o=Object.assign({},e);if("save"===t){const t=o._id;if(delete o._id,!t)return void r({_id:"ID can not be empty"});_r("virtualParameters",t).then(e=>e&&n?(gr(0,Date.now()),void r({_id:"Virtual parameter already exists"})):e||n?void yr("virtualParameters",t,o).then(()=>{we("success","Virtual parameter "+(e?"updated":"created")),gr(0,Date.now()),r()}).catch(i):(gr(0,Date.now()),void r({_id:"Virtual parameter does not exist"}))).catch(i)}else"delete"===t?wr("virtualParameters",o._id).then(()=>{we("success","Virtual parameter deleted"),gr(0,Date.now()),r()}).catch(t=>{gr(0,Date.now()),i(t)}):i(new Error("Undefined action"))})}const Ao={resource:"virtualParameters",attributes:yo},So=ge(t=>{const e={};for(const t of yo)e[t.label]=t.id;return"api/virtualParameters.csv?"+ei.buildQueryString({filter:Zt(t),columns:JSON.stringify(e)})});const xo=Object.freeze({__proto__:null,init:function(t){if(!window.authorizer.hasAccess("virtualParameters",2))return Promise.reject(new Error("You are not authorized to view this page"));const e=t.hasOwnProperty("sort")?""+t.sort:"",n=t.hasOwnProperty("filter")?""+t.filter:"";return new Promise((t,r)=>{Li().then(()=>{t({filter:n,sort:e})}).catch(r)})},component:()=>({view:t=>{document.title="Virtual Parameters - GenieACS";const e=t.attrs.sort?wo(t.attrs.sort):{},n={};for(let t=0;t<yo.length;t++)n[t]=e[yo[t].id]||0;let r=!t.attrs.filter||vo(t.attrs.filter);r=_o(r);const i=pr("virtualParameters",r,{limit:t.state.showCount||mo,sort:e}),o=fr("virtualParameters",r),s=So(r),a={};a.attributes=yo,a.data=i.value,a.total=o.value,a.showMoreCallback=function(){t.state.showCount=(t.state.showCount||mo)+mo,ei.redraw()},a.sortAttributes=n,a.onSortChange=function(n){const r=Object.assign({},e);for(const[t,e]of Object.entries(n))delete r[yo[t].id],r[yo[t].id]=e;const i={sort:JSON.stringify(r)};t.attrs.filter&&(i.filter=t.attrs.filter),ei.route.set("/admin/virtualParameters",i)},a.downloadUrl=s,a.recordActionsCallback=t=>[ei("a",{onclick:()=>{const e=()=>ei(Gi,Object.assign({base:t,actionHandler:(t,n)=>new Promise(r=>{bo(t,n,!1).then(t=>{const n=t?Object.values(t):[];if(n.length)for(const t of n)we("error",t);else qr(e);r()}).catch(t=>{we("error",t.message),r()})})},Ao));Fr(e)}},"Show")],window.authorizer.hasAccess("virtualParameters",3)&&(a.actionsCallback=t=>[ei("button.primary",{title:"Create new virtual parameter",onclick:()=>{const t=()=>ei(Gi,Object.assign({actionHandler:(e,n)=>new Promise(r=>{bo(e,n,!0).then(e=>{const n=e?Object.values(e):[];if(n.length)for(const t of n)we("error",t);else qr(t);r()}).catch(t=>{we("error",t.message),r()})})},Ao));Fr(t)}},"New"),ei("button.primary",{title:"Delete selected virtual parameters",disabled:!t.size,onclick:e=>{confirm(`Deleting ${t.size} virtual parameters. Are you sure?`)&&(e.redraw=!1,e.target.disabled=!0,Promise.all(Array.from(t).map(t=>wr("virtualParameters",t))).then(t=>{we("success",t.length+" virtual parameters deleted"),gr(0,Date.now())}).catch(t=>{we("error",t.message),gr(0,Date.now())}))}},"Delete")]);const l={resource:"virtualParameters"};return l.filter=t.attrs.filter,l.onChange=function(e){const n={filter:e};t.attrs.sort&&(n.sort=t.attrs.sort),ei.route.set("/admin/virtualParameters",n)},[ei("h1","Listing virtual parameters"),ei(Si,l),ei(di,a)]}})}),Do=_e.ui.pageSize||10,Eo=ge(Qt),Oo=ge(JSON.parse),ko=[{id:"_id",label:"Name"},{id:"metadata.fileType",label:"Type",type:"combo",options:["1 Firmware Upgrade Image","2 Web Content","3 Vendor Configuration File","4 Tone File","5 Ringer File"]},{id:"metadata.oui",label:"OUI"},{id:"metadata.productClass",label:"Product Class"},{id:"metadata.version",label:"Version"}],Co={resource:"files",attributes:ko.slice(1).concat([{id:"file",label:"File",type:"file"}])},Po=ge(t=>Ht(t,t=>Array.isArray(t)&&"FUNC"===t[0]&&"Q"===t[1]?vi("files",t[2],t[3]):t));const To=ge(t=>{const e={};for(const t of ko)e[t.label]=t.id;return"api/files.csv?"+ei.buildQueryString({filter:Zt(t),columns:JSON.stringify(e)})});const Io=Object.freeze({__proto__:null,init:function(t){if(!window.authorizer.hasAccess("files",2))return Promise.reject(new Error("You are not authorized to view this page"));const e=t.hasOwnProperty("sort")?""+t.sort:"",n=t.hasOwnProperty("filter")?""+t.filter:"";return Promise.resolve({filter:n,sort:e})},component:()=>({view:t=>{document.title="Files - GenieACS";const e=t.attrs.sort?Oo(t.attrs.sort):{},n={};for(let t=0;t<ko.length;t++)n[t]=e[ko[t].id]||0;let r=!t.attrs.filter||Eo(t.attrs.filter);r=Po(r);const i=pr("files",r,{limit:t.state.showCount||Do,sort:e}),o=fr("files",r),s=To(r),a={};a.attributes=ko,a.data=i.value,a.total=o.value,a.showMoreCallback=function(){t.state.showCount=(t.state.showCount||Do)+Do,ei.redraw()},a.sortAttributes=n,a.onSortChange=function(n){const r=Object.assign({},e);for(const[t,e]of Object.entries(n))delete r[ko[t].id],r[ko[t].id]=e;const i={sort:JSON.stringify(r)};t.attrs.filter&&(i.filter=t.attrs.filter),ei.route.set("/admin/files",i)},a.downloadUrl=s,window.authorizer.hasAccess("files",3)&&(a.actionsCallback=t=>[ei("button.primary",{title:"Create new file",onclick:()=>{const t=()=>ei(Gi,Object.assign({actionHandler:(e,n)=>new Promise(r=>{(function(t,e){return new Promise((n,r)=>{const i=Object.assign({},e);if("save"===t){const t=i.file?i.file[0]:null;if(delete i.file,!t)return void n({file:"File not selected"});const e=t.name;_r("files",e).then(o=>{if(o)return gr(0,Date.now()),void n({file:"File already exists"});ur({method:"PUT",headers:Object.assign({"Content-Type":"application/octet-stream",Accept:"application/octet-stream"},i),url:"api/files/"+encodeURIComponent(e),serialize:t=>t,body:t}).then(()=>{we("success","File "+(o?"updated":"created")),gr(0,Date.now()),n()}).catch(r)}).catch(r)}else r(new Error("Undefined action"))})})(e,n).then(e=>{const n=e?Object.values(e):[];if(n.length)for(const t of n)we("error",t);else qr(t);r()}).catch(t=>{we("error",t.message),r()})})},Co));Fr(t)}},"New"),ei("button.primary",{title:"Delete selected files",disabled:!t.size,onclick:e=>{confirm(`Deleting ${t.size} files. Are you sure?`)&&(e.redraw=!1,e.target.disabled=!0,Promise.all(Array.from(t).map(t=>wr("files",t))).then(t=>{we("success",t.length+" files deleted"),gr(0,Date.now())}).catch(t=>{we("error",t.message),gr(0,Date.now())}))}},"Delete")]);const l={resource:"files"};return l.filter=t.attrs.filter,l.onChange=function(e){const n={filter:e};t.attrs.sort&&(n.sort=t.attrs.sort),ei.route.set("/admin/files",n)},[ei("h1","Listing files"),ei(Si,l),ei(di,a)]}})});function No(t){t.sort((t,e)=>t._id>e._id?1:t._id<e._id?-1:0);const e={};for(const n of t){const t=n._id.split(".");let r=e;for(;t.length>1;){const e=t.shift();"object"!=typeof r[e]&&(r[e]={}),r=r[e]}r[t[0]]=n.value}const n=function(t){if(null==t||"object"!=typeof t)return t;if(Object.keys(t).length<=300){let e=[];for(const n of Object.keys(t)){const t=Math.floor(+n);if(!(t>=0&&t<300&&String(t)===n)){e=[];break}{const n=Math.floor(t/30);e[n]||(e[n]=0),e[n]|=1<<t%30}}let n=0;for(;e.length&&1073741823===(n=e.shift()););if(n&&(~n&n+1)===n+1){const e=[];for(let n=0;n<Object.keys(t).length;n++)e[n]=t[n];t=e}}for(const[e,r]of Object.entries(t))t[e]=n(r);return t},r=n(e);return function t(e){let n=1;if("object"!=typeof e)return n;if(Array.isArray(e)){for(const r of e)n+=t(r);return n}const r=Object.entries(e).map(([e,n])=>[e,t(n)]);r.sort((t,e)=>t[1]!==e[1]?t[1]-e[1]:e[0]>t[0]?-1:1);for(const[t,i]of r){n+=i;const r=e[t];delete e[t],e[t]=r}return n}(r),r}function jo(t,e){return new Promise((n,r)=>{try{let i=Ri.parse(e,{schema:"failsafe"});if(i){const e={};let n=e;t.forEach((e,r)=>{r<t.length-1?(n[e]={},n=n[e]):n[e]=i}),i=function(t){const e={},n=(t,r)=>{for(const[i,o]of Object.entries(t)){const t=r?`${r}.${i}`:i;void 0!==o&&(null===o||"object"!=typeof o?e[t]=o:n(o,t))}};return null!==t&&"object"==typeof t&&n(t,""),e}(e)}else i={};for(const t of Object.values(i))Qt(t);(function(t="%"){const e=Zt(["LIKE",["PARAM","_id"],t]);return ur({method:"GET",url:"api/config/?"+T.buildQueryString({filter:e}),background:!0})})(t.join(".")+".%").then(t=>{const e={};for(const n of t)e[n._id]=n.value;const o=function(t,e){const n={add:[],remove:[]};for(const[r,i]of Object.entries(e))t[r]&&t[r]===i||n.add.push({_id:r,value:i});for(const r of Object.keys(t))e[r]||n.remove.push(r);return n}(e,i);if(!o.add.length&&!o.remove.length)return void n();const s=[];for(const t of o.add)s.push(yr("config",t._id,t));for(const t of o.remove)s.push(wr("config",t));Promise.all(s).then(()=>{n()}).catch(r)}).catch(r)}catch(t){n({config:t.message})}})}const Ro=()=>({view:t=>{const e=t.attrs.prefix.split("."),n=t.attrs.name,r=t.attrs.data;let i;if(""===e[e.length-1]&&e.pop(),r.length){i=No(r);for(const t of e)i=i[t]}const o=i&&Object.values(i).length?Ri.stringify(i,{schema:"failsafe",tags:t=>t}):"",s=ei(Vi,{id:n+"-ui-config",value:o,mode:"yaml",focus:!0,onSubmit:t=>{t.form.querySelector("button[type=submit]").click()},onChange:e=>{t.state.updatedYaml=e}}),a=ei("button.primary",{type:"submit"},"Save");return ei("div.put-form",[ei("h1","Editing "+n),ei("form",{onsubmit:n=>{n.redraw=!1,n.preventDefault(),null==t.state.updatedYaml&&(t.state.updatedYaml=o),jo(e,t.state.updatedYaml).then(t.attrs.onUpdate).catch(t.attrs.onError)}},[s,ei(".actions-bar",[a])])])}});function zo(t,e,n){return new Promise((r,i)=>{const o=Object.assign({},e);if("save"===t){let t=o._id||"";delete o._id;const e=/^[0-9a-zA-Z_.-]+$/;if(t=t.trim(),!t.match(e))return void r({_id:"Invalid ID"});try{o.value=Zt(Qt(o.value||""))}catch(t){return void r({value:"Config value must be valid expression"})}_r("config",t).then(e=>e&&n?(gr(0,Date.now()),void r({_id:"Config already exists"})):e||n?void yr("config",t,o).then(()=>{we("success","Config "+(e?"updated":"created")),gr(0,Date.now()),r()}).catch(i):(gr(0,Date.now()),void r({_id:"Config does not exist"}))).catch(i)}else"delete"===t?wr("config",o._id).then(()=>{we("success","Config deleted"),gr(0,Date.now()),r()}).catch(t=>{gr(0,Date.now()),i(t)}):i(new Error("Undefined action"))})}const Mo={resource:"config",attributes:[{id:"_id",label:"Key"},{id:"value",label:"Value",type:"textarea"}]};function Lo(t,e){const n=t.value.sort((t,e)=>t._id<e._id?-1:1);let r;if(e){const t=e.split(" ").filter(t=>t);t.length&&(r=new RegExp(t.map(t=>t.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")).join(".*"),"i"))}const i=[];for(const t of n){const e={};!r||r.test(t._id)||r.test(t.value)||(e.style="display: none;");const n=ei("button",{title:"Edit config value",onclick:()=>{const e=()=>ei(Gi,Object.assign({base:t,actionHandler:(t,n)=>new Promise(r=>{zo(t,n,!1).then(t=>{const n=t?Object.values(t):[];if(n.length)for(const t of n)we("error",t);else qr(e);r()}).catch(t=>{we("error",t.message),r()})})},Mo));Fr(e)}},Sr("edit")),o=ei("button",{title:"Delete config",onclick:()=>{confirm(`Deleting ${t._id} config. Are you sure?`)&&zo("delete",t).catch(t=>{throw t})}},Sr("remove"));i.push(ei("tr",e,ei("td.left",ei("long-text",{text:t._id})),ei("td.right",ei("span",[ei("long-text",{text:""+t.value}),n,o]))))}return i.length||i.push(ei("tr.empty",ei("td",{colspan:2},"No config"))),ei("table",ei("tbody",i))}const Bo=Object.freeze({__proto__:null,init:function(){return window.authorizer.hasAccess("config",2)?new Promise((t,e)=>{Promise.all([Li(),Bi()]).then(()=>{t({})}).catch(e)}):Promise.reject(new Error("You are not authorized to view this page"))},component:()=>({view:t=>{document.title="Config - GenieACS";const e=ei("input",{type:"text",placeholder:"Search config",oninput:e=>{t.state.searchString=e.target.value,e.redraw=!1,clearTimeout(t.state.timeout),t.state.timeout=setTimeout(ei.redraw,250)}}),n=pr("config",!0);let r;const i=[];if(window.authorizer.hasAccess("config",3)){r=ei("button.primary",{title:"Create new config",onclick:()=>{const t=()=>ei(Gi,Object.assign({actionHandler:(e,n)=>new Promise(r=>{zo(e,n,!0).then(e=>{const n=e?Object.values(e):[];if(n.length)for(const t of n)we("error",t);else qr(t);r()}).catch(t=>{we("error",t.message),r()})})},Mo));Fr(t)}},"New config");const t=[{name:"overview",prefix:"ui.overview.groups.",data:[]},{name:"charts",prefix:"ui.overview.charts.",data:[]},{name:"filters",prefix:"ui.filters.",data:[]},{name:"index page",prefix:"ui.index.",data:[]},{name:"device page",prefix:"ui.device.",data:[]}];if(n.fulfilled)for(const e of n.value)for(const n of t)if(e._id.startsWith(n.prefix)){n.data.push(e);break}for(const e of t){const t={prefix:e.prefix,name:e.name,data:e.data};i.push(ei("button",{onclick:()=>{const n=()=>ei(Ro,Object.assign({onUpdate:t=>{const r=t?Object.values(t):[];if(r.length)for(const t of r)we("error",t);else we("success",e.name.replace(/^[a-z]/,e.name[0].toUpperCase())+" config updated"),qr(n);gr(0,Date.now())},onError:t=>{we("error",t.message),gr(0,Date.now()),qr(n)}},t));Fr(n)}},"Edit "+e.name))}}return[ei("h1","Listing config"),ei(".all-parameters",e,ei(".parameter-list",{style:"height: 400px"},Lo(n,t.state.searchString)),ei(".actions-bar",[r].concat(i)))]}})}),Uo=_e.ui.pageSize||10,$o=ge(Qt),Fo=ge(JSON.parse),qo=[{id:"role",label:"Role"},{id:"resource",label:"Resource",type:"combo",options:["config","devices","faults","files","permissions","users","presets","provisions","virtualParameters"]},{id:"filter",label:"Filter",type:"textarea"},{id:"access",label:"Access",type:"combo",options:["1: count","2: read","3: write"]},{id:"validate",label:"Validate",type:"textarea"}],Wo=ge(t=>Ht(t,t=>Array.isArray(t)&&"FUNC"===t[0]&&"Q"===t[1]?vi("permissions",t[2],t[3]):t));function Jo(t,e){return new Promise((n,r)=>{const i=Object.assign({},e);if("save"===t){if(!i.role)return void n({role:"Role can not be empty"});if(!i.resource)return void n({resource:"Resource can not be empty"});if(!i.access)return void n({access:"Access can not be empty"});if("3: write"===i.access)i.access=3;else if("2: read"===i.access)i.access=2;else{if("1: count"!==i.access)return void n({access:"Invalid access level"});i.access=1}if(i.filter)try{i.filter=Zt($o(i.filter))}catch(t){return void n({filter:"Filter must be valid expression"})}if(i.validate)try{i.validate=Zt($o(i.validate))}catch(t){return void n({validate:"Validate must be valid expression"})}const t=`${i.role}:${i.resource}:${i.access}`;_r("permissions",t).then(e=>{if(e)return gr(0,Date.now()),void n({_id:"Permission already exists"});yr("permissions",t,i).then(()=>{we("success","Permission created"),gr(0,Date.now()),n()}).catch(r)}).catch(r)}else"delete"===t?wr("permissions",i._id).then(()=>{we("success","Permission deleted"),gr(0,Date.now()),n()}).catch(t=>{gr(0,Date.now()),r(t)}):r(new Error("Undefined action"))})}const Yo={resource:"permissions",attributes:qo},Vo=ge(t=>{const e={};for(const t of qo)e[t.label]=t.id;return"api/permissions.csv?"+ei.buildQueryString({filter:Zt(t),columns:JSON.stringify(e)})});const Ho=Object.freeze({__proto__:null,init:function(t){if(!window.authorizer.hasAccess("permissions",2))return Promise.reject(new Error("You are not authorized to view this page"));const e=t.hasOwnProperty("sort")?""+t.sort:"",n=t.hasOwnProperty("filter")?""+t.filter:"";return Promise.resolve({filter:n,sort:e})},component:()=>({view:t=>{document.title="Permissions - GenieACS";const e=t.attrs.sort?Fo(t.attrs.sort):{},n={};for(let t=0;t<qo.length;t++){const r=qo[t];"filter"!==r.id&&"validate"!==r.id&&(n[t]=e[r.id]||0)}let r=!t.attrs.filter||$o(t.attrs.filter);r=Wo(r);const i=pr("permissions",r,{limit:t.state.showCount||Uo,sort:e}),o=fr("permissions",r),s=Vo(r),a={};a.attributes=qo,a.data=i.value,a.total=o.value,a.valueCallback=(t,e)=>{if("access"===t.id){const t=e.access;return 1===t?"1: count":2===t?"2: read":3===t?"3: write":t}return e[t.id]},a.showMoreCallback=function(){t.state.showCount=(t.state.showCount||Uo)+Uo,ei.redraw()},a.sortAttributes=n,a.onSortChange=function(n){const r=Object.assign({},e);for(const[t,e]of Object.entries(n))delete r[qo[t].id],r[qo[t].id]=e;const i={sort:JSON.stringify(r)};t.attrs.filter&&(i.filter=t.attrs.filter),ei.route.set("/admin/permissions",i)},a.downloadUrl=s,window.authorizer.hasAccess("permissions",3)&&(a.recordActionsCallback=t=>[ei("button",{title:"Delete permission",onclick:()=>{confirm(`Deleting ${t._id} permission. Are you sure?`)&&Jo("delete",t).catch(t=>{we("error",t.message)})}},Sr("remove"))],a.actionsCallback=t=>[ei("button.primary",{title:"Create new permission",onclick:()=>{const t=()=>ei(Gi,Object.assign({actionHandler:(e,n)=>new Promise(r=>{Jo(e,n).then(e=>{const n=e?Object.values(e):[];if(n.length)for(const t of n)we("error",t);else qr(t);r()}).catch(t=>{we("error",t.message),r()})})},Yo));Fr(t)}},"New"),ei("button.primary",{title:"Delete selected permissions",disabled:!t.size,onclick:e=>{confirm(`Deleting ${t.size} permissions. Are you sure?`)&&(e.redraw=!1,e.target.disabled=!0,Promise.all(Array.from(t).map(t=>wr("permissions",t))).then(t=>{we("success",t.length+" permissions deleted"),gr(0,Date.now())}).catch(t=>{we("error",t.message),gr(0,Date.now())}))}},"Delete")]);const l={resource:"permissions"};return l.filter=t.attrs.filter,l.onChange=function(e){const n={filter:e};t.attrs.sort&&(n.sort=t.attrs.sort),ei.route.set("/admin/permissions",n)},[ei("h1","Listing permissions"),ei(Si,l),ei(di,a)]}})}),Ko=_e.ui.pageSize||10,Go=ge(Qt),Qo=ge(JSON.parse),Zo=[{id:"_id",label:"Username"},{id:"roles",label:"Roles",type:"multi",options:[]}],Xo=ge(t=>Ht(t,t=>Array.isArray(t)&&"FUNC"===t[0]&&"Q"===t[1]?vi("users",t[2],t[3]):t));function ts(t,e,n){return new Promise((r,i)=>{const o=Object.assign({},e);if("save"===t){const t=o._id,e=o.password,s=o.confirm;if(delete o._id,delete o.password,delete o.confirm,!t)return void r({_id:"ID can not be empty"});if(n){if(!e)return void r({password:"Password can not be empty"});if(e!==s)return void r({confirm:"Confirm password doesn't match password"})}if(!Array.isArray(o.roles)||!o.roles.length)return void r({roles:"Role(s) must be selected"});o.roles=o.roles.join(","),_r("users",t).then(s=>s&&n?(gr(0,Date.now()),void r({_id:"User already exists"})):s||n?void yr("users",t,o).then(()=>{n?Ar(t,e).then(()=>{we("success","User created"),gr(0,Date.now()),r()}).catch(i):(we("success","User updated"),gr(0,Date.now()),r())}).catch(i):(gr(0,Date.now()),void r({_id:"User does not exist"}))).catch(i)}else"delete"===t?wr("users",o._id).then(()=>{we("success","User deleted"),gr(0,Date.now()),r()}).catch(t=>{gr(0,Date.now()),i(t)}):i(new Error("Undefined action"))})}const es=ge(t=>{const e={};for(const t of Zo)e[t.label]=t.id;return"api/users.csv?"+ei.buildQueryString({filter:Zt(t),columns:JSON.stringify(e)})});const ns=Object.freeze({__proto__:null,init:function(t){if(!window.authorizer.hasAccess("users",2))return Promise.reject(new Error("You are not authorized to view this page"));const e=t.hasOwnProperty("sort")?""+t.sort:"",n=t.hasOwnProperty("filter")?""+t.filter:"";return Promise.resolve({filter:n,sort:e})},component:()=>({view:t=>{document.title="Users - GenieACS";const e=t.attrs.sort?Qo(t.attrs.sort):{},n={};for(let t=0;t<Zo.length;t++){"roles"!==Zo[t].id&&(n[t]=e[Zo[t].id]||0)}let r=!t.attrs.filter||Go(t.attrs.filter);r=Xo(r);const i=pr("users",r,{limit:t.state.showCount||Ko,sort:e}),o=fr("users",r),s=pr("permissions",!0);if(s.fulfilled)for(const t of Zo)"roles"===t.id&&(t.options=[...new Set(s.value.map(t=>t.role))]);const a=es(r),l=window.authorizer.hasAccess("users",3),u={};if(u.attributes=Zo,u.data=i.value,u.total=o.value,u.showMoreCallback=function(){t.state.showCount=(t.state.showCount||Ko)+Ko,ei.redraw()},u.sortAttributes=n,u.onSortChange=function(n){const r=Object.assign({},e);for(const[t,e]of Object.entries(n))delete r[Zo[t].id],r[Zo[t].id]=e;const i={sort:JSON.stringify(r)};t.attrs.filter&&(i.filter=t.attrs.filter),ei.route.set("/admin/users",i)},u.downloadUrl=a,u.recordActionsCallback=t=>[ei("a",{onclick:()=>{const e=()=>{const n=[ei(Gi,Object.assign({base:{_id:t._id,roles:t.roles.split(",")},actionHandler:(t,n)=>new Promise(r=>{ts(t,n,!1).then(t=>{const n=t?Object.values(t):[];if(n.length)for(const t of n)we("error",t);else qr(e);r()}).catch(t=>{we("error",t.message),r()})})},{resource:"users",attributes:Zo}))];if(l){n.push(ei("hr"));const r={noAuth:!0,username:t._id,onPasswordChange:()=>{qr(e),ei.redraw()}};n.push(ei(oi,r))}return n};Fr(e)}},"Show")],l){const t={resource:"users",attributes:[Zo[0],{id:"password",label:"Password",type:"password"},{id:"confirm",label:"Confirm password",type:"password"},Zo[1]]};u.actionsCallback=e=>[ei("button.primary",{title:"Create new user",onclick:()=>{const e=()=>ei(Gi,Object.assign({actionHandler:(t,n)=>new Promise(r=>{ts(t,n,!0).then(t=>{const n=t?Object.values(t):[];if(n.length)for(const t of n)we("error",t);else qr(e);r()}).catch(t=>{we("error",t.message),r()})})},t));Fr(e)}},"New"),ei("button.primary",{title:"Delete selected users",disabled:!e.size,onclick:t=>{confirm(`Deleting ${e.size} users. Are you sure?`)&&(t.redraw=!1,t.target.disabled=!0,Promise.all(Array.from(e).map(t=>wr("users",t))).then(t=>{we("success",t.length+" users deleted"),gr(0,Date.now())}).catch(t=>{we("error",t.message),gr(0,Date.now())}))}},"Delete")]}const c={resource:"users"};return c.filter=t.attrs.filter,c.onChange=function(e){const n={filter:e};t.attrs.sort&&(n.sort=t.attrs.sort),ei.route.set("/admin/users",n)},[ei("h1","Listing users"),ei(Si,c),ei(di,u)]}})});window.authorizer=new class{constructor(t){this.permissionSets=t,this.validatorCache=new WeakMap,this.hasAccessCache=new Map,this.getFilterCache=new Map}hasAccess(t,e){const n=`${t}-${e}`;if(this.hasAccessCache.has(n))return this.hasAccessCache.get(n);let r=!1;for(const n of this.permissionSets)for(const i of n)if(i[t]&&i[t].access>=e){r=!0;break}return this.hasAccessCache.set(n,r),r}getFilter(t,e){const n=`${t}-${e}`;if(this.getFilterCache.has(n))return this.getFilterCache.get(n);let r=null;for(const n of this.permissionSets)for(const i of n)i[t]&&i[t].access>=e&&(r=ce(r,i[t].filter));return this.getFilterCache.set(n,r),r}getValidator(t,e){if(this.validatorCache.has(e))return this.validatorCache.get(e);const n=[];for(const e of this.permissionSets)for(const r of e)r[t]&&r[t].access>=3&&r[t].validate&&n.push(r[t].validate);const r=(r,i,o)=>{if(!n.length)return!1;const s={mutationType:r,mutation:i,resourceType:t,object:e,options:o},a=le(n.length>1?["OR",n]:n[0],t=>{const e=t.split(".",1)[0];t=t.slice(e.length+1);let n=null;if(["mutation","options"].includes(e)){n=s[e];for(const e of t.split("."))if(n=null!=n&&"object"!=typeof n?null:n[e],null==n)break}else s[e]&&(n=t?s[e][t]:s[e]);return n},Date.now());return!Array.isArray(a)&&!!a};return this.validatorCache.set(e,r),r}getPermissionSets(){return this.permissionSets}}(window.permissionSets);const rs=["presets","provisions","virtualParameters","files","config","users","permissions"];let is,os=0,ss=0,as=null;function ls(){clearTimeout(as),as=setTimeout(()=>{gr(os,ss,t=>{t&&T.redraw()})},100)}function us(t,e){const n={render:()=>{let n;os=Date.now(),n=is&&is.error?T(Ni,is):T(ii(e.component),is),ls();const r={};return r.page=t,T(Jr,r,n)},onmatch:(null,(t,n)=>(ss=Date.now(),e.init?new Promise(r=>{e.init(t).then(t=>{t?(is=t,r(),ls()):T.route.set("/")}).catch(t=>{!window.username&&t.message.indexOf("authorized")>=0&&(we("error",t.message),T.route.set("/login",{continue:n})),is={error:t.message},r()})}):(is=null,ls(),null)))};return n}T.route(document.body,"/overview",{"/wizard":us("wizard",Yr),"/login":us("login",si),"/overview":us("overview",hi),"/devices":us("devices",Ti),"/devices/:id":us("devices",Ii),"/faults":us("faults",Yi),"/admin":{onmatch:()=>{for(const t of rs)if(window.authorizer.hasAccess(t,2))return T.route.set("/admin/"+t),null;return null}},"/admin/presets":us("presets",oo),"/admin/provisions":us("provisions",go),"/admin/virtualParameters":us("virtualParameters",xo),"/admin/files":us("files",Io),"/admin/config":us("config",Bo),"/admin/users":us("users",ns),"/admin/permissions":us("permissions",Ho)})}).call(this,n(0),n(4).setImmediate,n(2).Buffer)},function(t,e,n){(function(t){var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},n(5),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(0))},function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var r,i,o,s,a,l=1,u={},c=!1,f=t.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(t);h=h&&h.setTimeout?h:t,"[object process]"==={}.toString.call(t.process)?r=function(t){e.nextTick((function(){p(t)}))}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){p(t.data)},r=function(t){o.port2.postMessage(t)}):f&&"onreadystatechange"in f.createElement("script")?(i=f.documentElement,r=function(t){var e=f.createElement("script");e.onreadystatechange=function(){p(t),e.onreadystatechange=null,i.removeChild(e),e=null},i.appendChild(e)}):r=function(t){setTimeout(p,0,t)}:(s="setImmediate$"+Math.random()+"$",a=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(s)&&p(+e.data.slice(s.length))},t.addEventListener?t.addEventListener("message",a,!1):t.attachEvent("onmessage",a),r=function(e){t.postMessage(s+e,"*")}),h.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return u[l]=i,r(l),l++},h.clearImmediate=d}function d(t){delete u[t]}function p(t){if(c)setTimeout(p,0,t);else{var e=u[t];if(e){c=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(void 0,n)}}(e)}finally{d(t),c=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(0),n(1))},function(t,e,n){"use strict";e.byteLength=function(t){var e=u(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){var e,n,r=u(t),s=r[0],a=r[1],l=new o(function(t,e,n){return 3*(e+n)/4-n}(0,s,a)),c=0,f=a>0?s-4:s;for(n=0;n<f;n+=4)e=i[t.charCodeAt(n)]<<18|i[t.charCodeAt(n+1)]<<12|i[t.charCodeAt(n+2)]<<6|i[t.charCodeAt(n+3)],l[c++]=e>>16&255,l[c++]=e>>8&255,l[c++]=255&e;2===a&&(e=i[t.charCodeAt(n)]<<2|i[t.charCodeAt(n+1)]>>4,l[c++]=255&e);1===a&&(e=i[t.charCodeAt(n)]<<10|i[t.charCodeAt(n+1)]<<4|i[t.charCodeAt(n+2)]>>2,l[c++]=e>>8&255,l[c++]=255&e);return l},e.fromByteArray=function(t){for(var e,n=t.length,i=n%3,o=[],s=0,a=n-i;s<a;s+=16383)o.push(c(t,s,s+16383>a?a:s+16383));1===i?(e=t[n-1],o.push(r[e>>2]+r[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],o.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,l=s.length;a<l;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function u(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function c(t,e,n){for(var i,o,s=[],a=e;a<n;a+=3)i=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),s.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,n,r,i){var o,s,a=8*i-r-1,l=(1<<a)-1,u=l>>1,c=-7,f=n?i-1:0,h=n?-1:1,d=t[e+f];for(f+=h,o=d&(1<<-c)-1,d>>=-c,c+=a;c>0;o=256*o+t[e+f],f+=h,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=r;c>0;s=256*s+t[e+f],f+=h,c-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=u}return(d?-1:1)*s*Math.pow(2,o-r)},e.write=function(t,e,n,r,i,o){var s,a,l,u=8*o-i-1,c=(1<<u)-1,f=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,p=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+f>=1?h/l:h*Math.pow(2,1-f))*l>=2&&(s++,l/=2),s+f>=c?(a=0,s=c):s+f>=1?(a=(e*l-1)*Math.pow(2,i),s+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;t[n+d]=255&a,d+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;t[n+d]=255&s,d+=p,s/=256,u-=8);t[n+d-p]|=128*g}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}}]);
//# sourceMappingURL=app.js.map